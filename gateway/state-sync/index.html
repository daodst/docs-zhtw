
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../disk-usage/">
      
      
        <link rel="next" href="../mempool/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.6">
    
    
      
        <title>狀態同步 - DAODST文檔</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.ded33207.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DAODST文檔" class="md-header__button md-logo" aria-label="DAODST文檔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DAODST文檔
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              狀態同步
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="https://zh-tw.docs.daodst.com" hreflang="zh" class="md-select__link">
                    中文
                  </a>
                </li>
              
                <li class="md-select__item">
                  <a href="https://docs.daodst.com" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../protocol/stcd/" class="md-tabs__link">
        🔍協議
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../modules_accounts/" class="md-tabs__link">
        🧱模塊
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../run/" class="md-tabs__link md-tabs__link--active">
        ✈網關和驗證器
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../chat/installation/" class="md-tabs__link">
        📞聊天
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../faq/" class="md-tabs__link">
      📋常見問題
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DAODST文檔" class="md-nav__button md-logo" aria-label="DAODST文檔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    DAODST文檔
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          🔍協議
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          🔍協議
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1_1" id="__nav_1_1_label" tabindex="0">
          命令行界面
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1_1">
          <span class="md-nav__icon md-icon"></span>
          命令行界面
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/" class="md-nav__link">
        安裝
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/config/" class="md-nav__link">
        配置
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/single-node/" class="md-nav__link">
        單節點
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/command/" class="md-nav__link">
        CLI命令
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/account/" class="md-nav__link">
        帳號
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/chainid/" class="md-nav__link">
        鏈ID
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/encode/" class="md-nav__link">
        編碼
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/gas/" class="md-nav__link">
        Gas和手續費
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/keyring/" class="md-nav__link">
        密鑰環
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/key-management/" class="md-nav__link">
        密鑰管理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/state-migrate/" class="md-nav__link">
        狀態導入導出
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/pending/" class="md-nav__link">
        等待隊列
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/multsign/" class="md-nav__link">
        多簽
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/coin/" class="md-nav__link">
        代幣
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/transfer/" class="md-nav__link">
        交易
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          🧱模塊
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          🧱模塊
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules_accounts/" class="md-nav__link">
        模塊賬號
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../evm/" class="md-nav__link">
        以太坊虛擬機
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/" class="md-nav__link">
        聊天
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        網關
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contract/" class="md-nav__link">
        合約
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pledge/" class="md-nav__link">
        聊天質押
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../auth/" class="md-nav__link">
        認證
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../bank/" class="md-nav__link">
        銀行
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gov/" class="md-nav__link">
        治理
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mint/" class="md-nav__link">
        鑄造
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../distribute/" class="md-nav__link">
        分配
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../slashing/" class="md-nav__link">
        削減
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../staking/" class="md-nav__link">
        DPOS質押
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          ✈網關和驗證器
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          ✈網關和驗證器
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          設置和配寘
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          設置和配寘
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../run/" class="md-nav__link">
        運行驗證器
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        配寘
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../disk-usage/" class="md-nav__link">
        硬碟使用優化
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          狀態同步
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        狀態同步
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tendermint" class="md-nav__link">
    Tendermint 核心狀態同步
  </a>
  
    <nav class="md-nav" aria-label="Tendermint 核心狀態同步">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    狀態同步快照
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    拍攝、提供快照
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    恢復快照
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cosmos-sdk" class="md-nav__link">
    Cosmos SDK 狀態同步
  </a>
  
    <nav class="md-nav" aria-label="Cosmos SDK 狀態同步">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    狀態同步快照
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    啟用狀態同步快照
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    狀態同步節點
  </a>
  
    <nav class="md-nav" aria-label="狀態同步節點">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    準備系統
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    使用以下命令進行主網設置
  </a>
  
    <nav class="md-nav" aria-label="使用以下命令進行主網設置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stcd" class="md-nav__link">
    安裝 stcd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stcd_1" class="md-nav__link">
    創建stcd服務
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stcd_2" class="md-nav__link">
    運行 stcd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    檢查日誌
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    關閉狀態同步模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mempool/" class="md-nav__link">
        記憶體池
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        常見問題
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../security/" class="md-nav__link">
        安全
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
          陞級
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          陞級
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/" class="md-nav__link">
        概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/list/" class="md-nav__link">
        升級清單
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/hard-fork/" class="md-nav__link">
        硬分叉升級
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/auto/" class="md-nav__link">
        自動升級
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/manual/" class="md-nav__link">
        手動升級
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/rollback/" class="md-nav__link">
        回滾
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/template/" class="md-nav__link">
        提案模板
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../testnet/" class="md-nav__link">
        測試網
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mainnet/" class="md-nav__link">
        主網
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
          網關操作指南
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          網關操作指南
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-linux/" class="md-nav__link">
        操作指南(linux)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guide-win/" class="md-nav__link">
        操作指南(win)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../key-backup/" class="md-nav__link">
        金鑰備份和恢復
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          📞聊天
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          📞聊天
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/installation/" class="md-nav__link">
        安裝啟動
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/chat_doc/" class="md-nav__link">
        文檔
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/client_server/" class="md-nav__link">
        客戶端-服務端API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/server_server/" class="md-nav__link">
        服務端-服務端API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/customise_doc/" class="md-nav__link">
        定制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/voip_signaling/" class="md-nav__link">
        呼叫流程
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/optional_cfg/" class="md-nav__link">
        可選配置*
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../chat/faq/" class="md-nav__link">
        常見問題
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        📋常見問題
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tendermint" class="md-nav__link">
    Tendermint 核心狀態同步
  </a>
  
    <nav class="md-nav" aria-label="Tendermint 核心狀態同步">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    狀態同步快照
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    拍攝、提供快照
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    恢復快照
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cosmos-sdk" class="md-nav__link">
    Cosmos SDK 狀態同步
  </a>
  
    <nav class="md-nav" aria-label="Cosmos SDK 狀態同步">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    狀態同步快照
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    啟用狀態同步快照
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    狀態同步節點
  </a>
  
    <nav class="md-nav" aria-label="狀態同步節點">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    準備系統
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    使用以下命令進行主網設置
  </a>
  
    <nav class="md-nav" aria-label="使用以下命令進行主網設置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stcd" class="md-nav__link">
    安裝 stcd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    配置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stcd_1" class="md-nav__link">
    創建stcd服務
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stcd_2" class="md-nav__link">
    運行 stcd
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    檢查日誌
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    關閉狀態同步模式
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="_1">狀態同步</h1>
<p>了解 Cosmos SDK 提供的 Tendermint Core 狀態同步和支持。</p>
<p>📣 提示 : 只是關心如何將節點與網絡同步？跳到 <a href="#_8">本節</a>。</p>
<h2 id="tendermint">Tendermint 核心狀態同步</h2>
<p>狀態同步允許新節點通過獲取最近高度的網絡狀態快照來加入網絡，而不是獲取和重播所有歷史塊。
由於應用程序狀態小於所有塊的組合，並且恢復狀態比重放塊更快，這將與網絡同步的時間從幾天縮短到幾分鐘。</p>
<p>本文檔的這一部分簡要概述了 Tendermint 狀態同步協議，以及如何同步節點。
有關更多詳細信息，請參閱 <a href="https://docs.tendermint.com/master/spec/abci/apps.html#state-sync">ABCI 應用指南</a> 和 <a href="https://docs.tendermint.com/master/spec/abci/abci.html">ABCI 參考文檔</a>。</p>
<h3 id="_2">狀態同步快照</h3>
<p>設計 Tendermint 狀態同步時的指導原則是為應用程序提供盡可能多的靈活性。因此，Tendermint 不關心快照包含什麼、它們是如何拍攝的或它們是如何恢復的。它只關心發現網絡中的現有快照、獲取它們並通過 ABCI 將它們傳遞給應用程序。</p>
<p>Tendermint 使用輕客戶端驗證來檢查已恢復應用程序的最終應用程序哈希值與鏈應用程序哈希值的對比，但任何進一步的驗證都必須在恢復過程中由應用程序本身完成。</p>
<p>快照由任意格式的二進制塊組成。塊不能大於 16 MB，否則沒有限制。
<a href="https://docs.tendermint.com/master/spec/abci/abci.html#snapshot">快照元數據</a>，通過 ABCI 和 P2P 交換，包含以下字段：</p>
<ul>
<li><code>height</code> (<code>uint64</code>): 拍攝快照的高度</li>
<li><code>format</code> (<code>uint32</code>)：任意特定於應用程序的格式標識符（例如版本）</li>
<li><code>chunks</code> (<code>uint32</code>): 快照中二進制塊的數量</li>
<li><code>hash</code> (<code>bytes</code>): 用於跨節點比較快照的任意快照哈希</li>
<li><code>metadata</code> (<code>bytes</code>)：供應用程序使用的任意二進制快照元數據</li>
</ul>
<p><code>format</code> 字段允許應用程序以向後兼容的方式更改其快照格式，方法是提供多種格式的快照，並選擇在恢復期間接受哪些格式。</p>
<p>例如，這在更改序列化或壓縮格式時很有用：因為節點可能能夠向運行舊版本的節點提供快照，或者在使用較新版本啟動時使用舊快照。</p>
<p><code>hash</code> 字段包含任意快照哈希。跨節點具有相同 <code>metadata</code> 字段（包括 <code>hash</code>）的快照被認為是相同的，並且將從這些節點中的任何一個獲取 <code>chunks</code>。</p>
<p><code>hash</code> 不可信任，並且未經 Tendermint 本身驗證，這可以防止快照生成中的無意不確定性。</p>
<p><code>hash</code> 可以改為由應用程序驗證。</p>
<p><code>metadata</code> 字段可以包含應用程序所需的任何任意元數據。
例如，應用程序可能希望包含塊校驗和以丟棄損壞的<code>chunks</code>，或 <a href="https://ethereum.org/en/developers/tutorials/merkle-proofs-for-offline-data-integrity/">Merkle 證明</a> 根據鏈應用程序哈希分別驗證每個塊。
在 <a href="https://developers.google.com/protocol-buffers/docs/overview">Protobuf</a> 編碼形式中，快照 <code>metadata</code> 消息不能超過 4 MB。</p>
<h3 id="_3">拍攝、提供快照</h3>
<p>要啟用狀態同步，網絡中的某些節點必須拍攝並提供快照。
當對等點嘗試狀態同步時，現有的 Tendermint 節點將在應用程序上調用以下 ABCI 方法以向該對等點提供快照數據：</p>
<ul>
<li><a href="https://docs.tendermint.com/master/spec/abci/abci.html#listsnapshots"><code>ListSnapshots</code></a>：返回可用快照列表，以及元數據</li>
<li><a href="https://docs.tendermint.com/master/spec/abci/abci.html#loadsnapshotchunk"><code>LoadSnapshotChunk</code></a>：返回二進制塊數據</li>
</ul>
<p>快照通常應該定期生成，而不是按需生成：這可以提高狀態同步性能，因為快照生成可能很慢，並且可以避免攻擊者用此類請求淹沒節點的拒絕服務向量。</p>
<p>通常可以刪除較舊的快照，但至少保留兩個最新的快照可能很有用，以避免在節點恢復時刪除先前的快照。</p>
<p>完全由應用程序決定如何拍攝快照，但它應努力滿足以下保證：</p>
<ul>
<li><strong>異步</strong>：快照不應該停止塊處理，因此它應該異步發生，例如。在一個單獨的線程中</li>
<li><strong>一致</strong>：快照應在孤立的高度拍攝，並且不應受到並發寫入的影響，例如。由於主線程中的塊處理</li>
<li><strong>確定性</strong>：對於給定的<code>height</code>和<code>format</code>，所有節點的快照<code>chunks</code>和<code>metadata</code> 應該相同（在字節級別），以確保<code>chunks</code>的良好可用性</li>
</ul>
<p>例如，這可以按如下方式實現：</p>
<ol>
<li>使用支持帶快照隔離的事務的數據存儲，例如 RocksDB 或 BadgerDB。</li>
<li>提交塊後在主線程中啟動只讀數據庫事務。</li>
<li>將數據庫事務句柄傳遞到新生成的線程中。</li>
<li>以確定的順序遍歷所有數據項（例如，按鍵排序）</li>
<li>序列化數據項（例如使用 <a href="https://developers.google.com/protocol-buffers/docs/overview">Protobuf</a>），並將它們寫入字節流。</li>
<li>對字節流進行哈希處理，並將其拆分為固定大小的塊（例如 10 MB）</li>
<li>將塊作為單獨的文件存儲在文件系統中。</li>
<li>將快照元數據寫入數據庫或文件，包括字節流哈希。</li>
<li>關閉數據庫事務並退出線程。</li>
</ol>
<p>應用程序可能還需要採取額外的步驟，例如壓縮數據、校驗塊、為增量驗證生成證明以及刪除舊快照。</p>
<h3 id="_4">恢復快照</h3>
<p>當 Tendermint 啟動時，它會檢查本地節點是否有任何狀態（即是否 <code>LastBlockHeight == 0</code>），如果沒有，它將開始通過 P2P 網絡發現快照。
這些快照將通過以下 ABCI 調用提供給本地應用程序：</p>
<ul>
<li><a href="https://docs.tendermint.com/master/spec/abci/abci.html#offersnapshot"><code>OfferSnapshot(snapshot, apphash)</code></a>：向應用程序提供已發現的快照</li>
<li><a href="https://docs.tendermint.com/master/spec/abci/abci.html#applysnapshotchunk"><code>ApplySnapshotChunk(index, chunk, sender)</code></a>：應用快照塊</li>
</ul>
<p>將發現的快照提供給應用程序，它可以通過接受快照、拒絕快照、拒絕格式、拒絕發送者、中止狀態同步等方式做出響應。</p>
<p>一旦快照被接受，Tendermint 將從可用的對等點獲取塊，並將它們按順序應用到應用程序，應用程序可以選擇接受塊、重新獲取、拒絕快照、拒絕發送者、中止狀態同步等。</p>
<p>應用所有塊後，Tendermint 將在應用程序上調用 <a href="https://docs.tendermint.com/master/spec/abci/abci.html#info"><code>Info</code> ABCI 方法</a>，並檢查應用程序哈希和高度對應於鏈中的可信值。
然後它將切換到快速同步以獲取任何剩餘的塊（如果啟用），然後最終加入正常的共識操作。</p>
<p>快照如何實際恢復完全取決於應用程序，但通常與它們的生成方式相反。</p>
<p>但是請注意，Tendermint 僅在所有塊都已恢復後才驗證快照，並且不會自行拒絕任何 P2P 對等方。</p>
<p>只要可信哈希和應用程序代碼是正確的，對手就不可能在加入共識時導致狀態同步節點具有不正確的狀態，但是應用程序可以抵消狀態同步拒絕服務（例如，通過實施增量驗證、拒絕無效節點）。</p>
<p>請注意，狀態同步節點將有一個從恢復快照的高度開始的截斷塊歷史記錄，目前沒有<a href="https://github.com/tendermint/tendermint/issues/4629">所有塊數據的回填</a>。
網絡應該考慮更廣泛的影響，並且可能希望確保至少有幾個存檔節點保留完整的塊歷史記錄，以用於可審計性和備份。</p>
<h2 id="cosmos-sdk">Cosmos SDK 狀態同步</h2>
<p><a href="https://github.com/cosmos/cosmos-sdk">Cosmos SDK</a> v0.40+ 包含對狀態同步的自動支持，因此應用開發者只需啟用它即可使用。他們將不需要自己實施 <a href="#tendermint-core-state-sync">上面關於 Tendermint 的部分</a> 中描述的狀態同步協議。</p>
<h3 id="_5">狀態同步快照</h3>
<p>Tendermint Core 處理大部分為狀態同步發現、交換和驗證狀態數據的繁重工作，但應用程序必須定期為其狀態拍攝快照，並通過 ABCI 調用將這些快照提供給 Tendermint，並能夠恢復這些同步新節點時。</p>
<p>Cosmos SDK 將應用程序狀態存儲在名為 <a href="https://github.com/cosmos/iavl">IAVL</a> 的數據存儲中，每個模塊都可以設置自己的 IAVL 存儲。
在固定的高度間隔（可配置），Cosmos SDK 將在該高度導出每個商店的內容，<a href="https://developers.google.com/protocol-buffers/docs/overview">Protobuf</a>-編碼和壓縮它，並將其保存到本地文件系統中的快照存儲中。
由於 IAVL 保留了數據的歷史版本，因此可以在執行新塊的同時生成這些快照。</p>
<p>當新節點進行狀態同步時，Tendermint 將通過 ABCI 獲取這些快照。</p>
<p>請注意，只有由 Cosmos SDK 管理的 IAVL 存儲可以被快照。如果應用程序在外部數據存儲中存儲額外的數據，目前沒有機制將這些包含在狀態同步快照中，因此應用程序無法通過 SDK 使用自動狀態同步。</p>
<p>但是，如 <a href="https://docs.tendermint.com/master/spec/abci/apps.html#state-sync">ABCI 文檔</a> 中所述，可以自由實施狀態同步協議本身。</p>
<p>當一個新節點狀態同步時，Tendermint 將從網絡中的對等點獲取快照並將其提供給本地（空）應用程序，該應用程序會將其導入其 IAVL 存儲。</p>
<p>Tendermint 然後使用輕客戶端驗證針對主區塊鏈驗證應用程序的應用程序哈希，並像往常一樣繼續執行塊。</p>
<p>請注意，狀態同步節點只會恢復快照拍攝高度的應用程序狀態，並且不會包含歷史數據或歷史塊。</p>
<h3 id="_6">啟用狀態同步快照</h3>
<p>要啟用狀態同步快照，使用 CosmosSDK <code>BaseApp</code> 的應用程序需要設置快照存儲（帶有數據庫和文件系統目錄）並配置快照間隔和要保留的歷史快照數量。一個最小的例子如下：</p>
<pre><code class="language-bash">snapshotDir := filepath.Join(
  cast.ToString(appOpts.Get(flags.FlagHome)), &quot;data&quot;, &quot;snapshots&quot;)
snapshotDB, err := sdk.NewLevelDB(&quot;metadata&quot;, snapshotDir)
if err != nil {
  panic(err)
}
snapshotStore, err := snapshots.NewStore(snapshotDB, snapshotDir)
if err != nil {
  panic(err)
}
app := baseapp.NewBaseApp(
  &quot;app&quot;, logger, db, txDecoder,
  baseapp.SetSnapshotStore(snapshotStore),
  baseapp.SetSnapshotInterval(cast.ToUint64(appOpts.Get(
    server.FlagStateSyncSnapshotInterval))),
  baseapp.SetSnapshotKeepRecent(cast.ToUint32(appOpts.Get(
    server.FlagStateSyncSnapshotKeepRecent))),
)
</code></pre>
<p>當使用適當的標誌啟動應用程序時，（例如 <code>--state-sync.snapshot-interval 1000 --state-sync.snapshot-keep-recent 2</code>）它應該生成快照並輸出日誌消息：</p>
<pre><code class="language-bash">Creating state snapshot    module=main height=3000
Completed state snapshot   module=main height=3000 format=1
</code></pre>
<p>請注意，快照間隔當前必須是 <code>pruning-keep-every</code>（默認為 100）的倍數，以防止在拍攝快照時修剪高度。至少保留 2 個最近的快照通常也是一個好主意，這樣當節點嘗試使用它進行狀態同步時，不會刪除以前的快照。</p>
<h2 id="_7">狀態同步節點</h2>
<p>📣 提示 : 尋找快照或存檔節點來同步您的節點？查看 <a href="./../../develop/api/snapshots-archives">此頁面</a>。</p>
<p>一旦網絡中的幾個節點拍攝了狀態同步快照，新節點就可以使用狀態同步加入網絡。
為此，首先應該像往常一樣配置節點，並且必須獲取以下信息以進行輕客戶端驗證：</p>
<ul>
<li>兩個可用的 RPC 服務器（至少）</li>
<li>可信高度</li>
<li>可信高度的區塊ID哈希</li>
</ul>
<p>可信哈希必須從可信源（例如區塊瀏覽器）獲得，但 RPC 服務器不需要可信。 Tendermint 將使用哈希從區塊鏈中獲取受信任的應用程序哈希，以驗證恢復的應用程序快照。應用程序哈希和相應的高度是恢復快照時唯一可以信任的信息。其他一切都可以由對手偽造。</p>
<p>在本指南中，我們使用 Ubuntu 20.04</p>
<h3 id="_8">準備系統</h3>
<p>更新系統</p>
<pre><code class="language-bash">sudo apt update -y
</code></pre>
<p>升級系統</p>
<pre><code class="language-bash">sudo apt upgrade -y
</code></pre>
<p>安裝依賴</p>
<pre><code class="language-bash">sudo apt-get install ca-certificates curl gnupg lsb-release make gcc git jq wget -y
</code></pre>
<p>安裝 Go</p>
<pre><code class="language-bash">wget -q -O - https://raw.githubusercontent.com/canha/golang-tools-install-script/master/goinstall.sh | bash
source ~/.bashrc
</code></pre>
<p>設置節點名稱</p>
<pre><code class="language-bash">moniker=&quot;NODE_NAME&quot;
</code></pre>
<h2 id="_9">使用以下命令進行主網設置</h2>
<pre><code class="language-bash">SNAP_RPC1=&quot;http://xxx1:26657&quot;
SNAP_RPC=&quot;http://xxx:26657&quot;
CHAIN_ID=&quot;daodst_7777-1&quot;
PEER=&quot;96557e26aabf3b23e8ff5282d03196892a7776fc@xxx,dec587d55ff38827ebc6312cedda6085c59683b6@xxx&quot;
wget -O $HOME/genesis.json https://raw.githubusercontent.com/daodst/mainnet/genesis.json 
</code></pre>
<h3 id="stcd">安裝 stcd</h3>
<pre><code class="language-bash">git clone https://github.com/daodst/blockchain.git &amp;&amp; \ 
cd cmd &amp;&amp; cd stcd
go build
</code></pre>
<h3 id="_10">配置</h3>
<p>節點初始化</p>
<pre><code class="language-bash">stcd init $moniker --chain-id $CHAIN_ID
</code></pre>
<p>📣 提示 :  <code>$install_path</code> 用來表示您安裝 <code>stcd</code> 二進製程序的路徑</p>
<p>將 genesis 文件移動到 $install_path/.stcd/config 文件夾</p>
<pre><code class="language-bash">mv $HOME/genesis.json $install_path/.stcd/config/
</code></pre>
<p>重置節點</p>
<pre><code class="language-bash">stcd tendermint unsafe-reset-all --home .stcd
</code></pre>
<p>更改配置文件（設置節點名稱、添加持久對等點、設置索引器 =“null”）</p>
<pre><code class="language-bash">sed -i -e &quot;s%^moniker *=.*%moniker = \&quot;$moniker\&quot;%; &quot; $install_path/.stcd/config/config.toml
sed -i -e &quot;s%^indexer *=.*%indexer = \&quot;null\&quot;%; &quot; $install_path/.stcd/config/config.toml
sed -i -e &quot;s%^persistent_peers *=.*%persistent_peers = \&quot;$PEER\&quot;%; &quot; $install_path/.stcd/config/config.toml
</code></pre>
<p>設置從快照開始的變量</p>
<pre><code class="language-bash">LATEST_HEIGHT=$(curl -s $SNAP_RPC/block | jq -r .result.block.header.height); \
BLOCK_HEIGHT=$((LATEST_HEIGHT - 2000)); \
TRUST_HASH=$(curl -s &quot;$SNAP_RPC/block?height=$BLOCK_HEIGHT&quot; | jq -r .result.block_id.hash)
</code></pre>
<p>檢查</p>
<pre><code class="language-bash">echo $LATEST_HEIGHT $BLOCK_HEIGHT $TRUST_HASH
</code></pre>
<p>輸出示例（數字會有所不同）：</p>
<pre><code class="language-bash">376080 374080 F0C78FD4AE4DB5E76A298206AE3C602FF30668C521D753BB7C435771AEA47189
</code></pre>
<p>如果輸出正常，下一步</p>
<pre><code class="language-bash">sed -i.bak -E &quot;s|^(enable[[:space:]]+=[[:space:]]+).*$|\1true| ; \

s|^(rpc_servers[[:space:]]+=[[:space:]]+).*$|\1\&quot;$SNAP_RPC,$SNAP_RPC1\&quot;| ; \

s|^(trust_height[[:space:]]+=[[:space:]]+).*$|\1$BLOCK_HEIGHT| ; \

s|^(trust_hash[[:space:]]+=[[:space:]]+).*$|\1\&quot;$TRUST_HASH\&quot;| ; \

s|^(seeds[[:space:]]+=[[:space:]]+).*$|\1\&quot;\&quot;|&quot; $install_path/.stcd/config/config.toml
</code></pre>
<h3 id="stcd_1">創建stcd服務</h3>
<pre><code class="language-bash">echo &quot;[Unit]
Description=Daodst Chain Node
After=network.target
#
[Service]
User=$USER
Type=simple
ExecStart=$(which stcd) daemon
Restart=on-failure
LimitNOFILE=65535
#
[Install]
WantedBy=multi-user.target&quot; &gt; $HOME/stcd.service; sudo mv $HOME/stcd.service /etc/systemd/system/
</code></pre>
<pre><code class="language-bash">sudo systemctl enable stcd.service &amp;&amp; sudo systemctl daemon-reload
</code></pre>
<h3 id="stcd_2">運行 stcd</h3>
<pre><code class="language-bash">sytemctl start stcd
</code></pre>
<h3 id="_11">檢查日誌</h3>
<pre><code class="language-bash">journalctl -u stcd -f
</code></pre>
<p>當節點啟動時，它將嘗試在網絡中找到狀態同步快照，並恢復它：</p>
<pre><code class="language-bash">Started node                   module=main nodeInfo=&quot;...&quot;
Discovering snapshots for 20s
Discovered new snapshot        height=3000 format=1 hash=0F14A473
Discovered new snapshot        height=2000 format=1 hash=C6209AF7
Offering snapshot to ABCI app  height=3000 format=1 hash=0F14A473
Snapshot accepted, restoring   height=3000 format=1 hash=0F14A473
Fetching snapshot chunk        height=3000 format=1 chunk=0 total=3
Fetching snapshot chunk        height=3000 format=1 chunk=1 total=3
Fetching snapshot chunk        height=3000 format=1 chunk=2 total=3
Applied snapshot chunk         height=3000 format=1 chunk=0 total=3
Applied snapshot chunk         height=3000 format=1 chunk=1 total=3
Applied snapshot chunk         height=3000 format=1 chunk=2 total=3
Verified ABCI app              height=3000 appHash=F7D66BC9
Snapshot restored              height=3000 format=1 hash=0F14A473
Executed block                 height=3001 validTxs=16 invalidTxs=0
Committed state                height=3001 txs=16 appHash=0FDBB0D5F
Executed block                 height=3002 validTxs=25 invalidTxs=0
Committed state                height=3002 txs=25 appHash=40D12E4B3
</code></pre>
<p>節點現在狀態同步，在幾秒鐘內加入網絡</p>
<h3 id="_12">關閉狀態同步模式</h3>
<p>在節點完全同步後，使用此命令關閉狀態同步模式，以避免將來節點重新啟動時出現問題！</p>
<pre><code class="language-bash">sed -i.bak -E &quot;s|^(enable[[:space:]]+=[[:space:]]+).*$|\1false|&quot; $install_path/.stcd/config/config.toml
</code></pre>
<p>⚠️<strong>注意</strong> :本文檔中包含的信息來自 <a href="https://medium.com/@erikgrinaker">Erik Grinaker</a>，特別是他的狀態同步指南 <a href="https://medium.com/tendermint/tendermint-core-state-sync-for-developers-70a96ba3ee35">Tendermint Core</a> and the <a href="https://medium.com/cosmos-blockchain/cosmos-sdk-state-sync-guide-99e4cf43be2f">Cosmos SDK</a>.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51198bba.min.js"></script>
      
    
  </body>
</html>