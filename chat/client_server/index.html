
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../chat_doc/">
      
      
        <link rel="next" href="../server_server/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.4">
    
    
      
        <title>客戶端-服務端API - DAODST文檔</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bd3936ea.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#-" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DAODST文檔" class="md-header__button md-logo" aria-label="DAODST文檔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DAODST文檔
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              客戶端-服務端API
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="https://zh-tw.docs.daodst.com" hreflang="zh" class="md-select__link">
              中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="https://docs.daodst.com" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../protocol/account/" class="md-tabs__link">
          
  
  🔍協議

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../modules_accounts/" class="md-tabs__link">
          
  
  🧱模塊

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../gateway/run/" class="md-tabs__link">
          
  
  🏰網關和驗證器

        </a>
      </li>
    
  

    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../installation/" class="md-tabs__link">
          
  
  📞聊天

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../window/introduce/" class="md-tabs__link">
          
  
  ✈️跨鏈

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../faq/" class="md-tabs__link">
        
  
    
  
  📋常見問題

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DAODST文檔" class="md-nav__button md-logo" aria-label="DAODST文檔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    DAODST文檔
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    🔍協議
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            🔍協議
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/account/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    技術架構
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    命令行界面
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            命令行界面
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    安裝
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/single-node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    單節點
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/stcd/command/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CLI命令
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/account/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    帳號
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/chainid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    鏈ID
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/encode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    編碼
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/gas/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gas和手續費
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/keyring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    密鑰環
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/key-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    密鑰管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/state-migrate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    狀態導入導出
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/pending/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    等待隊列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/multsign/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    多簽
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/coin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    代幣
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../protocol/transfer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    交易
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    🧱模塊
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            🧱模塊
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules_accounts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    模塊賬號
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../evm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    以太坊虛擬機
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    聊天
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    網關
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../dao.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    去中心化组织
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../contract/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    合約
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../pledge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    聊天質押
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認證
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../bank/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    銀行
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gov/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    治理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../mint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    鑄造
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../distribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分配
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../slashing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    削減
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../staking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DPOS質押
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    🏰網關和驗證器
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            🏰網關和驗證器
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    設置和配寘
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            設置和配寘
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/run/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    運行驗證節點
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/validator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    管理驗證器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    配寘
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/disk-usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    硬碟使用優化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/state-sync/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    狀態同步
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/mempool/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    記憶體池
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常見問題
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    安全
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            安全
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    檢查清單
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/safe-node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    哨兵節點
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    陞級
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            陞級
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    概述
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/list/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    升級清單
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/hard-fork/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    硬分叉升級
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/auto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    自動升級
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/manual/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    手動升級
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/rollback/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    回滾
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../upgrade/template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    提案模板
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/testnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    測試網
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/mainnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主網
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    網關操作指南
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            網關操作指南
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/guide-linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    操作指南(linux)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/guide-win/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    操作指南(win)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../gateway/key-backup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    金鑰備份和恢復
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../ttts/ttts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    翻译和文本转语音服务
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    📞聊天
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            📞聊天
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    安裝啟動
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../chat_doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文檔
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    客戶端-服務端API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    客戶端-服務端API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1.接口标准
  </a>
  
    <nav class="md-nav" aria-label="1.接口标准">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1 标准错误响应
  </a>
  
    <nav class="md-nav" aria-label="1.1 标准错误响应">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111" class="md-nav__link">
    1.1.1 常见错误
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112" class="md-nav__link">
    1.1.2 其他错误代码
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2 交易标识符
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2.网页浏览器客户端
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3.服务器发现
  </a>
  
    <nav class="md-nav" aria-label="3.服务器发现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-well-known-uri" class="md-nav__link">
    3.1 Well-known URI
  </a>
  
    <nav class="md-nav" aria-label="3.1 Well-known URI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-well-knownmatrixclient" class="md-nav__link">
    GET /.well-known/matrix/client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientversions" class="md-nav__link">
    GET /_matrix/client/versions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. 客户端身份验证
  </a>
  
    <nav class="md-nav" aria-label="4. 客户端身份验证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1 使用访问令牌
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    4.2 访问令牌和设备之间的关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    4.3 刷新访问令牌
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    4.4 软注销
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-api" class="md-nav__link">
    4.5 用户交互式身份验证 API
  </a>
  
    <nav class="md-nav" aria-label="4.5 用户交互式身份验证 API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#451" class="md-nav__link">
    4.5.1 概述
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#452-rest-api-api" class="md-nav__link">
    4.5.2 REST API 中的用户交互式 API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#453" class="md-nav__link">
    4.5.3 例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#454" class="md-nav__link">
    4.5.4 身份验证类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#455" class="md-nav__link">
    4.5.5 后备
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46" class="md-nav__link">
    4.6 登录
  </a>
  
    <nav class="md-nav" aria-label="4.6 登录">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3login" class="md-nav__link">
    GET /_matrix/client/v3/login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3login" class="md-nav__link">
    POST /_matrix/client/v3/login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3refresh" class="md-nav__link">
    POST /_matrix/client/v3/refresh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3logout" class="md-nav__link">
    POST /_matrix/client/v3/logout
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3logoutall" class="md-nav__link">
    POST /_matrix/client/v3/logout/all
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#47" class="md-nav__link">
    4.7 帐户注册和管理
  </a>
  
    <nav class="md-nav" aria-label="4.7 帐户注册和管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3accountdeactivate" class="md-nav__link">
    POST /_matrix/client/v3/account/deactivate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3accountpassword" class="md-nav__link">
    POST /_matrix/client/v3/account/password
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3accountpasswordemailrequesttoken" class="md-nav__link">
    POST /_matrix/client/v3/account/password/email/requestToken
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3accountpasswordmsisdnrequesttoken" class="md-nav__link">
    POST /_matrix/client/v3/account/password/msisdn/requestToken
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3register" class="md-nav__link">
    POST /_matrix/client/v3/register
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3registeravailable" class="md-nav__link">
    GET /_matrix/client/v3/register/available
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3registeremailrequesttoken" class="md-nav__link">
    POST /_matrix/client/v3/register/email/requestToken
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3registermsisdnrequesttoken" class="md-nav__link">
    POST /_matrix/client/v3/register/msisdn/requestToken
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#48" class="md-nav__link">
    4.8 添加帳戶管理聯繫資訊
  </a>
  
    <nav class="md-nav" aria-label="4.8 添加帳戶管理聯繫資訊">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3account3pidunbind" class="md-nav__link">
    POST /_matrix/client/v3/account/3pid/unbind
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#49" class="md-nav__link">
    4.9 往來帳戶資訊
  </a>
  
    <nav class="md-nav" aria-label="4.9 往來帳戶資訊">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3accountwhoami" class="md-nav__link">
    GET /_matrix/client/v3/account/whoami
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#491" class="md-nav__link">
    4.9.1 有關身份伺服器的說明
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5. 能力協商
  </a>
  
    <nav class="md-nav" aria-label="5. 能力協商">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3capabilities" class="md-nav__link">
    GET /_matrix/client/v3/capabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#51-mchange_password" class="md-nav__link">
    5.1 m.change_password能力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-mroom_versions" class="md-nav__link">
    5.2 m.room_versions能力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-mset_displayname" class="md-nav__link">
    5.3 m.set_displayname能力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-mset_avatar_url" class="md-nav__link">
    5.4 m.set_avatar_url能力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-m3pid_changes" class="md-nav__link">
    5.5 m.3pid_changes能力
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6 濾波
  </a>
  
    <nav class="md-nav" aria-label="6 濾波">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    6.1 懶人裝載室成員
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    6.2 介面連接點
  </a>
  
    <nav class="md-nav" aria-label="6.2 介面連接點">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3useruseridfilter" class="md-nav__link">
    POST /_matrix/client/v3/user/{userId}/filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3useruseridfilterfilterid" class="md-nav__link">
    GET /_matrix/client/v3/user/{userId}/filter/{filterId}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    7 事件
  </a>
  
    <nav class="md-nav" aria-label="7 事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    7.1 房間活動的類型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    7.2 會議室事件格式
  </a>
  
    <nav class="md-nav" aria-label="7.2 會議室事件格式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clientevent" class="md-nav__link">
    ClientEvent
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    7.3 剝離狀態
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74" class="md-nav__link">
    7.4 大小限制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75" class="md-nav__link">
    7.5 會議室活動
  </a>
  
    <nav class="md-nav" aria-label="7.5 會議室活動">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mroomcanonical_alias" class="md-nav__link">
    m.room.canonical_alias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mroomcreate" class="md-nav__link">
    m.room.create
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mroomjoin_rules" class="md-nav__link">
    m.room.join_rules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mroommember" class="md-nav__link">
    m.room.member
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mroompower_levels" class="md-nav__link">
    m.room.power_levels
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#751" class="md-nav__link">
    7.5.1 歷史事件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76" class="md-nav__link">
    7.6 同步
  </a>
  
    <nav class="md-nav" aria-label="7.6 同步">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3sync" class="md-nav__link">
    GET /_matrix/client/v3/sync
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#77" class="md-nav__link">
    7.7 獲取聊天室的事件
  </a>
  
    <nav class="md-nav" aria-label="7.7 獲取聊天室的事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomideventeventid" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/event/{eventId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidjoined_members" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/joined_members
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidmembers" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/members
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidstate" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidstateeventtypestatekey" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/state/{eventType}/{stateKey}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidmessages" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv1roomsroomidtimestamp_to_event" class="md-nav__link">
    GET /_matrix/client/v1/rooms/{roomId}/timestamp_to_event
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#78" class="md-nav__link">
    7.8 將事件發送到聊天室
  </a>
  
    <nav class="md-nav" aria-label="7.8 將事件發送到聊天室">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3roomsroomidstateeventtypestatekey" class="md-nav__link">
    PUT /_matrix/client/v3/rooms/{roomId}/state/{eventType}/{stateKey}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3roomsroomidsendeventtypetxnid" class="md-nav__link">
    PUT /_matrix/client/v3/rooms/{roomId}/send/{eventType}/{txnId}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#79" class="md-nav__link">
    7.9 密文
  </a>
  
    <nav class="md-nav" aria-label="7.9 密文">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#791" class="md-nav__link">
    7.9.1 事件
  </a>
  
    <nav class="md-nav" aria-label="7.9.1 事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mroomredaction" class="md-nav__link">
    m.room.redaction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#792" class="md-nav__link">
    7.9.2 客戶端行為
  </a>
  
    <nav class="md-nav" aria-label="7.9.2 客戶端行為">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3roomsroomidredacteventidtxnid" class="md-nav__link">
    PUT /_matrix/client/v3/rooms/{roomId}/redact/{eventId}/{txnId}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#710" class="md-nav__link">
    7.10 在事件之間形成關係
  </a>
  
    <nav class="md-nav" aria-label="7.10 在事件之間形成關係">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mrelates_to" class="md-nav__link">
    m.relates_to
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7101" class="md-nav__link">
    7.10.1 關係類型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7102" class="md-nav__link">
    7.10.2 子事件的聚合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7103" class="md-nav__link">
    7.10.3 關係介面
  </a>
  
    <nav class="md-nav" aria-label="7.10.3 關係介面">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv1roomsroomidrelationseventid" class="md-nav__link">
    GET /_matrix/client/v1/rooms/{roomId}/relations/{eventId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv1roomsroomidrelationseventidreltype" class="md-nav__link">
    GET /_matrix/client/v1/rooms/{roomId}/relations/{eventId}/{relType}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv1roomsroomidrelationseventidreltypeeventtype" class="md-nav__link">
    GET /_matrix/client/v1/rooms/{roomId}/relations/{eventId}/{relType}/{eventType}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    8 房間
  </a>
  
    <nav class="md-nav" aria-label="8 房間">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81" class="md-nav__link">
    8.1 類型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82" class="md-nav__link">
    8.2 創造
  </a>
  
    <nav class="md-nav" aria-label="8.2 創造">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3createroom" class="md-nav__link">
    POST /_matrix/client/v3/createRoom
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3directoryroomroomalias" class="md-nav__link">
    GET /_matrix/client/v3/directory/room/{roomAlias}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3directoryroomroomalias" class="md-nav__link">
    PUT /_matrix/client/v3/directory/room/{roomAlias}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-_matrixclientv3directoryroomroomalias" class="md-nav__link">
    DELETE /_matrix/client/v3/directory/room/{roomAlias}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidaliases" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/aliases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84" class="md-nav__link">
    8.4 許可權
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#85" class="md-nav__link">
    8.5 檔室成員資格
  </a>
  
    <nav class="md-nav" aria-label="8.5 檔室成員資格">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3joined_rooms" class="md-nav__link">
    GET /_matrix/client/v3/joined_rooms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#851" class="md-nav__link">
    8.5.1 連接房間
  </a>
  
    <nav class="md-nav" aria-label="8.5.1 連接房間">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidinvite" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/invite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3joinroomidoralias" class="md-nav__link">
    POST /_matrix/client/v3/join/{roomIdOrAlias}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidjoin" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/join
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#852" class="md-nav__link">
    8.5.2 離開房間
  </a>
  
    <nav class="md-nav" aria-label="8.5.2 離開房間">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidforget" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/forget
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidleave" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/leave
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidkick" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/kick
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#86" class="md-nav__link">
    8.6 列出房間
  </a>
  
    <nav class="md-nav" aria-label="8.6 列出房間">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3directorylistroomroomid" class="md-nav__link">
    GET /_matrix/client/v3/directory/list/room/{roomId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3directorylistroomroomid" class="md-nav__link">
    PUT /_matrix/client/v3/directory/list/room/{roomId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3publicrooms" class="md-nav__link">
    GET /_matrix/client/v3/publicRooms
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    9 用戶數據
  </a>
  
    <nav class="md-nav" aria-label="9 用戶數據">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91" class="md-nav__link">
    9.1 用戶目錄
  </a>
  
    <nav class="md-nav" aria-label="9.1 用戶目錄">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3user_directorysearch" class="md-nav__link">
    POST /_matrix/client/v3/user_directory/search
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92" class="md-nav__link">
    9.2 配置 檔
  </a>
  
    <nav class="md-nav" aria-label="9.2 配置 檔">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3profileuserid" class="md-nav__link">
    GET /_matrix/client/v3/profile/{userId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3profileuseridavatar_url" class="md-nav__link">
    GET /_matrix/client/v3/profile/{userId}/avatar_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3profileuseridavatar_url" class="md-nav__link">
    PUT /_matrix/client/v3/profile/{userId}/avatar_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3profileuseriddisplayname" class="md-nav__link">
    GET /_matrix/client/v3/profile/{userId}/displayname
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3profileuseriddisplayname" class="md-nav__link">
    PUT /_matrix/client/v3/profile/{userId}/displayname
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#921" class="md-nav__link">
    9.2.1 個人資料資訊變更事件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    10 安全
  </a>
  
    <nav class="md-nav" aria-label="10 安全">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101" class="md-nav__link">
    10.1 速率限制
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11_1" class="md-nav__link">
    11 模組
  </a>
  
    <nav class="md-nav" aria-label="11 模組">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111_1" class="md-nav__link">
    11.1 功能配置檔
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112_1" class="md-nav__link">
    11.2 即時通訊
  </a>
  
    <nav class="md-nav" aria-label="11.2 即時通訊">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1121" class="md-nav__link">
    11.2.1 事件
  </a>
  
    <nav class="md-nav" aria-label="11.2.1 事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mroommessage" class="md-nav__link">
    m.room.message
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1122" class="md-nav__link">
    11.2.2 客戶端行為
  </a>
  
    <nav class="md-nav" aria-label="11.2.2 客戶端行為">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    發送消息時的建議
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    本地回聲
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    計算使用者的顯示名稱
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    使用消息顯示成員身份資訊
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    計算聊天室的顯示名稱
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    劇透消息
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    伺服器行為
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    安全注意事項
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113" class="md-nav__link">
    11.3 豐富的回復
  </a>
  
    <nav class="md-nav" aria-label="11.3 豐富的回復">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    豐富回復的回退
  </a>
  
    <nav class="md-nav" aria-label="豐富回復的回退">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    剝離回退
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mtextmnotice" class="md-nav__link">
    "m.text"、"m.notice"和無法識別的消息類型的回退
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memote" class="md-nav__link">
    "m.emote"的回退
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimagemvideomaudiomfile" class="md-nav__link">
    "m.image"、"m.video"、"m.audio"和"m.file"的回退
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-ip" class="md-nav__link">
    11.4 IP 語音
  </a>
  
    <nav class="md-nav" aria-label="11.4 IP 語音">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1141" class="md-nav__link">
    11.4.1 事件
  </a>
  
    <nav class="md-nav" aria-label="11.4.1 事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mcallanswer" class="md-nav__link">
    m.call.answer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    客戶端行為
  </a>
  
    <nav class="md-nav" aria-label="客戶端行為">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    眩光
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1143" class="md-nav__link">
    11.4.3 伺服器行為
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1144" class="md-nav__link">
    11.4.4 安全注意事項
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115" class="md-nav__link">
    11.5 鍵入通知
  </a>
  
    <nav class="md-nav" aria-label="11.5 鍵入通知">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    事件
  </a>
  
    <nav class="md-nav" aria-label="事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mtyping" class="md-nav__link">
    m.typing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    客戶端行為
  </a>
  
    <nav class="md-nav" aria-label="客戶端行為">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3roomsroomidtypinguserid" class="md-nav__link">
    PUT /_matrix/client/v3/rooms/{roomId}/typing/{userId}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    安全注意事項
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#116" class="md-nav__link">
    11.6 收據
  </a>
  
    <nav class="md-nav" aria-label="11.6 收據">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    事件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mreceipt" class="md-nav__link">
    m.receipt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    客戶端行為
  </a>
  
    <nav class="md-nav" aria-label="客戶端行為">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidreceiptreceipttypeeventid" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/receipt/{receiptType}/{eventId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    私人已讀回執
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    線程式讀回執
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    伺服器行為
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    安全注意事項
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../server_server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    服務端-服務端API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../customise_doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    定制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../voip_signaling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    呼叫流程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../optional_cfg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    可選配置*
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    常見問題
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    ✈️跨鏈
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            ✈️跨鏈
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    賣家跨鏈桌面程序
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            賣家跨鏈桌面程序
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../window/introduce/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    介紹
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../window/info/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用說明
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    📋常見問題
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1.接口标准
  </a>
  
    <nav class="md-nav" aria-label="1.接口标准">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    1.1 标准错误响应
  </a>
  
    <nav class="md-nav" aria-label="1.1 标准错误响应">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111" class="md-nav__link">
    1.1.1 常见错误
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112" class="md-nav__link">
    1.1.2 其他错误代码
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12" class="md-nav__link">
    1.2 交易标识符
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2.网页浏览器客户端
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3.服务器发现
  </a>
  
    <nav class="md-nav" aria-label="3.服务器发现">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-well-known-uri" class="md-nav__link">
    3.1 Well-known URI
  </a>
  
    <nav class="md-nav" aria-label="3.1 Well-known URI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-well-knownmatrixclient" class="md-nav__link">
    GET /.well-known/matrix/client
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientversions" class="md-nav__link">
    GET /_matrix/client/versions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4. 客户端身份验证
  </a>
  
    <nav class="md-nav" aria-label="4. 客户端身份验证">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1 使用访问令牌
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    4.2 访问令牌和设备之间的关系
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    4.3 刷新访问令牌
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#44" class="md-nav__link">
    4.4 软注销
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#45-api" class="md-nav__link">
    4.5 用户交互式身份验证 API
  </a>
  
    <nav class="md-nav" aria-label="4.5 用户交互式身份验证 API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#451" class="md-nav__link">
    4.5.1 概述
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#452-rest-api-api" class="md-nav__link">
    4.5.2 REST API 中的用户交互式 API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#453" class="md-nav__link">
    4.5.3 例
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#454" class="md-nav__link">
    4.5.4 身份验证类型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#455" class="md-nav__link">
    4.5.5 后备
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#46" class="md-nav__link">
    4.6 登录
  </a>
  
    <nav class="md-nav" aria-label="4.6 登录">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3login" class="md-nav__link">
    GET /_matrix/client/v3/login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3login" class="md-nav__link">
    POST /_matrix/client/v3/login
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3refresh" class="md-nav__link">
    POST /_matrix/client/v3/refresh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3logout" class="md-nav__link">
    POST /_matrix/client/v3/logout
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3logoutall" class="md-nav__link">
    POST /_matrix/client/v3/logout/all
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#47" class="md-nav__link">
    4.7 帐户注册和管理
  </a>
  
    <nav class="md-nav" aria-label="4.7 帐户注册和管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3accountdeactivate" class="md-nav__link">
    POST /_matrix/client/v3/account/deactivate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3accountpassword" class="md-nav__link">
    POST /_matrix/client/v3/account/password
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3accountpasswordemailrequesttoken" class="md-nav__link">
    POST /_matrix/client/v3/account/password/email/requestToken
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3accountpasswordmsisdnrequesttoken" class="md-nav__link">
    POST /_matrix/client/v3/account/password/msisdn/requestToken
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3register" class="md-nav__link">
    POST /_matrix/client/v3/register
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3registeravailable" class="md-nav__link">
    GET /_matrix/client/v3/register/available
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3registeremailrequesttoken" class="md-nav__link">
    POST /_matrix/client/v3/register/email/requestToken
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3registermsisdnrequesttoken" class="md-nav__link">
    POST /_matrix/client/v3/register/msisdn/requestToken
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#48" class="md-nav__link">
    4.8 添加帳戶管理聯繫資訊
  </a>
  
    <nav class="md-nav" aria-label="4.8 添加帳戶管理聯繫資訊">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3account3pidunbind" class="md-nav__link">
    POST /_matrix/client/v3/account/3pid/unbind
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#49" class="md-nav__link">
    4.9 往來帳戶資訊
  </a>
  
    <nav class="md-nav" aria-label="4.9 往來帳戶資訊">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3accountwhoami" class="md-nav__link">
    GET /_matrix/client/v3/account/whoami
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#491" class="md-nav__link">
    4.9.1 有關身份伺服器的說明
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    5. 能力協商
  </a>
  
    <nav class="md-nav" aria-label="5. 能力協商">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3capabilities" class="md-nav__link">
    GET /_matrix/client/v3/capabilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#51-mchange_password" class="md-nav__link">
    5.1 m.change_password能力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-mroom_versions" class="md-nav__link">
    5.2 m.room_versions能力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-mset_displayname" class="md-nav__link">
    5.3 m.set_displayname能力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-mset_avatar_url" class="md-nav__link">
    5.4 m.set_avatar_url能力
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-m3pid_changes" class="md-nav__link">
    5.5 m.3pid_changes能力
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6 濾波
  </a>
  
    <nav class="md-nav" aria-label="6 濾波">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61" class="md-nav__link">
    6.1 懶人裝載室成員
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62" class="md-nav__link">
    6.2 介面連接點
  </a>
  
    <nav class="md-nav" aria-label="6.2 介面連接點">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3useruseridfilter" class="md-nav__link">
    POST /_matrix/client/v3/user/{userId}/filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3useruseridfilterfilterid" class="md-nav__link">
    GET /_matrix/client/v3/user/{userId}/filter/{filterId}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    7 事件
  </a>
  
    <nav class="md-nav" aria-label="7 事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71" class="md-nav__link">
    7.1 房間活動的類型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    7.2 會議室事件格式
  </a>
  
    <nav class="md-nav" aria-label="7.2 會議室事件格式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clientevent" class="md-nav__link">
    ClientEvent
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    7.3 剝離狀態
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74" class="md-nav__link">
    7.4 大小限制
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75" class="md-nav__link">
    7.5 會議室活動
  </a>
  
    <nav class="md-nav" aria-label="7.5 會議室活動">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mroomcanonical_alias" class="md-nav__link">
    m.room.canonical_alias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mroomcreate" class="md-nav__link">
    m.room.create
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mroomjoin_rules" class="md-nav__link">
    m.room.join_rules
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mroommember" class="md-nav__link">
    m.room.member
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mroompower_levels" class="md-nav__link">
    m.room.power_levels
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#751" class="md-nav__link">
    7.5.1 歷史事件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76" class="md-nav__link">
    7.6 同步
  </a>
  
    <nav class="md-nav" aria-label="7.6 同步">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3sync" class="md-nav__link">
    GET /_matrix/client/v3/sync
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#77" class="md-nav__link">
    7.7 獲取聊天室的事件
  </a>
  
    <nav class="md-nav" aria-label="7.7 獲取聊天室的事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomideventeventid" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/event/{eventId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidjoined_members" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/joined_members
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidmembers" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/members
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidstate" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidstateeventtypestatekey" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/state/{eventType}/{stateKey}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidmessages" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv1roomsroomidtimestamp_to_event" class="md-nav__link">
    GET /_matrix/client/v1/rooms/{roomId}/timestamp_to_event
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#78" class="md-nav__link">
    7.8 將事件發送到聊天室
  </a>
  
    <nav class="md-nav" aria-label="7.8 將事件發送到聊天室">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3roomsroomidstateeventtypestatekey" class="md-nav__link">
    PUT /_matrix/client/v3/rooms/{roomId}/state/{eventType}/{stateKey}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3roomsroomidsendeventtypetxnid" class="md-nav__link">
    PUT /_matrix/client/v3/rooms/{roomId}/send/{eventType}/{txnId}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#79" class="md-nav__link">
    7.9 密文
  </a>
  
    <nav class="md-nav" aria-label="7.9 密文">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#791" class="md-nav__link">
    7.9.1 事件
  </a>
  
    <nav class="md-nav" aria-label="7.9.1 事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mroomredaction" class="md-nav__link">
    m.room.redaction
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#792" class="md-nav__link">
    7.9.2 客戶端行為
  </a>
  
    <nav class="md-nav" aria-label="7.9.2 客戶端行為">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3roomsroomidredacteventidtxnid" class="md-nav__link">
    PUT /_matrix/client/v3/rooms/{roomId}/redact/{eventId}/{txnId}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#710" class="md-nav__link">
    7.10 在事件之間形成關係
  </a>
  
    <nav class="md-nav" aria-label="7.10 在事件之間形成關係">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mrelates_to" class="md-nav__link">
    m.relates_to
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7101" class="md-nav__link">
    7.10.1 關係類型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7102" class="md-nav__link">
    7.10.2 子事件的聚合
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7103" class="md-nav__link">
    7.10.3 關係介面
  </a>
  
    <nav class="md-nav" aria-label="7.10.3 關係介面">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv1roomsroomidrelationseventid" class="md-nav__link">
    GET /_matrix/client/v1/rooms/{roomId}/relations/{eventId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv1roomsroomidrelationseventidreltype" class="md-nav__link">
    GET /_matrix/client/v1/rooms/{roomId}/relations/{eventId}/{relType}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv1roomsroomidrelationseventidreltypeeventtype" class="md-nav__link">
    GET /_matrix/client/v1/rooms/{roomId}/relations/{eventId}/{relType}/{eventType}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    8 房間
  </a>
  
    <nav class="md-nav" aria-label="8 房間">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#81" class="md-nav__link">
    8.1 類型
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#82" class="md-nav__link">
    8.2 創造
  </a>
  
    <nav class="md-nav" aria-label="8.2 創造">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3createroom" class="md-nav__link">
    POST /_matrix/client/v3/createRoom
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3directoryroomroomalias" class="md-nav__link">
    GET /_matrix/client/v3/directory/room/{roomAlias}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3directoryroomroomalias" class="md-nav__link">
    PUT /_matrix/client/v3/directory/room/{roomAlias}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-_matrixclientv3directoryroomroomalias" class="md-nav__link">
    DELETE /_matrix/client/v3/directory/room/{roomAlias}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3roomsroomidaliases" class="md-nav__link">
    GET /_matrix/client/v3/rooms/{roomId}/aliases
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#84" class="md-nav__link">
    8.4 許可權
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#85" class="md-nav__link">
    8.5 檔室成員資格
  </a>
  
    <nav class="md-nav" aria-label="8.5 檔室成員資格">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3joined_rooms" class="md-nav__link">
    GET /_matrix/client/v3/joined_rooms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#851" class="md-nav__link">
    8.5.1 連接房間
  </a>
  
    <nav class="md-nav" aria-label="8.5.1 連接房間">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidinvite" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/invite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3joinroomidoralias" class="md-nav__link">
    POST /_matrix/client/v3/join/{roomIdOrAlias}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidjoin" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/join
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#852" class="md-nav__link">
    8.5.2 離開房間
  </a>
  
    <nav class="md-nav" aria-label="8.5.2 離開房間">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidforget" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/forget
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidleave" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/leave
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidkick" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/kick
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#86" class="md-nav__link">
    8.6 列出房間
  </a>
  
    <nav class="md-nav" aria-label="8.6 列出房間">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3directorylistroomroomid" class="md-nav__link">
    GET /_matrix/client/v3/directory/list/room/{roomId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3directorylistroomroomid" class="md-nav__link">
    PUT /_matrix/client/v3/directory/list/room/{roomId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3publicrooms" class="md-nav__link">
    GET /_matrix/client/v3/publicRooms
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    9 用戶數據
  </a>
  
    <nav class="md-nav" aria-label="9 用戶數據">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#91" class="md-nav__link">
    9.1 用戶目錄
  </a>
  
    <nav class="md-nav" aria-label="9.1 用戶目錄">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3user_directorysearch" class="md-nav__link">
    POST /_matrix/client/v3/user_directory/search
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#92" class="md-nav__link">
    9.2 配置 檔
  </a>
  
    <nav class="md-nav" aria-label="9.2 配置 檔">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3profileuserid" class="md-nav__link">
    GET /_matrix/client/v3/profile/{userId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3profileuseridavatar_url" class="md-nav__link">
    GET /_matrix/client/v3/profile/{userId}/avatar_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3profileuseridavatar_url" class="md-nav__link">
    PUT /_matrix/client/v3/profile/{userId}/avatar_url
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-_matrixclientv3profileuseriddisplayname" class="md-nav__link">
    GET /_matrix/client/v3/profile/{userId}/displayname
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3profileuseriddisplayname" class="md-nav__link">
    PUT /_matrix/client/v3/profile/{userId}/displayname
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#921" class="md-nav__link">
    9.2.1 個人資料資訊變更事件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    10 安全
  </a>
  
    <nav class="md-nav" aria-label="10 安全">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#101" class="md-nav__link">
    10.1 速率限制
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#11_1" class="md-nav__link">
    11 模組
  </a>
  
    <nav class="md-nav" aria-label="11 模組">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111_1" class="md-nav__link">
    11.1 功能配置檔
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#112_1" class="md-nav__link">
    11.2 即時通訊
  </a>
  
    <nav class="md-nav" aria-label="11.2 即時通訊">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1121" class="md-nav__link">
    11.2.1 事件
  </a>
  
    <nav class="md-nav" aria-label="11.2.1 事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mroommessage" class="md-nav__link">
    m.room.message
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1122" class="md-nav__link">
    11.2.2 客戶端行為
  </a>
  
    <nav class="md-nav" aria-label="11.2.2 客戶端行為">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    發送消息時的建議
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    本地回聲
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    計算使用者的顯示名稱
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    使用消息顯示成員身份資訊
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    計算聊天室的顯示名稱
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    劇透消息
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    伺服器行為
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    安全注意事項
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#113" class="md-nav__link">
    11.3 豐富的回復
  </a>
  
    <nav class="md-nav" aria-label="11.3 豐富的回復">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    豐富回復的回退
  </a>
  
    <nav class="md-nav" aria-label="豐富回復的回退">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    剝離回退
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mtextmnotice" class="md-nav__link">
    "m.text"、"m.notice"和無法識別的消息類型的回退
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memote" class="md-nav__link">
    "m.emote"的回退
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mimagemvideomaudiomfile" class="md-nav__link">
    "m.image"、"m.video"、"m.audio"和"m.file"的回退
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#114-ip" class="md-nav__link">
    11.4 IP 語音
  </a>
  
    <nav class="md-nav" aria-label="11.4 IP 語音">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1141" class="md-nav__link">
    11.4.1 事件
  </a>
  
    <nav class="md-nav" aria-label="11.4.1 事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mcallanswer" class="md-nav__link">
    m.call.answer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    客戶端行為
  </a>
  
    <nav class="md-nav" aria-label="客戶端行為">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    眩光
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1143" class="md-nav__link">
    11.4.3 伺服器行為
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1144" class="md-nav__link">
    11.4.4 安全注意事項
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#115" class="md-nav__link">
    11.5 鍵入通知
  </a>
  
    <nav class="md-nav" aria-label="11.5 鍵入通知">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    事件
  </a>
  
    <nav class="md-nav" aria-label="事件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mtyping" class="md-nav__link">
    m.typing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    客戶端行為
  </a>
  
    <nav class="md-nav" aria-label="客戶端行為">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#put-_matrixclientv3roomsroomidtypinguserid" class="md-nav__link">
    PUT /_matrix/client/v3/rooms/{roomId}/typing/{userId}
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    安全注意事項
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#116" class="md-nav__link">
    11.6 收據
  </a>
  
    <nav class="md-nav" aria-label="11.6 收據">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    事件
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mreceipt" class="md-nav__link">
    m.receipt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    客戶端行為
  </a>
  
    <nav class="md-nav" aria-label="客戶端行為">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#post-_matrixclientv3roomsroomidreceiptreceipttypeeventid" class="md-nav__link">
    POST /_matrix/client/v3/rooms/{roomId}/receipt/{receiptType}/{eventId}
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    私人已讀回執
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    線程式讀回執
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    伺服器行為
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    安全注意事項
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="-">客户端-服务器接口</h1>
<hr />
<p>客户端-服务器 API 允许客户端 发送消息,控制房间和同步对话历史记录。是的 旨在支持不存储状态的轻量级客户端和 根据需要从服务器延迟加载数据 - 以及重量级数据 维护服务器状态的完整本地持久副本的客户端。</p>
<h2 id="1">1.接口标准</h2>
<p>Matrix 中客户端-服务器通信的强制基线是 通过 HTTP API 交换 JSON 对象。更高效的运输可能是 将来指定为可选扩展。</p>
<p>建议使用 HTTPS 进行通信。使用纯 HTTP 不是 推荐的外部测试环境。</p>
<p>客户端使用不透明字符串access_token进行身份验证。</p>
<p>所有和端点,除了 POST /_matrix/media/v3/upload 和 PUT /_matrix/media/v3/upload/{serverName}/{mediaId}, 要求客户端提供包含（可能为空）的请求正文POST
JSON 对象。客户端应为具有PUT JSON 正文的所有请求提供标头Content-Type application/json,但这不是必需的。</p>
<p>同样,所有端点都要求服务器返回 JSON 对象, 除了对 GET /<em>matrix/media/v200/download/{serverName}/{mediaId} 和 GET /</em>
matrix/media/v3/thumbnail/{serverName}/{mediaId} 的 3 个响应。 服务器必须包含所有 JSON 响应的标头。Content-Typeapplication/json</p>
<p>请求或响应中的所有 JSON 数据都必须使用 UTF-8 进行编码。</p>
<p>另请参阅附录中的矩阵 API 约定,了解所有矩阵 API 应遵循的约定, 和下面的 Web 浏览器客户端以获取其他 服务器响应的要求。</p>
<h3 id="11">1.1 标准错误响应</h3>
<p>在矩阵API级别发生的任何错误都必须返回"标准" 错误响应"。这是一个 JSON 对象,如下所示:</p>
<pre><code class="language-json">{
  &quot;errcode&quot;: &quot;&lt;error code&gt;&quot;,
  &quot;error&quot;: &quot;&lt;error message&gt;&quot;
}
</code></pre>
<p>该字符串将是人类可读的错误消息,通常为 解释出了什么问题的句子。error</p>
<p>该字符串将是一个唯一的字符串,可用于处理 错误消息,例如 .错误代码应具有其命名空间 在所有大写字母中首先,然后是单个.例如,如果有自定义 命名空间和代码,错误代码应 肖。由此定义的错误代码
规范应该开始。errcodeM_FORBIDDEN_com.mydomain.hereFORBIDDENCOM.MYDOMAIN.HERE_FORBIDDENM_</p>
<p>一些定义了错误中应该存在的其他键 响应对象,但键和必须始终存在。errcodeerrorerrcode</p>
<p>错误通常最好由其错误代码表示,而不是 返回的 HTTP 状态代码。遇到错误码时, 客户端应首选 HTTP 状态代码作为更可靠的参考 问题是什么。例如,如果客户端收到错误 的代码,但请求给出了 400 错误请求状态
代码,客户端应将错误视为资源不是 发现。但是,如果客户端收到错误代码 400 错误请求,则客户端应假定 请求无效。M_UNKNOWNM_NOT_FOUNDM_UNKNOWN</p>
<h4 id="111">1.1.1 常见错误</h4>
<p>任何 API 端点都可以返回这些错误代码:</p>
<p>M_FORBIDDEN禁止访问,例如未经许可加入房间,登录失败。</p>
<p>M_UNKNOWN_TOKEN无法识别指定的访问或刷新令牌。</p>
<p>其他响应参数 上可能存在 响应 401 HTTP 状态代码。查看软注销 部分了解更多信息。soft_logout</p>
<p>M_MISSING_TOKEN没有为请求指定访问令牌。</p>
<p>M_BAD_JSON请求包含有效的 JSON,但格式以某种方式不正确,例如 缺少必需的键,键的值无效。</p>
<p>M_NOT_JSON请求不包含有效的 JSON。</p>
<p>M_NOT_FOUND找不到此请求的资源。</p>
<p>M_LIMIT_EXCEEDED在短时间内发送了太多请求。稍等片刻 然后重试。</p>
<p>M_UNRECOGNIZED服务器无法理解该请求。预计这将返回 404 HTTP 状态代码（如果终结点未实现）或 405 HTTP 状态 代码（如果终结点已实现,但使用了不正确的 HTTP 方法）。</p>
<p>M_UNKNOWN发生未知错误。</p>
<h4 id="112">1.1.2 其他错误代码</h4>
<p>以下错误代码特定于某些终结点。</p>
<p>M_UNAUTHORIZED请求未正确授权。通常是由于登录失败。</p>
<p>M_USER_DEACTIVATED与请求关联的用户标识已被停用。通常 对于证明身份验证的终结点,例如 。/login</p>
<p>M_USER_IN_USE尝试注册已占用的用户 ID 时遇到此问题。</p>
<p>M_INVALID_USERNAME尝试注册无效的用户 ID 时遇到。</p>
<p>M_ROOM_IN_USE当提供给 API 的房间别名已在 中时发送 用。createRoom</p>
<p>M_INVALID_ROOM_STATE当提供给 API 的初始状态无效时发送。createRoom</p>
<p>M_THREEPID_IN_USE当提供给 API 的三pid 无法使用时发送,因为相同 三PID已经在使用中。</p>
<p>M_THREEPID_NOT_FOUND当提供给 API 的三 pid 由于没有记录而无法使用时发送 找到了匹配的三皮。</p>
<p>M_THREEPID_AUTH_FAILED无法对第三方标识符执行身份验证。</p>
<p>M_THREEPID_DENIED服务器不允许使用此第三方标识符。这可能会发生 例如,如果服务器只允许来自 特定域。</p>
<p>M_SERVER_NOT_TRUSTED客户端的请求使用了第三方服务器,例如身份服务器, 此服务器不信任。</p>
<p>M_UNSUPPORTED_ROOM_VERSION客户端创建房间的请求使用了 服务器不支持。</p>
<p>M_INCOMPATIBLE_ROOM_VERSION客户端尝试加入具有服务器版本的文件室 不支持。检查错误响应的属性 对于房间的版本。room_version</p>
<p>M_BAD_STATE无法执行请求的状态更改,例如尝试 取消禁止未被禁止的用户。</p>
<p>M_GUEST_ACCESS_FORBIDDEN客房或资源不允许客人访问。</p>
<p>M_CAPTCHA_NEEDED需要验证码才能完成请求。</p>
<p>M_CAPTCHA_INVALID提供的验证码与预期不符。</p>
<p>M_MISSING_PARAM请求中缺少必需参数。</p>
<p>M_INVALID_PARAM指定的参数具有错误的值。例如, 服务器需要一个整数,而是收到一个字符串。</p>
<p>M_TOO_LARGE请求或实体太大。</p>
<p>M_EXCLUSIVE请求的资源由应用程序服务保留,或者 发出请求的应用程序服务尚未创建资源。</p>
<p>M_RESOURCE_LIMIT_EXCEEDED无法完成请求,因为主服务器已达到 对其施加的资源限制。例如,共享中保存的家庭服务器 如果托管环境也开始使用,则可能会达到资源限制 大量内存或磁盘空间。错误必须有一个字段
为收到错误的用户提供一个可以联系的地方。 通常,此错误将出现在尝试修改的路由上 状态（例如:发送消息,帐户数据等）而不是路由 仅读取状态（例如:,获取帐户数据等）。admin_contact/sync</p>
<p>M_CANNOT_LEAVE_SERVER_NOTICE_ROOM用户无法拒绝加入服务器通知室的邀请。 有关详细信息,请参阅服务器通知模块。</p>
<h3 id="12">1.2 交易标识符</h3>
<p>客户端-服务器 API 通常用于提交请求 HTTP 路径中客户端生成的事务标识符。HTTP PUT</p>
<p>事务 ID 的目的是允许主服务器区分 来自先前请求的重新传输的新请求,以便它可以发出 请求幂等。</p>
<p>交易 ID 只能用于此目的。</p>
<p>从客户端的角度来看,在请求完成后,应为下一个请求更改值（未指定 how;a 建议单调递增整数）。{txnId}</p>
<p>如果 事务 ID 与上一个请求相同,并且 HTTP 请求是相同的。</p>
<p>如果已识别出重传,则主服务器应返回 与原始请求相同的 HTTP 响应代码和内容。 例如,将返回一个 与原始请求 响应正文。PUT /_
matrix/client/v3/rooms/{roomId}/send/{eventType}/{txnId}200 OKevent_id</p>
<p>除了 HTTP 路径,事务 ID 的作用域是"客户端" 会话",其中该会话由特定访问令牌标识。 刷新访问令牌时, 保留事务 ID 的范围。这意味着如果客户端 令牌用作其事务 ID,将令牌刷新为 ,并再次使用它,这将被假定为重复请求
并被忽略。如果客户端注销并在 和 令牌之间重新注销,则可以为每个令牌使用一次。ATXN1BTXN1ABTXN1</p>
<p>某些 API 端点可能允许或要求使用请求 没有交易 ID。如果这是可选的,强烈建议使用请求。POSTPUT</p>
<h2 id="2">2.网页浏览器客户端</h2>
<p>期望某些客户端将被写入以运行是现实的 在 Web 浏览器或类似环境中。在这些情况下, 主服务器应响应飞行前请求并提供跨源 所有请求上的资源共享 （CORS） 标头。</p>
<p>服务器必须期望客户端会通过请求接近它们,从而允许客户端发现 CORS 标头。所有端点 在此规范中支持该方法,但是服务器 在接近端点时,不得执行为端点定义的任何逻辑 与请求。OPTIONSOPTIONSOPTIONS</p>
<p>当客户端向服务器发出请求时,服务器应 使用该路由的 CORS 标头进行响应。推荐的可替代资源保护计划 服务器在所有请求上返回的标头包括:</p>
<pre><code class="language-yaml">    Access-Control-Allow-Origin: *
    Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
    Access-Control-Allow-Headers: X-Requested-With, Content-Type, Authorization
</code></pre>
<h2 id="3">3.服务器发现</h2>
<p>为了允许用户连接到矩阵服务器而无需 显式指定主服务器的 URL 或其他参数,客户端 应使用自动发现机制来确定服务器的 URL 基于用户的矩阵 ID。自动发现只能在登录时完成 时间。</p>
<p>在本节中,以下术语具有特定含义:</p>
<p>PROMPT从用户那里检索特定信息的方式 适合现有的客户端用户体验（如果客户端是 倾向于这样做。如果没有好的用户,则可能会发生故障 在这一点上,这方面的经验是可能的。</p>
<p>IGNORE停止当前的自动发现机制。如果没有更多的自动发现 机制是可用的,那么客户端可以使用其他方法 确定所需的参数,例如提示用户,或 使用默认值。</p>
<p>FAIL_PROMPT通知用户自动发现由于数据无效/空和参数而失败。PROMPT</p>
<p>FAIL_ERROR通知用户自动发现未返回任何可用的 URL。做 不要继续当前登录过程。此时, 已获取有效数据,但没有服务器可用于为客户端提供服务。 不应尝试进一步猜测,用户应进行 认真决定下一步该做什么。</p>
<h3 id="31-well-known-uri">3.1 Well-known URI</h3>
<p>该方法使用预定位置的 JSON 文件来 指定参数值。此方法的流程如下:.well-known</p>
<ol>
<li>通过拆分 第一个冒号处的矩阵 ID。</li>
<li>从服务器名称中提取主机名。</li>
<li>向 发出 GET 请求。https://hostname/.well-known/matrix/client<ol>
<li>如果返回的状态代码为 404,则 .IGNORE</li>
<li>如果返回的状态代码不是 200,或者响应正文为 空的,然后.FAIL_PROMPT</li>
<li>将响应正文解析为 JSON 对象<ol>
<li>如果无法解析内容,则 .FAIL_PROMPT</li>
</ol>
</li>
<li>从属性中提取值。 此值将用作主服务器的基本 URL。base_urlm.homeserver<ol>
<li>如果未提供此值,则 .FAIL_PROMPT</li>
</ol>
</li>
<li>验证主服务器基本 URL:<ol>
<li>将其解析为 URL。如果它不是 URL,则 .FAIL_ERROR</li>
<li>客户端应验证 URL 是否指向有效的 主服务器 在接受它之前,通过连接到 /_matrix/客户端/版本端点,确保它 不返回错误,并解析和验证 数据符合预期的响应格式。如果有任何步骤 在验证失败时,.验证是
   作为针对配置错误的简单检查完成,在 以确保发现的地址指向 有效的主服务器。FAIL_ERROR</li>
<li>请务必注意,该值可能包括 尾随 .消费者应准备好处理这两种情况。base_url/</li>
</ol>
</li>
<li>如果该属性存在,请提取值以用作身份服务器的基本 URL。 此 URL 的验证按上述步骤完成,但用作要连接到的终结点。如果该属性存在,但没有值,则 .m.identity_serverbase_url/_
   matrix/identity/v2m.identity_serverbase_urlFAIL_PROMPT</li>
</ol>
</li>
</ol>
<h4 id="get-well-knownmatrixclient">GET /.well-known/matrix/client</h4>
<p>获取有关域的发现信息。该文件可能包括 附加键,必须遵循 Java 包命名约定, 例如.这可确保属性名称 为每个应用程序适当地命名,并降低 冲突。com.example.myapp.property</p>
<p>请注意,此终结点不一定由主服务器处理, 但由另一个网络服务器使用,用于发现主服务器 URL。</p>
<p>响应示例:</p>
<pre><code class="language-yaml">    {
  &quot;m.homeserver&quot;: {
    &quot;base_url&quot;: &quot;https://daodst.example.com&quot;
  },
  &quot;m.identity_server&quot;: {
    &quot;base_url&quot;: &quot;https://identity.example.com&quot;
  },
  &quot;org.example.custom.property&quot;: {
    &quot;app_url&quot;: &quot;https://custom.app.example.org&quot;
  }
}
</code></pre>
<h4 id="get-_matrixclientversions">GET /_matrix/client/versions</h4>
<p>获取服务器支持的规范版本。</p>
<p>值将采用形式或历史案例。有关详细信息,请参阅规范版本控制 信息。vX.YrX.Y.Z</p>
<p>服务器可能会额外公布其支持的实验性功能 通过。这些功能应具有命名空间,并且 如果需要,可以选择在其名称中包含版本信息。 此处列出的功能不适用于选择性切换矩阵的各个部分 规范,应仅用于播发对功能的支持 尚未进入规范。例如,当前功能。
正在进行提案流程可能会出现在这里并最终被采纳 一旦功能进入规范并且服务器认为它,就脱离此列表 这样做是合理的。服务器可能希望在此处保留广告功能 在它们被发布到规范中后,让客户有机会 适当升级。此外,客户端应避免使用不稳定
稳定版本中的功能。unstable_features</p>
<p>响应示例:</p>
<pre><code class="language-json">    {
  &quot;unstable_features&quot;: {
    &quot;org.example.my_feature&quot;: true
  },
  &quot;versions&quot;: [
    &quot;r0.0.1&quot;,
    &quot;v1.1&quot;
  ]
}
</code></pre>
<h2 id="4">4. 客户端身份验证</h2>
<p>大多数 API 端点要求用户通过呈现来标识自己 以前以查询形式获得的凭据 access_token参数或通过授权标头 Bearer $access_token。 访问令牌通常通过登录或注册过程获取。访问令牌
可以过期;可以使用刷新令牌生成新的访问令牌。</p>
<h3 id="41">4.1 使用访问令牌</h3>
<p>访问令牌可以通过两种方式提供,这两种方式都是主服务器 必须支持:</p>
<pre><code>1. 通过查询字符串参数 .access_token=TheTokenHere 
2. 通过请求标头 .Authorization: Bearer TheTokenHere
</code></pre>
<p>鼓励客户尽可能使用标头 以防止访问令牌在访问/HTTP 日志中泄露。查询 字符串应仅在标头为 客户端无法访问。AuthorizationAuthorization</p>
<p>当凭据需要但缺失或无效时,HTTP 调用将 返回状态为 401 和错误代码,或分别返回。请注意,错误代码 可能意味着以下四种情况之一:M_MISSING_TOKENM_UNKNOWN_TOKENM_UNKNOWN_TOKEN</p>
<pre><code>1. 访问令牌从未有效。
2. 访问令牌已注销。
3. 访问令牌已软注销。
4. [在 v1.3 中添加] 访问令牌需要刷新。
</code></pre>
<p>当客户端收到错误代码 时,它应该:M_UNKNOWN_TOKEN</p>
<ul>
<li>尝试刷新令牌（如果它有刷新） 令 牌;</li>
<li>如果soft_logout设置为 ,它可以提供 重新登录用户,保留任何客户端的持久 信息;true</li>
<li>否则,将用户视为已注销。</li>
</ul>
<h3 id="42">4.2 访问令牌和设备之间的关系</h3>
<p>客户端设备与访问密切相关 令牌和刷新令牌。矩阵服务器应记录哪个设备 每个访问令牌和刷新令牌都分配给,以便 可以正确处理后续请求。当刷新令牌为 用于生成新的访问令牌和刷新令牌,即新的访问 和刷新令牌现在绑定到与 初始刷新令牌。</p>
<p>默认情况下,登录和注册过程自动生成新的 .客户也可以自由 生成自己的,或者,前提是用户保持不变, 重用设备:无论哪种情况,客户端都应传递 请求正文。如果客户端设置 ,服务器将
使以前分配给该设备的任何访问和刷新令牌无效。device_iddevice_iddevice_iddevice_id</p>
<h3 id="43">4.3 刷新访问令牌</h3>
<p>访问令牌可能会在一定时间后过期。任何 HTTP 调用 使用过期的访问令牌将返回错误代码, 最好带 .当客户端收到此错误并且 具有刷新令牌,它应尝试通过调用 /refresh 来刷新访问令牌。客户还可以刷新他们的
随时访问令牌,即使它尚未过期。如果令牌刷新 成功后,客户端应将新令牌用于将来的请求,并且可以 使用新令牌重试以前失败的请求。当访问令牌 刷新后,可能会返回新的刷新令牌;如果新的刷新令牌是 给定,旧的刷新令牌将失效,而新的刷新令牌将失效
应在需要刷新访问令牌时使用。M_UNKNOWN_TOKENsoft_logout: true</p>
<p>旧的刷新令牌在新的访问令牌或刷新令牌之前一直有效 ,此时将吊销旧的刷新令牌。这可确保如果 客户端无法接收或保留新令牌,它将能够重复 刷新操作。</p>
<p>如果令牌刷新失败并且错误响应包含属性,则客户端可以将其视为软注销,并尝试通过重新登录来获取新的访问令牌。如果错误 响应不包含属性,客户端应 将用户视为已注销。soft_logout: truesoft_logout: true</p>
<p>不支持刷新令牌的客户端的处理由主服务器决定; 客户端通过在 /login 和 /register 终结点的请求正文中包含属性来指示其对刷新令牌的支持。例如,家庭服务器 可能允许使用未过期的访问令牌,或者可能使访问令牌过期
无论如何,并依赖于不支持的客户端上的软注销行为 刷新。refresh_token: true</p>
<h3 id="44">4.4 软注销</h3>
<p>如果服务器需要,客户端可以处于"软注销"状态 在继续之前重新进行身份验证,但不希望使 客户端会话。服务器指示客户端处于软注销状态 通过在错误响应中包含参数来状态;参数默认为 。如果参数被省略或为 ,这意味着服务器具有
已销毁会话,客户端不应重用它。也就是说,任何 客户端持有的持久状态,例如加密密钥和设备 信息,不得重复使用,必须丢弃。如果是,客户端可以重用任何持久状态。soft_logout:
trueM_UNKNOWN_TOKENsoft_logoutfalsesoft_logoutfalsesoft_logouttrue</p>
<p>[在 v1.3 中更改]</p>
<p>收到此类响应的客户端可以尝试刷新其访问令牌（如果它有刷新） 令牌可用。如果没有可用的刷新令牌,或者正在刷新 失败,客户端可以通过 指定它已用于登录 API 的设备 ID。soft_logout: true</p>
<h3 id="45-api">4.5 用户交互式身份验证 API</h3>
<h4 id="451">4.5.1 概述</h4>
<p>某些 API 端点需要与用户交互的身份验证。 主服务器可以提供许多不同的身份验证方式,例如 作为用户/密码身份验证,通过单点登录服务器 （SSO） 登录等。 此规范未定义主服务器应如何授权 他们的用户,而是定义了标准接口
应遵循实现,以便任何客户端都可以登录到任何 主服务器。</p>
<p>该过程采取一个或多个"阶段"的形式。在每个阶段 客户端为给定的身份验证类型提交一组数据并等待 来自服务器的响应,这将是最终成功或 请求执行其他阶段。这种交换一直持续到 最后的成功。</p>
<p>对于每个端点,服务器提供一个或多个客户端的"流" 可用于对自身进行身份验证。每个流程包括一系列阶段, 如上所述。客户端可以自由选择它遵循的流程, 但是,流的各个阶段必须按顺序完成。未能遵循 按顺序排列的流必须产生 HTTP 401
响应,如定义 下面。当流中的所有阶段都完成后,身份验证是 完成,API 调用成功。</p>
<h4 id="452-rest-api-api">4.5.2 REST API 中的用户交互式 API</h4>
<p>在本规范中描述的 REST API 中,身份验证的工作方式为 交换 JSON 字典的客户端和服务器。服务器指示 通过 HTTP 401 正文需要哪些身份验证数据 响应,客户端通过请求参数提交该身份验证数据。auth</p>
<p>客户端应首先发出不带参数的请求。 主服务器返回带有 JSON 正文的 HTTP 401 响应,如下所示:auth</p>
<pre><code>HTTP/1.1 401 Unauthorized
Content-Type: application/json
</code></pre>
<pre><code class="language-json">    {
  &quot;flows&quot;: [
    {
      &quot;stages&quot;: [
        &quot;example.type.foo&quot;,
        &quot;example.type.bar&quot;
      ]
    },
    {
      &quot;stages&quot;: [
        &quot;example.type.foo&quot;,
        &quot;example.type.baz&quot;
      ]
    }
  ],
  &quot;params&quot;: {
    &quot;example.type.baz&quot;: {
      &quot;example_key&quot;: &quot;foobar&quot;
    }
  },
  &quot;session&quot;: &quot;xxxxxx&quot;
}
</code></pre>
<p>除了 之外,此对象还包含一些额外的信息:flows</p>
<ul>
<li>params:此部分包含客户端将要提供的任何信息 需要知道才能使用给定类型的身份验证。对于每个 提供的身份验证类型,该类型可能在此类型中作为密钥存在 字典。例如,OAuth 客户端 ID 的公共部分可以是 在这里给出。</li>
<li>session:这是客户端必须传回的会话标识符 到主服务器（如果提供了）,在随后的身份验证尝试中 在同一个 API 调用中。</li>
</ul>
<p>然后,客户端选择一个流并尝试完成第一阶段。 它通过重新提交相同的请求并在提交的对象中添加密钥来实现此目的。此字典包含一个键,其值是身份验证类型的名称,该 客户端正在尝试完成。它还必须包含一个密钥 使用主服务器给出的会话密钥的值（如果
鉴于。它还包含依赖于身份验证类型的其他键 企图。例如,如果客户端正在尝试完成身份验证 键入 ,它可能会提交如下内容:authtypesessionexample.type.foo</p>
<pre><code>POST /_matrix/client/v3/endpoint HTTP/1.1
Content-Type: application/json
</code></pre>
<pre><code class="language-json">{
  &quot;a_request_parameter&quot;: &quot;something&quot;,
  &quot;another_request_parameter&quot;: &quot;something else&quot;,
  &quot;auth&quot;: {
    &quot;type&quot;: &quot;example.type.foo&quot;,
    &quot;session&quot;: &quot;xxxxxx&quot;,
    &quot;example_credential&quot;: &quot;verypoorsharedsecret&quot;
  }
}
</code></pre>
<p>如果主服务器认为身份验证尝试成功,但 仍然需要更多阶段才能完成,它返回HTTP状态401 以及与未尝试身份验证时相同的对象, 添加密钥,该密钥是身份验证类型的数组 客户端已成功完成:completed</p>
<pre><code>HTTP/1.1 401 Unauthorized
Content-Type: application/json
</code></pre>
<pre><code class="language-json">{
  &quot;completed&quot;: [
    &quot;example.type.foo&quot;
  ],
  &quot;flows&quot;: [
    {
      &quot;stages&quot;: [
        &quot;example.type.foo&quot;,
        &quot;example.type.bar&quot;
      ]
    },
    {
      &quot;stages&quot;: [
        &quot;example.type.foo&quot;,
        &quot;example.type.baz&quot;
      ]
    }
  ],
  &quot;params&quot;: {
    &quot;example.type.baz&quot;: {
      &quot;example_key&quot;: &quot;foobar&quot;
    }
  },
  &quot;session&quot;: &quot;xxxxxx&quot;
}
</code></pre>
<p>各个阶段可能需要多个请求才能完成,在 在这种情况下,响应将好像请求未经身份验证 添加由身份验证类型定义的任何其他密钥。</p>
<p>如果主服务器确定某个阶段的尝试不成功, 但客户端可能会进行第二次尝试,它返回相同的 HTTP 状态 401 响应如上所述,并添加了描述错误的标准和字段。例如:errcodeerror</p>
<pre><code>HTTP/1.1 401 Unauthorized
Content-Type: application/json
</code></pre>
<pre><code class="language-json">{
  &quot;errcode&quot;: &quot;M_FORBIDDEN&quot;,
  &quot;error&quot;: &quot;Invalid password&quot;,
  &quot;completed&quot;: [
    &quot;example.type.foo&quot;
  ],
  &quot;flows&quot;: [
    {
      &quot;stages&quot;: [
        &quot;example.type.foo&quot;,
        &quot;example.type.bar&quot;
      ]
    },
    {
      &quot;stages&quot;: [
        &quot;example.type.foo&quot;,
        &quot;example.type.baz&quot;
      ]
    }
  ],
  &quot;params&quot;: {
    &quot;example.type.baz&quot;: {
      &quot;example_key&quot;: &quot;foobar&quot;
    }
  },
  &quot;session&quot;: &quot;xxxxxx&quot;
}
</code></pre>
<p>如果请求由于身份验证以外的原因而失败,则服务器 返回标准格式的错误消息。例如:</p>
<pre><code>HTTP/1.1 400 Bad request
Content-Type: application/json
</code></pre>
<pre><code class="language-json">{
  &quot;errcode&quot;: &quot;M_EXAMPLE_ERROR&quot;,
  &quot;error&quot;: &quot;Something was wrong&quot;
}
</code></pre>
<p>如果客户端已完成流的所有阶段,则主服务器 执行 API 调用并正常返回结果。已完成的阶段 客户端无法重试,因此服务器必须返回 401 包含已完成阶段的响应,或 API 调用的结果（如果全部） 当客户端重试阶段时,阶段已完成。</p>
<p>某些身份验证类型可以通过 矩阵客户端,例如,可以完成电子邮件确认 当用户单击电子邮件中的链接时。在这种情况下,客户端 使用仅包含会话密钥的身份验证字典重试请求。 对此的响应将与客户端尝试相同 正常完成身份验证状态,即请求将
完成或请求身份验证,是否存在该身份验证类型 在"已完成"数组中指示该阶段是否完成。</p>
<h4 id="453">4.5.3 例</h4>
<p>在高级别上,对 API 调用发出的请求完成身份验证 具有三个阶段的流将类似于下图:</p>
<pre><code>    _______________________
    |       Stage 0         |
    | No auth               |
    |  ___________________  |
    | |_Request_1_________| | &lt;-- Returns &quot;session&quot; key which is used throughout.
    |_______________________|
             |
             |
    _________V_____________
    |       Stage 1         |
    | type: &quot;&lt;auth type1&gt;&quot;  |
    |  ___________________  |
    | |_Request_1_________| |
    |_______________________|
             |
             |
    _________V_____________
    |       Stage 2         |
    | type: &quot;&lt;auth type2&gt;&quot;  |
    |  ___________________  |
    | |_Request_1_________| |
    |  ___________________  |
    | |_Request_2_________| |
    |  ___________________  |
    | |_Request_3_________| |
    |_______________________|
             |
             |
    _________V_____________
    |       Stage 3         |
    | type: &quot;&lt;auth type3&gt;&quot;  |
    |  ___________________  |
    | |_Request_1_________| | &lt;-- Returns API response
    |_______________________|
</code></pre>
<h4 id="454">4.5.4 身份验证类型</h4>
<p>此规范定义了以下身份验证类型:</p>
<ul>
<li>m.login.password</li>
<li>m.login.recaptcha</li>
<li>m.login.sso</li>
<li>m.login.email.identity</li>
<li>m.login.msisdn</li>
<li>m.login.dummy</li>
<li>m.login.registration_token</li>
</ul>
<h4 id="455">4.5.5 后备</h4>
<p>不能期望客户能够知道如何处理每个 单一登录类型。如果客户端不知道如何处理给定的登录 类型,它可以将用户定向到具有回退 URL 的 Web 浏览器 页面,允许用户在带外完成该登录步骤 在他们的网络浏览器中。它应该打开的 URL 是:</p>
<pre><code>/_matrix/client/v3/auth/&lt;auth type&gt;/fallback/web?session=&lt;session ID&gt;
</code></pre>
<p>其中 是它正在尝试的阶段的类型名称,是主服务器提供的会话的 ID。auth typesession ID</p>
<p>这必须返回可以执行此身份验证的 HTML 页面 阶段。此页面必须使用以下 JavaScript 在 身份验证已完成:</p>
<pre><code class="language-js">if (window.onAuthDone) {
    window.onAuthDone();
} else if (window.opener &amp;&amp; window.opener.postMessage) {
    window.opener.postMessage(&quot;authDone&quot;, &quot;*&quot;);
}
</code></pre>
<p>这允许客户端安排在嵌入式浏览器中定义全局函数,或使用HTML5跨文档 消息传递 API, 到 接收身份验证阶段已完成的通知。onAuthDone</p>
<p>客户端收到身份验证阶段的通知后 已完成,它应该使用身份验证字典重新提交请求 仅使用会话 ID:</p>
<pre><code class="language-json">{
  &quot;session&quot;: &quot;&lt;session ID&gt;&quot;
}
</code></pre>
<p>4.5.6 标识符类型</p>
<p>某些身份验证机制使用用户标识符对象来标识 一个用户。用户标识符对象有一个字段来指示 正在使用的标识符类型,并且根据类型,具有其他 提供标识用户所需信息的字段,如所述 下面。type</p>
<p>此规范定义了以下标识符类型:</p>
<ul>
<li>m.id.user</li>
<li>m.id.thirdparty</li>
<li>m.id.phone</li>
</ul>
<h3 id="46">4.6 登录</h3>
<p>客户端可以使用 API 获取访问令牌。/login</p>
<p>请注意,此终结点当前不使用用户交互式身份验证 原料药。</p>
<p>对于简单的用户名/密码登录,客户端应提交请求,如下所示:/login</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;m.login.password&quot;,
  &quot;identifier&quot;: {
    &quot;type&quot;: &quot;m.id.user&quot;,
    &quot;user&quot;: &quot;&lt;user_id or user localpart&gt;&quot;
  },
  &quot;password&quot;: &quot;&lt;password&gt;&quot;
}
</code></pre>
<p>或者,客户端可以使用绑定到用户帐户的 3PID 主服务器使用 /account/3pid API 而不是显式提供,如下所示:user</p>
<pre><code class="language-json">{
  &quot;type&quot;: &quot;m.login.password&quot;,
  &quot;identifier&quot;: {
    &quot;medium&quot;: &quot;&lt;The medium of the third-party identifier&gt;&quot;,
    &quot;address&quot;: &quot;&lt;The canonicalised third-party address of the user&gt;&quot;
  },
  &quot;password&quot;: &quot;&lt;password&gt;&quot;
}
</code></pre>
<p>如果主服务器不知道提供的 3PID, 主服务器必须响应 。403 Forbidden</p>
<p>要使用登录令牌登录,客户端应提交请求 如下:/login</p>
<pre><code>{
&quot;type&quot;: &quot;m.login.token&quot;,
&quot;token&quot;: &quot;&lt;login token&gt;&quot;
}
</code></pre>
<p>必须对用户 ID 进行编码,因为没有其他标识 请求中的数据。在令牌无效的情况下,主服务器必须 响应 和错误代码 。token403 ForbiddenM_FORBIDDEN</p>
<p>如果主服务器播发为可行的流,并且 客户端支持它,客户端应将用户重定向到端点,以便通过 SSO 登录客户端。身份验证后 完成后,客户端将需要提交匹配的请求。m.login.sso/redirect/loginm.login.token</p>
<h4 id="get-_matrixclientv3login">GET /_matrix/client/v3/login</h4>
<p>获取主服务器支持的登录类型以对用户进行身份验证。客户 应该选择其中之一并在登录时提供它。type</p>
<pre><code class="language-json">{
  &quot;flows&quot;: [
    {
      &quot;type&quot;: &quot;m.login.password&quot;
    }
  ]
}
</code></pre>
<h4 id="post-_matrixclientv3login">POST /_matrix/client/v3/login</h4>
<p>对用户进行身份验证,并颁发他们可以的访问令牌 用于在后续请求中授权自己。</p>
<p>如果客户端未提供 ,则服务器必须 自动生成一个。device_id</p>
<p>返回的访问令牌必须与客户端提供的或由服务器生成的相关联。服务器可能 使以前与该设备关联的任何访问令牌无效。请参阅访问令牌和设备之间的关系。device_id</p>
<pre><code class="language-json">{
  &quot;identifier&quot;: {
    &quot;type&quot;: &quot;m.id.user&quot;,
    &quot;user&quot;: &quot;cheeky_monkey&quot;
  },
  &quot;initial_device_display_name&quot;: &quot;Jungle Phone&quot;,
  &quot;password&quot;: &quot;ilovebananas&quot;,
  &quot;type&quot;: &quot;m.login.password&quot;
}
</code></pre>
<pre><code class="language-json">{
  &quot;access_token&quot;: &quot;abc123&quot;,
  &quot;device_id&quot;: &quot;GHTYAJCE&quot;,
  &quot;expires_in_ms&quot;: 60000,
  &quot;refresh_token&quot;: &quot;def456&quot;,
  &quot;user_id&quot;: &quot;@cheeky_monkey:matrix.org&quot;,
  &quot;well_known&quot;: {
    &quot;m.homeserver&quot;: {
      &quot;base_url&quot;: &quot;https://example.org&quot;
    },
    &quot;m.identity_server&quot;: {
      &quot;base_url&quot;: &quot;https://id.example.org&quot;
    }
  }
}
</code></pre>
<h4 id="post-_matrixclientv3refresh">POST /_matrix/client/v3/refresh</h4>
<p>v1.3 中新增</p>
<p>刷新访问令牌。客户端应使用返回的访问令牌 进行后续 API 调用时,并存储返回的刷新令牌 （如果给定）,以便在必要时刷新新的访问令牌。</p>
<p>刷新访问令牌后,服务器可以选择 使旧访问令牌立即失效,也可以选择不使旧访问令牌失效 例如,访问令牌是否很快就会过期。客户应该 不对旧访问令牌仍然有效做出任何假设, 并应改用新提供的访问令牌。</p>
<p>旧的刷新令牌在新的访问令牌或刷新令牌之前一直有效 ,此时将吊销旧的刷新令牌。</p>
<p>请注意,此端点不需要通过 访问令牌。身份验证通过刷新令牌提供。</p>
<p>已为此终结点禁用应用程序服务标识断言。</p>
<pre><code class="language-json">
{
  &quot;refresh_token&quot;: &quot;some_token&quot;
}
</code></pre>
<pre><code class="language-json">{
  &quot;access_token&quot;: &quot;a_new_token&quot;,
  &quot;expires_in_ms&quot;: 60000,
  &quot;refresh_token&quot;: &quot;another_new_token&quot;
}
</code></pre>
<h4 id="post-_matrixclientv3logout">POST /_matrix/client/v3/logout</h4>
<p>使现有访问令牌失效,使其不能再用于 授权。与访问令牌关联的设备也将被删除。设备的设备密钥将与设备一起删除。</p>
<pre><code class="language-json">{}
</code></pre>
<h4 id="post-_matrixclientv3logoutall">POST /_matrix/client/v3/logout/all</h4>
<p>使用户的所有访问令牌失效,以便它们不能再用于 授权。这包括发出此请求的访问令牌。所有设备 对于用户也将被删除。设备的设备密钥为 与设备一起删除。</p>
<p>此终结点不使用用户交互式身份验证 API,因为 用户交互式身份验证旨在防止以下攻击:有人掌握了一个访问令牌,然后接管了该帐户。这 终结点使用户的所有访问令牌失效,包括 请求,因此攻击者无法接管帐户 这边。</p>
<pre><code class="language-json">{}
</code></pre>
<h3 id="47">4.7 帐户注册和管理</h3>
<h4 id="post-_matrixclientv3accountdeactivate">POST /_matrix/client/v3/account/deactivate</h4>
<p>停用用户帐户,删除用户的所有能力 再次登录。</p>
<p>此 API 终结点使用用户交互式身份验证 API。</p>
<p>如果客户端具有 活动会话。</p>
<p>主服务器可能会更改可用的流,具体取决于 提供了有效的访问令牌。</p>
<p>与其他端点不同,此端点不采用参数,因为主服务器应将请求签名到 而是标识服务器。id_access_token</p>
<pre><code>req

{
  &quot;auth&quot;: {
    &quot;example_credential&quot;: &quot;verypoorsharedsecret&quot;,
    &quot;session&quot;: &quot;xxxxx&quot;,
    &quot;type&quot;: &quot;example.type.foo&quot;
  },
  &quot;id_server&quot;: &quot;example.org&quot;
}
</code></pre>
<pre><code>200

{
  &quot;id_server_unbind_result&quot;: &quot;success&quot;
}
</code></pre>
<pre><code>401

{
  &quot;completed&quot;: [
    &quot;example.type.foo&quot;
  ],
  &quot;flows&quot;: [
    {
      &quot;stages&quot;: [
        &quot;example.type.foo&quot;
      ]
    }
  ],
  &quot;params&quot;: {
    &quot;example.type.baz&quot;: {
      &quot;example_key&quot;: &quot;foobar&quot;
    }
  },
  &quot;session&quot;: &quot;xxxxxxyz&quot;
}
</code></pre>
<pre><code>429

{
  &quot;errcode&quot;: &quot;M_LIMIT_EXCEEDED&quot;,
  &quot;error&quot;: &quot;Too many requests&quot;,
  &quot;retry_after_ms&quot;: 2000
}
</code></pre>
<h4 id="post-_matrixclientv3accountpassword">POST /_matrix/client/v3/account/password</h4>
<p>更改此主服务器上帐户的密码。</p>
<p>此 API 端点使用用户交互式身份验证 API 来 确保更改密码的用户实际上是 帐户。</p>
<p>如果客户端具有 活动会话。</p>
<p>主服务器可能会更改可用的流,具体取决于 提供了有效的访问令牌。主服务器不应撤销 请求中提供的访问令牌。是否为其他访问令牌 吊销的用户取决于请求参数。</p>
<pre><code class="language-json">{
  &quot;auth&quot;: {
    &quot;example_credential&quot;: &quot;verypoorsharedsecret&quot;,
    &quot;session&quot;: &quot;xxxxx&quot;,
    &quot;type&quot;: &quot;example.type.foo&quot;
  },
  &quot;logout_devices&quot;: true,
  &quot;new_password&quot;: &quot;ihatebananas&quot;
}
</code></pre>
<pre><code class="language-json">{}
</code></pre>
<h4 id="post-_matrixclientv3accountpasswordemailrequesttoken">POST /_matrix/client/v3/account/password/email/requestToken</h4>
<p>主服务器必须检查给定的电子邮件地址是否为 与此主服务器上的帐户关联。此接口应为 用于在对终结点进行身份验证时请求验证令牌。/account/password</p>
<p>此 API 的参数和响应与 /register/email/requestToken 端点的参数和响应相同,只是如果没有与 可以找到给定的电子邮件地址。服务器可能会发送 向给定地址发送电子邮件,提示用户创建帐户。
可能无法退货。M_THREEPID_NOT_FOUNDM_THREEPID_IN_USE</p>
<p>主服务器应验证电子邮件本身,方法是发送 验证电子邮件本身或使用它可以控制的服务。</p>
<pre><code class="language-json">{
  &quot;client_secret&quot;: &quot;monkeys_are_GREAT&quot;,
  &quot;email&quot;: &quot;alice@example.org&quot;,
  &quot;id_server&quot;: &quot;id.example.com&quot;,
  &quot;next_link&quot;: &quot;https://example.org/congratulations.html&quot;,
  &quot;send_attempt&quot;: 1
}
</code></pre>
<pre><code class="language-json">{
  &quot;sid&quot;: &quot;123abc&quot;,
  &quot;submit_url&quot;: &quot;https://example.org/path/to/submitToken&quot;
}
</code></pre>
<h4 id="post-_matrixclientv3accountpasswordmsisdnrequesttoken">POST /_matrix/client/v3/account/password/msisdn/requestToken</h4>
<p>主服务器必须检查给定的电话号码是否为 与此主服务器上的帐户关联。此接口应为 用于在对终结点进行身份验证时请求验证令牌。/account/password</p>
<p>此 API 的参数和响应与 /register/msisdn/requestToken 终结点的参数和响应相同,只是如果没有与 可以找到给定的电话号码。服务器可能会改为发送短信 到提示用户创建帐户的给定电话号码。
可能无法退货。M_THREEPID_NOT_FOUNDM_THREEPID_IN_USE</p>
<p>主服务器应验证电话号码本身,方法是发送 验证消息本身或通过使用它可以控制的服务。</p>
<pre><code class="language-json">{
  &quot;client_secret&quot;: &quot;monkeys_are_GREAT&quot;,
  &quot;country&quot;: &quot;GB&quot;,
  &quot;id_server&quot;: &quot;id.example.com&quot;,
  &quot;next_link&quot;: &quot;https://example.org/congratulations.html&quot;,
  &quot;phone_number&quot;: &quot;07700900001&quot;,
  &quot;send_attempt&quot;: 1
}
</code></pre>
<pre><code class="language-json">{
  &quot;sid&quot;: &quot;123abc&quot;,
  &quot;submit_url&quot;: &quot;https://example.org/path/to/submitToken&quot;
}
</code></pre>
<h4 id="post-_matrixclientv3register">POST /_matrix/client/v3/register</h4>
<p>此 API 終結點使用使用者互動式身份驗證 API,但 正在註冊來賓帳戶的情況。</p>
<p>在此主伺服器上註冊一個帳戶。</p>
<p>有兩種類型的使用者帳戶:</p>
<ul>
<li>user帳戶。這些帳戶可以使用本規範中描述的完整 API。</li>
<li>guest帳戶。這些帳戶可能具有有限的許可權,並且可能並非受所有伺服器支援</li>
</ul>
<p>如果註冊成功,此終結點將頒發訪問令牌 用戶端可以使用 在後續請求中授權自身。</p>
<p>如果客戶端未提供 ,則伺服器必須 自動生成一個。device_id</p>
<p>伺服器應根據提供的使用者 ID 註冊一個帳戶（如果有）。請注意,矩陣使用者ID的語法 localparts 受到限制,因此伺服器必須以邏輯方式將提供的映射到
上,或者拒絕任何不符合語法的內容。usernameusernameuser_idusernameM_INVALID_USERNAME</p>
<p>矩陣用戶端不得假定註冊的本地部分與提供的 .user_idusername</p>
<p>返回的訪問令牌必須與用戶端提供的或由伺服器生成的相關聯。伺服器可能 使以前與該設備關聯的任何訪問令牌無效。請參閱訪問令牌和設備之間的關係。device_id</p>
<p>註冊來賓帳戶時,請求正文中的所有參數 必須忽略除外 由伺服器。伺服器必須為帳戶選擇一個 無論輸入如何。initial_device_display_namedevice_id</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;auth&quot;: {
    &quot;example_credential&quot;: &quot;verypoorsharedsecret&quot;,
    &quot;session&quot;: &quot;xxxxx&quot;,
    &quot;type&quot;: &quot;example.type.foo&quot;
  },
  &quot;device_id&quot;: &quot;GHTYAJCE&quot;,
  &quot;initial_device_display_name&quot;: &quot;Jungle Phone&quot;,
  &quot;password&quot;: &quot;ilovebananas&quot;,
  &quot;username&quot;: &quot;cheeky_monkey&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;access_token&quot;: &quot;abc123&quot;,
  &quot;device_id&quot;: &quot;GHTYAJCE&quot;,
  &quot;user_id&quot;: &quot;@cheeky_monkey:matrix.org&quot;
}
</code></pre>
<h4 id="get-_matrixclientv3registeravailable">GET /_matrix/client/v3/register/available</h4>
<p>檢查使用者名是否可用於伺服器且有效。</p>
<p>伺服器應檢查以確保在請求時 請求的使用者名可供使用。這包括驗證 應用程式服務尚未聲明使用者名,並且該使用者名 符合伺服器的所需要求（例如,伺服器可以指示 它不允許帶下劃線的使用者名）。</p>
<p>矩陣用戶端可能希望在嘗試註冊之前使用此 API, 但是,客戶端還必須注意,通常不會使用此 API 保留使用者名。這可能意味著使用者名變得不可用 在檢查其可用性和嘗試註冊它之間。</p>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;available&quot;: true
}
</code></pre>
<p>400 回應</p>
<pre><code class="language-json">{
  &quot;errcode&quot;: &quot;M_USER_IN_USE&quot;,
  &quot;error&quot;: &quot;Desired user ID is already taken.&quot;
}
</code></pre>
<h4 id="post-_matrixclientv3registeremailrequesttoken">POST /_matrix/client/v3/register/email/requestToken</h4>
<p>主伺服器必須檢查給定的電子郵件位址是否尚未與此主伺服器上的帳戶關聯。主伺服器 應通過發送驗證電子郵件來驗證電子郵件本身 本身或通過使用它可以控制的服務。</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;client_secret&quot;: &quot;monkeys_are_GREAT&quot;,
  &quot;email&quot;: &quot;alice@example.org&quot;,
  &quot;id_server&quot;: &quot;id.example.com&quot;,
  &quot;next_link&quot;: &quot;https://example.org/congratulations.html&quot;,
  &quot;send_attempt&quot;: 1
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;sid&quot;: &quot;123abc&quot;,
  &quot;submit_url&quot;: &quot;https://example.org/path/to/submitToken&quot;
}
</code></pre>
<h4 id="post-_matrixclientv3registermsisdnrequesttoken">POST /_matrix/client/v3/register/msisdn/requestToken</h4>
<p>主伺服器必須檢查給定的電話號碼是否尚未與此主伺服器上的帳戶關聯。主伺服器 應通過發送驗證來驗證電話號碼本身 消息本身或通過使用它可以控制的服務。</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;client_secret&quot;: &quot;monkeys_are_GREAT&quot;,
  &quot;country&quot;: &quot;GB&quot;,
  &quot;id_server&quot;: &quot;id.example.com&quot;,
  &quot;next_link&quot;: &quot;https://example.org/congratulations.html&quot;,
  &quot;phone_number&quot;: &quot;07700900001&quot;,
  &quot;send_attempt&quot;: 1
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;sid&quot;: &quot;123abc&quot;,
  &quot;submit_url&quot;: &quot;https://example.org/path/to/submitToken&quot;
}
</code></pre>
<h3 id="48">4.8 添加帳戶管理聯繫資訊</h3>
<h4 id="post-_matrixclientv3account3pidunbind">POST /_matrix/client/v3/account/3pid/unbind</h4>
<p>從提供的身份伺服器中刪除使用者的第三方標識碼 無需將其從主伺服器中刪除。</p>
<p>與其他端點不同,此端點不採用參數,因為主伺服器應將請求簽名到 而是標識伺服器。id_access_token</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;address&quot;: &quot;example@example.org&quot;,
  &quot;id_server&quot;: &quot;example.org&quot;,
  &quot;medium&quot;: &quot;email&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;id_server_unbind_result&quot;: &quot;success&quot;
}
</code></pre>
<h3 id="49">4.9 往來帳戶資訊</h3>
<h4 id="get-_matrixclientv3accountwhoami">GET /_matrix/client/v3/account/whoami</h4>
<p>獲取有關給定訪問令牌的所有者的資訊。</p>
<p>請注意,與客戶端-伺服器 API 的其餘部分一樣, 應用程式服務可能會偽裝成其使用者 命名空間,通過提供查詢參數。在此 在這種情況下,伺服器應驗證給定的是否由應用服務註冊,並在回應中返回 body。user_iduser_id</p>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;device_id&quot;: &quot;ABC1234&quot;,
  &quot;user_id&quot;: &quot;@joe:example.org&quot;
}
</code></pre>
<h4 id="491">4.9.1 有關身份伺服器的說明</h4>
<p>Matrix 中的識別伺服器儲存綁定（關係） 使用者的第三方標識碼,通常是電子郵件或電話號碼,以及 他們的使用者ID。用戶選擇身份伺服器后,該身份 伺服器應由所有用戶端使用。</p>
<p>用戶端可以通過帳戶數據事件查看用戶選擇了哪個身份伺服器,如下所述。客戶 應避免向任何身份伺服器發出請求,直到 的存在被確認為（不存在）。如果 存在,用戶端應檢查事件內容中是否存在屬性。如果存在,則 用戶端應使用該屬性中的標識伺服器作為標識
用戶的伺服器。如果缺少,或者帳戶數據 事件不存在,客戶端應使用任何預設值 通常適用於身份伺服器（如果適用）。客戶不應 當使用者使用預設身份伺服器更新帳戶數據時
其帳戶數據中缺少身份伺服器。m.identity_serverm.identity_serverbase_urlbase_urlbase_url</p>
<p>客戶應偵聽帳戶的更改 數據事件,並更新他們正在聯繫的身份伺服器 結果。m.identity_server</p>
<p>如果用戶端提供了一種設置要使用的身份伺服器的方法,則必須 相應地更新的值。A 的 MUST 被視為使用者不想使用 身份伺服器,因此禁用所有相關功能。m.identity_serverbase_urlnull</p>
<p>客戶應避免將帳戶數據作為遷移進行填充 針對缺少帳戶數據的使用者的步驟,除非用戶設置 用戶端內的身份伺服器為值。例如,使用者 沒有帳戶數據事件不應最終 在帳戶數據中使用客戶端的預設身份伺服器,除非
使用者首先訪問其帳戶設置以設置身份伺服器。m.identity_server</p>
<p>例子</p>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;base_url&quot;: &quot;https://example.org&quot;
  },
  &quot;type&quot;: &quot;m.identity_server&quot;
}
</code></pre>
<h2 id="5">5. 能力協商</h2>
<p>主伺服器可能不支援某些操作,客戶端必須能夠 查詢主伺服器可以提供和不能提供的內容。例如,一個 家庭伺服器可能不支援使用者按原樣更改其密碼 配置為對外部系統執行身份驗證。</p>
<p>通過此系統宣傳的功能旨在 通告在 API 中可選的功能,或者依賴於 使用者或伺服器狀態的某種方式。這個系統不應該 用於宣傳不穩定或實驗性功能 - 這更好 由端點完成。/versions</p>
<p>合理能力的一些範例包括:</p>
<ul>
<li>伺服器是否支援用戶狀態。</li>
<li>伺服器是否支援可選功能,例如使用者或 房間目錄。</li>
<li>對用戶端施加的速率限制或檔類型限制 伺服器。</li>
</ul>
<p>不應成為功能的一些範例包括:</p>
<ul>
<li>伺服器是否支持規範中的功能。unstable</li>
<li>媒體大小限制 - 這些限制由 /config API 處理。</li>
<li>用於通信的可選編碼或替代傳輸 伺服器</li>
</ul>
<p>前綴為的功能保留用於在 矩陣規範,而其他值可能由伺服器使用 Java 包命名約定。矩陣支援的功能 規範將在本節後面定義。m.</p>
<h4 id="get-_matrixclientv3capabilities">GET /_matrix/client/v3/capabilities</h4>
<p>獲取有關伺服器支援的功能集的資訊 和其他相關功能。</p>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;capabilities&quot;: {
    &quot;com.example.custom.ratelimit&quot;: {
      &quot;max_requests_per_hour&quot;: 600
    },
    &quot;m.change_password&quot;: {
      &quot;enabled&quot;: false
    },
    &quot;m.room_versions&quot;: {
      &quot;available&quot;: {
        &quot;1&quot;: &quot;stable&quot;,
        &quot;2&quot;: &quot;stable&quot;,
        &quot;3&quot;: &quot;unstable&quot;,
        &quot;test-version&quot;: &quot;unstable&quot;
      },
      &quot;default&quot;: &quot;1&quot;
    }
  }
}
</code></pre>
<h3 id="51-mchange_password">5.1 m.change_password能力</h3>
<p>此功能具有單個標誌,指示是否或 不是使用者可以使用 API 來更改其 密碼。如果不存在,用戶端應假定密碼更改 可以通過 API 實現。如果存在,客戶應尊重 功能的標誌,並在用戶無法時向使用者指示
以更改其密碼。enabled/account/passwordenabled</p>
<p>功能 API 對此功能的回應示例如下:</p>
<pre><code>{
  &quot;capabilities&quot;: {
    &quot;m.change_password&quot;: {
      &quot;enabled&quot;: false
    }
  }
}

</code></pre>
<h3 id="52-mroom_versions">5.2 m.room_versions能力</h3>
<p>此功能描述預設和可用的房間版本 a 伺服器支援,以及穩定性級別。客戶應使用 此功能,以確定是否需要鼓勵使用者 升級他們的房間。</p>
<p>功能 API 對此功能的回應示例如下:</p>
<pre><code class="language-json">{
  &quot;capabilities&quot;: {
    &quot;m.room_versions&quot;: {
      &quot;default&quot;: &quot;1&quot;,
      &quot;available&quot;: {
        &quot;1&quot;: &quot;stable&quot;,
        &quot;2&quot;: &quot;stable&quot;,
        &quot;3&quot;: &quot;unstable&quot;,
        &quot;custom-version&quot;: &quot;unstable&quot;
      }
    }
  }
}
</code></pre>
<p>此功能反映了房間的相同限制 用於描述哪些版本的版本 穩定和不穩定。用戶端應假定版本為 。任何未明確標記為版本的版本都將被視為 。例如,一個 列為的版本應被視為
。defaultstablestableavailableunstablefuture-stableunstable</p>
<p>版本是伺服器用於創建新版本的版本 房間。用戶端應鼓勵具有足夠許可權的使用者在 房間將他們的房間升級到房間時的版本 使用版本。defaultdefaultunstable</p>
<p>如果未列出此功能,用戶端應用作 默認且唯一穩定的房間版本。"1"available</p>
<h3 id="53-mset_displayname">5.3 m.set_displayname能力</h3>
<p>此功能具有單個標誌 ,用於指示使用者是否 能夠通過配置檔終結點更改自己的顯示名稱。案例 禁用可能包括從外部標識/目錄映射的使用者 服務,例如LDAP。enabled</p>
<p>請注意,這與功能很好地匹配。m.set_avatar_url</p>
<p>如果未列出,用戶端應假定用戶能夠更改其 顯示名稱。</p>
<p>功能 API 對此功能的回應示例如下:</p>
<pre><code class="language-json">{
  &quot;capabilities&quot;: {
    &quot;m.set_displayname&quot;: {
      &quot;enabled&quot;: false
    }
  }
}
</code></pre>
<h3 id="54-mset_avatar_url">5.4 m.set_avatar_url能力</h3>
<p>此功能具有單個標誌 ,用於指示使用者是否 能夠通過配置檔端點更改自己的頭像。案例 禁用可能包括從外部標識/目錄映射的使用者 服務,例如LDAP。enabled</p>
<p>請注意,這與功能很好地匹配。m.set_displayname</p>
<p>如果未列出,用戶端應假定用戶能夠更改其 化身。</p>
<p>功能 API 對此功能的回應示例如下:</p>
<pre><code class="language-json">{
  &quot;capabilities&quot;: {
    &quot;m.set_avatar_url&quot;: {
      &quot;enabled&quot;: false
    }
  }
}
</code></pre>
<h3 id="55-m3pid_changes">5.5 m.3pid_changes能力</h3>
<p>此功能具有單個標誌 ,用於指示使用者是否 能夠添加,刪除或更改其帳戶上的 3PID 關聯。注意 這僅影響使用者使用管理員聯繫資訊 API 的能力,而不會影響身份服務公開的終結點。禁用案例 可能包括從外部標識/目錄服務映射的使用者,
例如LDAP。enabled</p>
<p>如果未列出,用戶端應假定用戶能夠修改其 3PID 協會。</p>
<p>功能 API 對此功能的回應示例如下:</p>
<pre><code class="language-json">{
  &quot;capabilities&quot;: {
    &quot;m.3pid_changes&quot;: {
      &quot;enabled&quot;: false
    }
  }
}
</code></pre>
<h2 id="6">6 濾波</h2>
<p>過濾器可以在伺服器上創建,並可以作為參數傳遞給 返回事件的 API。這些篩選器更改從返回的數據 那些 API。並非所有 API 都接受篩選器。</p>
<h3 id="61">6.1 懶人裝載室成員</h3>
<p>會員活動通常需要大量資源供客戶跟蹤。 為了減少使用的資源數量,用戶端可以啟用 房間成員的'延遲載入'。。通過這樣做,伺服器將嘗試 僅發送與客戶相關的會員活動。</p>
<p>重要的是要了解延遲載入並不是為了 完美的優化,並且伺服器可能不切實際 精確計算哪些成員資格事件與客戶相關。 因此,伺服器發送冗餘成員資格是有效的 事件向客戶端簡化實現,儘管這種冗餘 應盡可能減少以節省頻寬。</p>
<p>在篩檢程式方面,延遲載入是通過在 （或 僅大小寫）。啟用後,延遲載入感知端點（請參閱 以下）將僅包括 OF 活動的會員活動 包含在回應中。例如,如果客戶端發出啟用了延遲載入的請求,則伺服器將僅返回 時間線中事件的成員身份事件,而不是全部
聊天室的成員。lazy_load_membersRoomEventFilterStateFilter/syncsender/syncsender</p>
<p>在處理一系列事件時（例如,通過迴圈或 分頁 ）,對於事件塊來說很常見 序列以共用一組類似的寄件者。而不是回應 將這些發送方的重複成員身份事件發送到 用戶端,伺服器可能會假設客戶端會記住成員資格 已發送的事件,並選擇跳過發送
會員資格未更改的成員資格活動。這些 稱為'冗餘成員資格事件'。。客戶可以要求 冗餘成員身份事件始終包含在回應中,方法是在篩選器中設置為 true。/sync/messagesinclude_redundant_members</p>
<p>使用延遲載入的預期模式目前為:</p>
<ul>
<li>用戶端在啟用延遲載入的情況下執行初始 /sync,並且 僅接收與的發送方相關的成員身份事件 它接收的事件。</li>
<li>支持顯示名稱制表元補全或其他功能的用戶端 需要快速訪問房間內所有成員的操作 應為當前選定的聊天室調用 /members,並將參數設置為 /sync 回應的 from 令牌。成員清單 因為房間然後由國家在隨後維護 增量/同步回應。?at</li>
<li>不支援製表符補全的用戶端可能會拉入 任意使用者的配置檔（例如已讀回執,鍵入 通知）通過查詢房間狀態或 ./profile</li>
</ul>
<p>支援延遲載入房間成員的當前終結點包括:</p>
<ul>
<li>/sync</li>
<li>/rooms/<room_id>/messages</li>
<li>/rooms/<room_id>/context/{eventId}</li>
</ul>
<h3 id="62">6.2 介面連接點</h3>
<h4 id="post-_matrixclientv3useruseridfilter">POST /_matrix/client/v3/user/{userId}/filter</h4>
<p>將新的篩選器定義上載到主伺服器。 返回篩選器ID,該ID可在將來的請求中使用 限制將哪些事件返回到用戶端。</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;event_fields&quot;: [
    &quot;type&quot;,
    &quot;content&quot;,
    &quot;sender&quot;
  ],
  &quot;event_format&quot;: &quot;client&quot;,
  &quot;presence&quot;: {
    &quot;not_senders&quot;: [
      &quot;@alice:example.com&quot;
    ],
    &quot;types&quot;: [
      &quot;m.presence&quot;
    ]
  },
  &quot;room&quot;: {
    &quot;ephemeral&quot;: {
      &quot;not_rooms&quot;: [
        &quot;!726s6s6q:example.com&quot;
      ],
      &quot;not_senders&quot;: [
        &quot;@spam:example.com&quot;
      ],
      &quot;types&quot;: [
        &quot;m.receipt&quot;,
        &quot;m.typing&quot;
      ]
    },
    &quot;state&quot;: {
      &quot;not_rooms&quot;: [
        &quot;!726s6s6q:example.com&quot;
      ],
      &quot;types&quot;: [
        &quot;m.room.*&quot;
      ]
    },
    &quot;timeline&quot;: {
      &quot;limit&quot;: 10,
      &quot;not_rooms&quot;: [
        &quot;!726s6s6q:example.com&quot;
      ],
      &quot;not_senders&quot;: [
        &quot;@spam:example.com&quot;
      ],
      &quot;types&quot;: [
        &quot;m.room.message&quot;
      ]
    }
  }
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;filter_id&quot;: &quot;66696p746572&quot;
}
</code></pre>
<h4 id="get-_matrixclientv3useruseridfilterfilterid">GET /_matrix/client/v3/user/{userId}/filter/{filterId}</h4>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;event_fields&quot;: [
    &quot;type&quot;,
    &quot;content&quot;,
    &quot;sender&quot;
  ],
  &quot;event_format&quot;: &quot;client&quot;,
  &quot;presence&quot;: {
    &quot;not_senders&quot;: [
      &quot;@alice:example.com&quot;
    ],
    &quot;types&quot;: [
      &quot;m.presence&quot;
    ]
  },
  &quot;room&quot;: {
    &quot;ephemeral&quot;: {
      &quot;not_rooms&quot;: [
        &quot;!726s6s6q:example.com&quot;
      ],
      &quot;not_senders&quot;: [
        &quot;@spam:example.com&quot;
      ],
      &quot;types&quot;: [
        &quot;m.receipt&quot;,
        &quot;m.typing&quot;
      ]
    },
    &quot;state&quot;: {
      &quot;not_rooms&quot;: [
        &quot;!726s6s6q:example.com&quot;
      ],
      &quot;types&quot;: [
        &quot;m.room.*&quot;
      ]
    },
    &quot;timeline&quot;: {
      &quot;limit&quot;: 10,
      &quot;not_rooms&quot;: [
        &quot;!726s6s6q:example.com&quot;
      ],
      &quot;not_senders&quot;: [
        &quot;@spam:example.com&quot;
      ],
      &quot;types&quot;: [
        &quot;m.room.message&quot;
      ]
    }
  }
}
</code></pre>
<h2 id="7">7 事件</h2>
<p>用戶端-伺服器 API 公開的對話歷史記錄模型可以 被視為事件清單。伺服器'行化'了 將事件的最終一致性事件圖轉換為"事件流" 任何給定的時間點:</p>
<pre><code>[E0]-&gt;[E1]-&gt;[E2]-&gt;[E3]-&gt;[E4]-&gt;[E5]
</code></pre>
<h3 id="71">7.1 房間活動的類型</h3>
<p>會議室活動分為兩類:</p>
<ul>
<li>狀態事件:這些是更新房間（例如房間）元數據狀態的事件 主題,房間成員資格等）。狀態由事件元組和 .具有相同鍵元組的房間中的狀態將是 覆蓋。typestate_key</li>
<li>消息事件:這些事件描述了房間中的暫時性'一次性'活動:通常是通信,例如發送即時消息或設置 網路電話呼叫。</li>
</ul>
<p>此規範概述了幾個事件,所有事件都具有事件類型 前綴。（有關 m. 事件,請參閱房間事件 規範。但是,應用程式可能希望添加自己的類型 事件,這可以使用 以下各節。如果添加了新事件,則事件鍵應 遵循 Java 包命名約定,例如
.這可確保事件類型合適 為每個應用程式命名,並降低衝突風險。m.typecom.example.myapp.event</p>
<h3 id="72">7.2 會議室事件格式</h3>
<p>聊天室事件的'聯合'格式,由主伺服器在內部使用 和通過伺服器-伺服器API的家庭伺服器之間,取決於"房間" 版本"在房間使用。例如,請參閱定義 房間版本 1 和房間版本 3.</p>
<p>但是,矩陣用戶端遇到此事件是不尋常的 格式。相反,主伺服器負責將事件轉換為 格式如下所示,以便用戶端可以輕鬆解析它們。</p>
<h4 id="clientevent">ClientEvent</h4>
<p>事件從主伺服器返回到用戶端時用於事件的格式 通過用戶端-伺服器 API,或透過應用程式服務 API 發送到應用程式服務。</p>
<p>例子</p>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;membership&quot;: &quot;join&quot;
  },
  &quot;event_id&quot;: &quot;$26RqwJMLw-yds1GAH_QxjHRC1Da9oasK0e5VLnck_45&quot;,
  &quot;origin_server_ts&quot;: 1632489532305,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;state_key&quot;: &quot;@user:example.org&quot;,
  &quot;type&quot;: &quot;m.room.member&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1567437,
    &quot;redacted_because&quot;: {
      &quot;content&quot;: {
        &quot;reason&quot;: &quot;spam&quot;
      },
      &quot;event_id&quot;: &quot;$Nhl3rsgHMjk-DjMJANawr9HHAhLg4GcoTYrSiYYGqEE&quot;,
      &quot;origin_server_ts&quot;: 1632491098485,
      &quot;redacts&quot;: &quot;$26RqwJMLw-yds1GAH_QxjHRC1Da9oasK0e5VLnck_45&quot;,
      &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
      &quot;sender&quot;: &quot;@moderator:example.org&quot;,
      &quot;type&quot;: &quot;m.room.redaction&quot;,
      &quot;unsigned&quot;: {
        &quot;age&quot;: 1257
      }
    }
  }
}
</code></pre>
<h3 id="73">7.3 剝離狀態</h3>
<p>剝離狀態是房間狀態的簡化視圖,旨在説明 潛在的細木工識別房間。它由一組有限的狀態事件組成 它們本身經過簡化以減少所需的數據量。</p>
<p>剝離的狀態事件只能存在, 和屬性。sendertypestate_keycontent</p>
<p>剝離狀態通常出現在邀請,敲門和其他位置,其中 用戶可以在可用條件（例如受限房間）下加入聊天室。</p>
<p>用戶端應僅在沒有 進入房間的正常狀態。一旦房間的狀態為 可用,應丟棄所有剝離狀態。在以下情況下 用戶端具有房間的存檔狀態（例如被踢后） 並且用戶端正在接收房間的剝離狀態,例如來自 邀請或敲門,則剝離狀態應優先,直到 可以從聯接中獲取新狀態。</p>
<p>剝離狀態應包含以下部分或全部狀態事件,這些事件 應盡可能表示為剝離的狀態事件:</p>
<ul>
<li>m.room.create</li>
<li>m.room.name</li>
<li>m.room.avatar</li>
<li>m.room.topic</li>
<li>m.room.join_rules</li>
<li>m.room.canonical_alias</li>
<li>m.room.encryption</li>
</ul>
<h3 id="74">7.4 大小限制</h3>
<p>格式化時,完整事件不得大於65536位元組 使用聯合事件格式,包括任何 簽名,並編碼為規範 傑森。</p>
<p>每個金鑰大小還有其他限制:</p>
<ul>
<li>sender不得超過255位元組（包括域）。</li>
<li>room_id不得超過 255 個字節。</li>
<li>state_key不得超過 255 個字節。</li>
<li>type不得超過 255 個字節。</li>
<li>event_id不得超過 255 個字節。</li>
</ul>
<p>某些事件類型具有指定的其他大小限制 在事件的描述中。附加鍵沒有限制其他 而不是事件的總 64 KiB 限制所暗示的。</p>
<h3 id="75">7.5 會議室活動</h3>
<p>此規範概述了幾種標準事件類型,所有這些事件類型都 前綴為m.</p>
<h4 id="mroomcanonical_alias">m.room.canonical_alias</h4>
<p>此事件用於通知聊天室應使用哪個別名 被認為是規範的,以及其他哪些別名指向房間。 這可以用於顯示目的或作為對別名用戶的建議 用於宣傳和訪問房間。</p>
<p>例子</p>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;alias&quot;: &quot;#somewhere:localhost&quot;,
    &quot;alt_aliases&quot;: [
      &quot;#somewhere:example.org&quot;,
      &quot;#myroom:example.com&quot;
    ]
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;state_key&quot;: &quot;&quot;,
  &quot;type&quot;: &quot;m.room.canonical_alias&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<h4 id="mroomcreate">m.room.create</h4>
<p>這是會議室中的第一個事件,無法更改。它充當所有其他事件的根。</p>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;creator&quot;: &quot;@example:example.org&quot;,
    &quot;m.federate&quot;: true,
    &quot;predecessor&quot;: {
      &quot;event_id&quot;: &quot;$something:example.org&quot;,
      &quot;room_id&quot;: &quot;!oldroom:example.org&quot;
    },
    &quot;room_version&quot;: &quot;1&quot;
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;state_key&quot;: &quot;&quot;,
  &quot;type&quot;: &quot;m.room.create&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<h4 id="mroomjoin_rules">m.room.join_rules</h4>
<p>房間可以具有以下名稱之一:</p>
<ul>
<li>public- 任何人都可以加入房間,無需事先執行任何操作。</li>
<li>invite- 用戶必須首先收到會議室中已有人員的邀請 為了加入。</li>
<li>knock- 用戶可以請求邀請加入房間。他們可以被允許（邀請） 或拒絕（踢/禁止）訪問。否則,需要邀請使用者加入。只 可在支持敲門的房間使用。</li>
<li>restricted- 任何能夠滿足至少一個允許條件的人都是 無需事先操作即可加入房間。否則,需要邀請。 僅適用於支援加入規則的房間。</li>
<li>knock_restricted- 用戶可以使用提供的相同功能請求邀請 通過加入規則,或者可以在滿足允許條件的情況下嘗試加入 根據聯接規則。僅適用於支援加入規則的房間。knockrestricted</li>
<li>private- 保留而不實施。沒有重要意義。</li>
</ul>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;join_rule&quot;: &quot;public&quot;
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;state_key&quot;: &quot;&quot;,
  &quot;type&quot;: &quot;m.room.join_rules&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;allow&quot;: [
      {
        &quot;room_id&quot;: &quot;!other:example.org&quot;,
        &quot;type&quot;: &quot;m.room_membership&quot;
      },
      {
        &quot;room_id&quot;: &quot;!elsewhere:example.org&quot;,
        &quot;type&quot;: &quot;m.room_membership&quot;
      }
    ],
    &quot;join_rule&quot;: &quot;restricted&quot;
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;state_key&quot;: &quot;&quot;,
  &quot;type&quot;: &quot;m.room.join_rules&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<h4 id="mroommember">m.room.member</h4>
<p>調整聊天室中用戶的成員身份狀態。最好在執行成員資格操作時使用成員資格 API（ 等）,而不是直接調整狀態,因為存在一組受限制的有效轉換。例如,使用者 A 無法強制使用者 B
加入聊天室,並且嘗試直接強制更改此狀態將失敗。/rooms/<room id>/invite</p>
<p>指定了以下成員資格狀態:</p>
<ul>
<li>invite- 使用者已被邀請加入聊天室,但尚未加入該聊天室。在加入之前,他們不得參加會議室。</li>
<li>join- 使用者已加入聊天室（可能在接受邀請后）,並可能參與其中。</li>
<li>leave- 用戶曾經加入房間,但後來離開了（可能是出於選擇,也可能是被踢）。</li>
<li>ban- 使用者已被禁止進入聊天室,並且不再被允許加入聊天室,直到他們被取消禁止進入聊天室（通過將其成員身份狀態設置為非 值）。ban</li>
<li>knock- 使用者已敲房間,請求允許參與。在加入之前,他們不得參加會議室。</li>
</ul>
<p>如果此邀請是事件並且是事件的後續事件,則設置該屬性,否則不存在。third_party_inviteinvitem.room.third_party_invite</p>
<p>此事件還可能包含事件數據中的鍵。 如果存在,則包含一組剝離狀態事件,以説明接收器識別房間。invite_room_stateunsigned</p>
<p>套用成員資格的使用者由 .在某些情況下, 和可能不匹配 - 這可能被解釋為影響 用戶的成員身份狀態。state_keysenderstate_keysenderstate_key</p>
<p>給定使用者的 TO 可能會隨時間而變化。下表列出了各種更改 隨時間推移以及客戶端和伺服器必須如何解釋這些更改。可以檢索以前的會員資格 從事件上的物件。如果不存在,則必須假定使用者以前的成員身份
如。membershipprev_contentleave</p>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;avatar_url&quot;: &quot;mxc://example.org/SEsfnsuifSDFSSEF&quot;,
    &quot;displayname&quot;: &quot;Alice Margatroid&quot;,
    &quot;membership&quot;: &quot;join&quot;,
    &quot;reason&quot;: &quot;Looking for support&quot;
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;state_key&quot;: &quot;@alice:example.org&quot;,
  &quot;type&quot;: &quot;m.room.member&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;avatar_url&quot;: &quot;mxc://example.org/SEsfnsuifSDFSSEF&quot;,
    &quot;displayname&quot;: &quot;Alice Margatroid&quot;,
    &quot;membership&quot;: &quot;invite&quot;,
    &quot;reason&quot;: &quot;Looking for support&quot;
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;state_key&quot;: &quot;@alice:example.org&quot;,
  &quot;type&quot;: &quot;m.room.member&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234,
    &quot;invite_room_state&quot;: [
      {
        &quot;content&quot;: {
          &quot;name&quot;: &quot;Example Room&quot;
        },
        &quot;sender&quot;: &quot;@bob:example.org&quot;,
        &quot;state_key&quot;: &quot;&quot;,
        &quot;type&quot;: &quot;m.room.name&quot;
      },
      {
        &quot;content&quot;: {
          &quot;join_rule&quot;: &quot;invite&quot;
        },
        &quot;sender&quot;: &quot;@bob:example.org&quot;,
        &quot;state_key&quot;: &quot;&quot;,
        &quot;type&quot;: &quot;m.room.join_rules&quot;
      }
    ]
  }
}
</code></pre>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;avatar_url&quot;: &quot;mxc://example.org/SEsfnsuifSDFSSEF&quot;,
    &quot;displayname&quot;: &quot;Alice Margatroid&quot;,
    &quot;join_authorised_via_users_server&quot;: &quot;@bob:other.example.org&quot;,
    &quot;membership&quot;: &quot;join&quot;
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;state_key&quot;: &quot;@alice:example.org&quot;,
  &quot;type&quot;: &quot;m.room.member&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;avatar_url&quot;: &quot;mxc://example.org/SEsfnsuifSDFSSEF&quot;,
    &quot;displayname&quot;: &quot;Alice Margatroid&quot;,
    &quot;membership&quot;: &quot;knock&quot;,
    &quot;reason&quot;: &quot;Looking for support&quot;
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;state_key&quot;: &quot;@alice:example.org&quot;,
  &quot;type&quot;: &quot;m.room.member&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234,
    &quot;knock_room_state&quot;: [
      {
        &quot;content&quot;: {
          &quot;name&quot;: &quot;Example Room&quot;
        },
        &quot;sender&quot;: &quot;@bob:example.org&quot;,
        &quot;state_key&quot;: &quot;&quot;,
        &quot;type&quot;: &quot;m.room.name&quot;
      },
      {
        &quot;content&quot;: {
          &quot;join_rule&quot;: &quot;knock&quot;
        },
        &quot;sender&quot;: &quot;@bob:example.org&quot;,
        &quot;state_key&quot;: &quot;&quot;,
        &quot;type&quot;: &quot;m.room.join_rules&quot;
      }
    ]
  }
}
</code></pre>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;avatar_url&quot;: &quot;mxc://example.org/SEsfnsuifSDFSSEF&quot;,
    &quot;displayname&quot;: &quot;Alice Margatroid&quot;,
    &quot;membership&quot;: &quot;invite&quot;,
    &quot;third_party_invite&quot;: {
      &quot;display_name&quot;: &quot;alice&quot;,
      &quot;signed&quot;: {
        &quot;mxid&quot;: &quot;@alice:example.org&quot;,
        &quot;signatures&quot;: {
          &quot;magic.forest&quot;: {
            &quot;ed25519:3&quot;: &quot;fQpGIW1Snz+pwLZu6sTy2aHy/DYWWTspTJRPyNp0PKkymfIsNffysMl6ObMMFdIJhk6g6pwlIqZ54rxo8SLmAg&quot;
          }
        },
        &quot;token&quot;: &quot;abc123&quot;
      }
    }
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;state_key&quot;: &quot;@alice:example.org&quot;,
  &quot;type&quot;: &quot;m.room.member&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<h4 id="mroompower_levels">m.room.power_levels</h4>
<p>此事件指定用戶必須具有的最低級別才能執行 某些動作。它還指定檔室中每個用戶的級別。</p>
<p>如果 a 在清單中,則具有 相關的功率級別。否則,它們具有默認級別。如果未提供,則假定為 0. 如果聊天室不包含任何事件,則聊天室的建立者具有 功率級別為 100,所有其他使用者的功率級別為
0。user_idusersuser_idusers_defaultusers_defaultm.room.power_levels</p>
<p>發送特定事件所需的級別由和控制。如果在 中指定了事件類型,則用戶必須至少具有指定的級別,以便 發送該事件。如果未提供事件類型,則預設為 for 消息事件和 state
事件。eventsstate_defaultevents_defaulteventsevents_defaultstate_default</p>
<p>如果事件中沒有state_default,或者 m.room.power_levels沒有事件,是 m.room.power_levels 50。 如果事件中沒有state_default, 或者沒有事件events_default,則為
0。</p>
<p>邀請使用者加入聊天室所需的功率級別,將使用者踢出 聊天室,禁止使用者進入聊天室或編輯其他用戶發送的事件是 分別由, , 和定義。關卡 ,如果未在事件中指定,或者檔室不包含任何事件,則預設為 50。 在任一情況下均預設為 0。invite
kick ban redact kick ban redact m.room.power_levels m.room.power_levels invite</p>
<p>諾維克斯</p>
<p>功率電平值的允許範圍為 , 按照規範 JSON 規範的要求。[-(2<strong>53)+1, (2</strong>53)-1]</p>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;ban&quot;: 50,
    &quot;events&quot;: {
      &quot;m.room.name&quot;: 100,
      &quot;m.room.power_levels&quot;: 100
    },
    &quot;events_default&quot;: 0,
    &quot;invite&quot;: 50,
    &quot;kick&quot;: 50,
    &quot;notifications&quot;: {
      &quot;room&quot;: 20
    },
    &quot;redact&quot;: 50,
    &quot;state_default&quot;: 50,
    &quot;users&quot;: {
      &quot;@example:localhost&quot;: 100
    },
    &quot;users_default&quot;: 0
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;state_key&quot;: &quot;&quot;,
  &quot;type&quot;: &quot;m.room.power_levels&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<h4 id="751">7.5.1 歷史事件</h4>
<p>但是,命名空間中的某些事件可能會出現在聊天室中 它們在此版本的規範中沒有重要意義。 它們是:m.</p>
<ul>
<li>m.room.aliases</li>
</ul>
<p>該規範的先前版本提供了有關這些的更多資訊 事件。</p>
<h3 id="76">7.6 同步</h3>
<p>若要讀取事件,預期的操作流是用戶端首先 調用不帶參數的 /sync API。這將返回 每個聊天室的最新消息事件,以及 返回時間線開頭的房間。回應還包括一個字段,該字段應在下次調用 時用作參數的值。最後,回應包括:
對於每個房間,一個字段,該字段可以作為參數傳遞給 /rooms/<room_id>/messages API 以提前檢索 消息。sincenext_batchsince/syncprev_batchstart</p>
<p>例如,一個請求可能會返回一個由四個事件組成的範圍,並在給定的房間內,省略兩個先前的事件和 。這可以可視化如下:/syncE2E3E4E5E0E1</p>
<pre><code>    [E0]-&gt;[E1]-&gt;[E2]-&gt;[E3]-&gt;[E4]-&gt;[E5]
               ^                      ^
               |                      |
         prev_batch: '1-2-3'        next_batch: 'a-b-c'
</code></pre>
<p>通常,客戶端可見的所有新事件都將出現在 對 API 的回應。但是,如果大量事件 在調用 之間到達,返回'有限'時間線, 僅包含最新的消息事件。狀態"delta"也是 返回,總結省略部分的任何狀態更改
時間軸。因此,客戶最終可能會在其知識上出現"差距" 的消息時間線。用戶端可以使用 /rooms/<room_id>/messages API 填充這些空白。/sync/sync</p>
<p>繼續我們的示例,假設我們發出第三個請求,要求 自上次同步以來的事件,通過將令牌作為 參數。伺服器知道四個新事件,, 和 ,但認為這太多了,無法一次報告。相反 伺服器發送包含的回應,並且
省略。這形成了一個缺口,我們可以在可視化中看到:/syncnext_batchx-y-zsinceE7E8E9E10limitedE8E9E10E7</p>
<pre><code>                                            | gap |
                                            | &lt;-&gt; |
    [E0]-&gt;[E1]-&gt;[E2]-&gt;[E3]-&gt;[E4]-&gt;[E5]-&gt;[E6]-&gt;[E7]-&gt;[E8]-&gt;[E9]-&gt;[E10]
                                            ^     ^                  ^
                                            |     |                  |
                                 since: 'x-y-z'   |                  |
                                       prev_batch: 'd-e-f'       next_batch: 'u-v-w'
</code></pre>
<p>有限的回應包括一個狀態增量,它描述了狀態 的房間在間隙上變化。此增量說明如何構建狀態 在從用戶端知道的狀態返回時間線（即在）之前 （即在 ）。為了縮小差距,客戶端應該使用查詢參數和 向 /rooms/<room_id>/messages
發出請求。E7E6from=x-y-zto=d-e-f</p>
<h4 id="get-_matrixclientv3sync">GET /_matrix/client/v3/sync</h4>
<p>將客戶端的狀態與伺服器上的最新狀態同步。 用戶端在首次登錄時使用此 API 以獲取初始快照 的狀態,然後繼續調用此 API 獲取 增量增量到狀態,並接收新消息。</p>
<p>注意:此端點支援延遲載入。有關詳細資訊,請參閱篩選。延遲載入成員僅在此端點上受支援。啟用延遲載入後,伺服器必須包括 當使用者加入聊天室時同步自己的成員資格事件,或者當使用者 請求房間的完整狀態,以幫助發現用戶的頭像和
顯示名稱。StateFilter</p>
<p>此外,與其他會員一樣,使用者自己的會員活動也符合條件 被伺服器視為冗餘。當同步為 時 , 伺服器必須返回間隙中事件的成員身份事件 （在返回的時間線之間和開始之間）,無論 至於它們是否是多餘的。這可確保連接/離開
並且在間隙期間發生的輪廓變化不會丟失。limitedsince</p>
<p>請注意,的預設行為是包括所有成員資格 事件以及其他狀態,當未啟用延遲載入時。state</p>
<p>200回應</p>
<pre><code class="language-json">{
  &quot;account_data&quot;: {
    &quot;events&quot;: [
      {
        &quot;content&quot;: {
          &quot;custom_config_key&quot;: &quot;custom_config_value&quot;
        },
        &quot;type&quot;: &quot;org.example.custom.config&quot;
      }
    ]
  },
  &quot;next_batch&quot;: &quot;s72595_4483_1934&quot;,
  &quot;presence&quot;: {
    &quot;events&quot;: [
      {
        &quot;content&quot;: {
          &quot;avatar_url&quot;: &quot;mxc://localhost/wefuiwegh8742w&quot;,
          &quot;currently_active&quot;: false,
          &quot;last_active_ago&quot;: 2478593,
          &quot;presence&quot;: &quot;online&quot;,
          &quot;status_msg&quot;: &quot;Making cupcakes&quot;
        },
        &quot;sender&quot;: &quot;@example:localhost&quot;,
        &quot;type&quot;: &quot;m.presence&quot;
      }
    ]
  },
  &quot;rooms&quot;: {
    &quot;invite&quot;: {
      &quot;!696r7674:example.com&quot;: {
        &quot;invite_state&quot;: {
          &quot;events&quot;: [
            {
              &quot;content&quot;: {
                &quot;name&quot;: &quot;My Room Name&quot;
              },
              &quot;sender&quot;: &quot;@alice:example.com&quot;,
              &quot;state_key&quot;: &quot;&quot;,
              &quot;type&quot;: &quot;m.room.name&quot;
            },
            {
              &quot;content&quot;: {
                &quot;membership&quot;: &quot;invite&quot;
              },
              &quot;sender&quot;: &quot;@alice:example.com&quot;,
              &quot;state_key&quot;: &quot;@bob:example.com&quot;,
              &quot;type&quot;: &quot;m.room.member&quot;
            }
          ]
        }
      }
    },
    &quot;join&quot;: {
      &quot;!726s6s6q:example.com&quot;: {
        &quot;account_data&quot;: {
          &quot;events&quot;: [
            {
              &quot;content&quot;: {
                &quot;tags&quot;: {
                  &quot;u.work&quot;: {
                    &quot;order&quot;: 0.9
                  }
                }
              },
              &quot;type&quot;: &quot;m.tag&quot;
            },
            {
              &quot;content&quot;: {
                &quot;custom_config_key&quot;: &quot;custom_config_value&quot;
              },
              &quot;type&quot;: &quot;org.example.custom.room.config&quot;
            }
          ]
        },
        &quot;ephemeral&quot;: {
          &quot;events&quot;: [
            {
              &quot;content&quot;: {
                &quot;user_ids&quot;: [
                  &quot;@alice:matrix.org&quot;,
                  &quot;@bob:example.com&quot;
                ]
              },
              &quot;type&quot;: &quot;m.typing&quot;
            },
            {
              &quot;content&quot;: {
                &quot;$1435641916114394fHBLK:matrix.org&quot;: {
                  &quot;m.read&quot;: {
                    &quot;@rikj:jki.re&quot;: {
                      &quot;ts&quot;: 1436451550453
                    }
                  },
                  &quot;m.read.private&quot;: {
                    &quot;@self:example.org&quot;: {
                      &quot;ts&quot;: 1661384801651
                    }
                  }
                }
              },
              &quot;type&quot;: &quot;m.receipt&quot;
            }
          ]
        },
        &quot;state&quot;: {
          &quot;events&quot;: [
            {
              &quot;content&quot;: {
                &quot;avatar_url&quot;: &quot;mxc://example.org/SEsfnsuifSDFSSEF&quot;,
                &quot;displayname&quot;: &quot;Alice Margatroid&quot;,
                &quot;membership&quot;: &quot;join&quot;,
                &quot;reason&quot;: &quot;Looking for support&quot;
              },
              &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
              &quot;origin_server_ts&quot;: 1432735824653,
              &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
              &quot;sender&quot;: &quot;@example:example.org&quot;,
              &quot;state_key&quot;: &quot;@alice:example.org&quot;,
              &quot;type&quot;: &quot;m.room.member&quot;,
              &quot;unsigned&quot;: {
                &quot;age&quot;: 1234
              }
            }
          ]
        },
        &quot;summary&quot;: {
          &quot;m.heroes&quot;: [
            &quot;@alice:example.com&quot;,
            &quot;@bob:example.com&quot;
          ],
          &quot;m.invited_member_count&quot;: 0,
          &quot;m.joined_member_count&quot;: 2
        },
        &quot;timeline&quot;: {
          &quot;events&quot;: [
            {
              &quot;content&quot;: {
                &quot;avatar_url&quot;: &quot;mxc://example.org/SEsfnsuifSDFSSEF&quot;,
                &quot;displayname&quot;: &quot;Alice Margatroid&quot;,
                &quot;membership&quot;: &quot;join&quot;,
                &quot;reason&quot;: &quot;Looking for support&quot;
              },
              &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
              &quot;origin_server_ts&quot;: 1432735824653,
              &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
              &quot;sender&quot;: &quot;@example:example.org&quot;,
              &quot;state_key&quot;: &quot;@alice:example.org&quot;,
              &quot;type&quot;: &quot;m.room.member&quot;,
              &quot;unsigned&quot;: {
                &quot;age&quot;: 1234
              }
            },
            {
              &quot;content&quot;: {
                &quot;body&quot;: &quot;This is an example text message&quot;,
                &quot;format&quot;: &quot;org.matrix.custom.html&quot;,
                &quot;formatted_body&quot;: &quot;&lt;b&gt;This is an example text message&lt;/b&gt;&quot;,
                &quot;msgtype&quot;: &quot;m.text&quot;
              },
              &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
              &quot;origin_server_ts&quot;: 1432735824653,
              &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
              &quot;sender&quot;: &quot;@example:example.org&quot;,
              &quot;type&quot;: &quot;m.room.message&quot;,
              &quot;unsigned&quot;: {
                &quot;age&quot;: 1234
              }
            }
          ],
          &quot;limited&quot;: true,
          &quot;prev_batch&quot;: &quot;t34-23535_0_0&quot;
        },
        &quot;unread_notifications&quot;: {
          &quot;highlight_count&quot;: 1,
          &quot;notification_count&quot;: 5
        },
        &quot;unread_thread_notifications&quot;: {
          &quot;$threadroot&quot;: {
            &quot;highlight_count&quot;: 3,
            &quot;notification_count&quot;: 6
          }
        }
      }
    },
    &quot;knock&quot;: {
      &quot;!223asd456:example.com&quot;: {
        &quot;knock_state&quot;: {
          &quot;events&quot;: [
            {
              &quot;content&quot;: {
                &quot;name&quot;: &quot;My Room Name&quot;
              },
              &quot;sender&quot;: &quot;@alice:example.com&quot;,
              &quot;state_key&quot;: &quot;&quot;,
              &quot;type&quot;: &quot;m.room.name&quot;
            },
            {
              &quot;content&quot;: {
                &quot;membership&quot;: &quot;knock&quot;
              },
              &quot;sender&quot;: &quot;@bob:example.com&quot;,
              &quot;state_key&quot;: &quot;@bob:example.com&quot;,
              &quot;type&quot;: &quot;m.room.member&quot;
            }
          ]
        }
      }
    },
    &quot;leave&quot;: {}
  }
}
</code></pre>
<h3 id="77">7.7 獲取聊天室的事件</h3>
<p>為聊天室的事件提供了多個 API:</p>
<h4 id="get-_matrixclientv3roomsroomideventeventid">GET /_matrix/client/v3/rooms/{roomId}/event/{eventId}</h4>
<p>獲取基於的單個事件。您必須具有以下權限:檢索此事件,例如,通過成為此事件房間中的成員。roomId/eventId</p>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;body&quot;: &quot;This is an example text message&quot;,
    &quot;format&quot;: &quot;org.matrix.custom.html&quot;,
    &quot;formatted_body&quot;: &quot;&lt;b&gt;This is an example text message&lt;/b&gt;&quot;,
    &quot;msgtype&quot;: &quot;m.text&quot;
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!636q39766251:matrix.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;type&quot;: &quot;m.room.message&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<h4 id="get-_matrixclientv3roomsroomidjoined_members">GET /_matrix/client/v3/rooms/{roomId}/joined_members</h4>
<p>此 API 將 MXID 的映射返回到聊天室成員的成員信息物件。當前用戶必須在聊天室中才能工作,除非它是應用程式服務,在這種情況下,任何 AS 的使用者都必須在聊天室中。此 API
主要用於應用程式服務,回應速度應快於在伺服器上更高效地實現。/members</p>
<pre><code class="language-json">{
  &quot;joined&quot;: {
    &quot;@bar:example.com&quot;: {
      &quot;avatar_url&quot;: &quot;mxc://riot.ovh/printErCATzZijQsSDWorRaK&quot;,
      &quot;display_name&quot;: &quot;Bar&quot;
    }
  }
}
</code></pre>
<h4 id="get-_matrixclientv3roomsroomidmembers">GET /_matrix/client/v3/rooms/{roomId}/members</h4>
<p>獲取此會議室的成員清單。</p>
<pre><code class="language-json">{
  &quot;chunk&quot;: [
    {
      &quot;content&quot;: {
        &quot;avatar_url&quot;: &quot;mxc://example.org/SEsfnsuifSDFSSEF&quot;,
        &quot;displayname&quot;: &quot;Alice Margatroid&quot;,
        &quot;membership&quot;: &quot;join&quot;,
        &quot;reason&quot;: &quot;Looking for support&quot;
      },
      &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
      &quot;origin_server_ts&quot;: 1432735824653,
      &quot;room_id&quot;: &quot;!636q39766251:example.com&quot;,
      &quot;sender&quot;: &quot;@example:example.org&quot;,
      &quot;state_key&quot;: &quot;@alice:example.org&quot;,
      &quot;type&quot;: &quot;m.room.member&quot;,
      &quot;unsigned&quot;: {
        &quot;age&quot;: 1234
      }
    }
  ]
}
</code></pre>
<h4 id="get-_matrixclientv3roomsroomidstate">GET /_matrix/client/v3/rooms/{roomId}/state</h4>
<p>獲取聊天室當前狀態的狀態事件。</p>
<pre><code class="language-json">[
  {
    &quot;content&quot;: {
      &quot;join_rule&quot;: &quot;public&quot;
    },
    &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
    &quot;origin_server_ts&quot;: 1432735824653,
    &quot;room_id&quot;: &quot;!636q39766251:example.com&quot;,
    &quot;sender&quot;: &quot;@example:example.org&quot;,
    &quot;state_key&quot;: &quot;&quot;,
    &quot;type&quot;: &quot;m.room.join_rules&quot;,
    &quot;unsigned&quot;: {
      &quot;age&quot;: 1234
    }
  },
  {
    &quot;content&quot;: {
      &quot;avatar_url&quot;: &quot;mxc://example.org/SEsfnsuifSDFSSEF&quot;,
      &quot;displayname&quot;: &quot;Alice Margatroid&quot;,
      &quot;membership&quot;: &quot;join&quot;,
      &quot;reason&quot;: &quot;Looking for support&quot;
    },
    &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
    &quot;origin_server_ts&quot;: 1432735824653,
    &quot;room_id&quot;: &quot;!636q39766251:example.com&quot;,
    &quot;sender&quot;: &quot;@example:example.org&quot;,
    &quot;state_key&quot;: &quot;@alice:example.org&quot;,
    &quot;type&quot;: &quot;m.room.member&quot;,
    &quot;unsigned&quot;: {
      &quot;age&quot;: 1234
    }
  },
  {
    &quot;content&quot;: {
      &quot;creator&quot;: &quot;@example:example.org&quot;,
      &quot;m.federate&quot;: true,
      &quot;predecessor&quot;: {
        &quot;event_id&quot;: &quot;$something:example.org&quot;,
        &quot;room_id&quot;: &quot;!oldroom:example.org&quot;
      },
      &quot;room_version&quot;: &quot;1&quot;
    },
    &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
    &quot;origin_server_ts&quot;: 1432735824653,
    &quot;room_id&quot;: &quot;!636q39766251:example.com&quot;,
    &quot;sender&quot;: &quot;@example:example.org&quot;,
    &quot;state_key&quot;: &quot;&quot;,
    &quot;type&quot;: &quot;m.room.create&quot;,
    &quot;unsigned&quot;: {
      &quot;age&quot;: 1234
    }
  },
  {
    &quot;content&quot;: {
      &quot;ban&quot;: 50,
      &quot;events&quot;: {
        &quot;m.room.name&quot;: 100,
        &quot;m.room.power_levels&quot;: 100
      },
      &quot;events_default&quot;: 0,
      &quot;invite&quot;: 50,
      &quot;kick&quot;: 50,
      &quot;notifications&quot;: {
        &quot;room&quot;: 20
      },
      &quot;redact&quot;: 50,
      &quot;state_default&quot;: 50,
      &quot;users&quot;: {
        &quot;@example:localhost&quot;: 100
      },
      &quot;users_default&quot;: 0
    },
    &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
    &quot;origin_server_ts&quot;: 1432735824653,
    &quot;room_id&quot;: &quot;!636q39766251:example.com&quot;,
    &quot;sender&quot;: &quot;@example:example.org&quot;,
    &quot;state_key&quot;: &quot;&quot;,
    &quot;type&quot;: &quot;m.room.power_levels&quot;,
    &quot;unsigned&quot;: {
      &quot;age&quot;: 1234
    }
  }
]
</code></pre>
<h4 id="get-_matrixclientv3roomsroomidstateeventtypestatekey">GET /_matrix/client/v3/rooms/{roomId}/state/{eventType}/{stateKey}</h4>
<p>查找檔室中狀態事件的內容。如果使用者是 加入到房間,然後狀態從當前獲取 房間的狀態。如果用戶已離開房間,則狀態為 取自他們離開時的房間狀態。</p>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;Example room name&quot;
}
</code></pre>
<h4 id="get-_matrixclientv3roomsroomidmessages">GET /_matrix/client/v3/rooms/{roomId}/messages</h4>
<p>此 API 返回聊天室的消息和狀態事件清單。它使用 分頁查詢參數,用於對房間中的歷史記錄進行分頁。</p>
<p>注:此端點支援延遲載入檔案室成員事件。有關詳細資訊,請參閱懶惰載入室成員。</p>
<pre><code class="language-json">{
  &quot;chunk&quot;: [
    {
      &quot;content&quot;: {
        &quot;body&quot;: &quot;This is an example text message&quot;,
        &quot;format&quot;: &quot;org.matrix.custom.html&quot;,
        &quot;formatted_body&quot;: &quot;&lt;b&gt;This is an example text message&lt;/b&gt;&quot;,
        &quot;msgtype&quot;: &quot;m.text&quot;
      },
      &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
      &quot;origin_server_ts&quot;: 1432735824653,
      &quot;room_id&quot;: &quot;!636q39766251:example.com&quot;,
      &quot;sender&quot;: &quot;@example:example.org&quot;,
      &quot;type&quot;: &quot;m.room.message&quot;,
      &quot;unsigned&quot;: {
        &quot;age&quot;: 1234
      }
    },
    {
      &quot;content&quot;: {
        &quot;name&quot;: &quot;The room name&quot;
      },
      &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
      &quot;origin_server_ts&quot;: 1432735824653,
      &quot;room_id&quot;: &quot;!636q39766251:example.com&quot;,
      &quot;sender&quot;: &quot;@example:example.org&quot;,
      &quot;state_key&quot;: &quot;&quot;,
      &quot;type&quot;: &quot;m.room.name&quot;,
      &quot;unsigned&quot;: {
        &quot;age&quot;: 1234
      }
    },
    {
      &quot;content&quot;: {
        &quot;body&quot;: &quot;Gangnam Style&quot;,
        &quot;info&quot;: {
          &quot;duration&quot;: 2140786,
          &quot;h&quot;: 320,
          &quot;mimetype&quot;: &quot;video/mp4&quot;,
          &quot;size&quot;: 1563685,
          &quot;thumbnail_info&quot;: {
            &quot;h&quot;: 300,
            &quot;mimetype&quot;: &quot;image/jpeg&quot;,
            &quot;size&quot;: 46144,
            &quot;w&quot;: 300
          },
          &quot;thumbnail_url&quot;: &quot;mxc://example.org/FHyPlCeYUSFFxlgbQYZmoEoe&quot;,
          &quot;w&quot;: 480
        },
        &quot;msgtype&quot;: &quot;m.video&quot;,
        &quot;url&quot;: &quot;mxc://example.org/a526eYUSFFxlgbQYZmo442&quot;
      },
      &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
      &quot;origin_server_ts&quot;: 1432735824653,
      &quot;room_id&quot;: &quot;!636q39766251:example.com&quot;,
      &quot;sender&quot;: &quot;@example:example.org&quot;,
      &quot;type&quot;: &quot;m.room.message&quot;,
      &quot;unsigned&quot;: {
        &quot;age&quot;: 1234
      }
    }
  ],
  &quot;end&quot;: &quot;t47409-4357353_219380_26003_2265&quot;,
  &quot;start&quot;: &quot;t47429-4392820_219380_26003_2265&quot;
}
</code></pre>
<h4 id="get-_matrixclientv1roomsroomidtimestamp_to_event">GET /_matrix/client/v1/rooms/{roomId}/timestamp_to_event</h4>
<p>v1.6 中新增</p>
<p>獲取最接近給定時間戳的事件的ID,在 參數指定的方向。dir</p>
<p>如果伺服器沒有所有房間歷史記錄,並且沒有 適當接近請求時間戳的事件,它可以使用 相應的聯合終結點,用於向其他伺服器請求合適的事件。</p>
<p>調用此終結點后,用戶端可以調用 /rooms/{roomId}/context/{eventId} 來獲取分頁令牌,以檢索返回事件周圍的事件。</p>
<p>此終結點返回的事件可能是用戶端返回的事件 無法呈現,因此可能需要分頁才能找到事件 它可以顯示,最終可能會超出用戶端的 合適的範圍。客戶可以採用不同的策略來展示 對用戶來說合理的東西。例如,用戶端可以嘗試 朝一個方向分頁一會兒,同時看著
它正在分頁的事件的時間戳,以及它是否 超過與目標時間戳的一定差異,可以嘗試 以相反的方向分頁。客戶也可以簡單地 在一個方向上分頁,並通知使用者最近的事件 在該方向上發現超出了預期範圍。</p>
<pre><code class="language-json">{
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653
}
</code></pre>
<h3 id="78">7.8 將事件發送到聊天室</h3>
<p>如果某些事件與另一個事件相關,則伺服器可能需要對其進行後處理。該活動的 關係類型 （） 確定可能適用的任何限制, 例如,使用者只能發送一個給定類型的事件 到另一個。rel_type</p>
<h4 id="put-_matrixclientv3roomsroomidstateeventtypestatekey">PUT /_matrix/client/v3/rooms/{roomId}/state/{eventType}/{stateKey}</h4>
<p>可以使用此終結點發送狀態事件。這些事件將是 覆蓋 if 和所有 火柴。<room id><event type><state key></p>
<p>對此端點的請求不能像其他路徑一樣使用事務 ID,因為它們無法與 .此外,在狀態路徑上不受支援。PUTstate_keyPOST</p>
<p>請求的正文應該是事件的內容物件;這 此物件中的欄位將根據事件類型而有所不同。有關活動規範,請參閱會議室活動。m.</p>
<p>如果要發送的事件類型是伺服器 應確保事件中列出的任何新別名都有效 根據他們的語法/句法,並且他們指向房間ID其中 將發送狀態事件。伺服器不驗證別名 正在刪除或已存在於狀態事件中。m.room.canonical_alias</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;avatar_url&quot;: &quot;mxc://localhost/SEsfnsuifSDFSSEF&quot;,
  &quot;displayname&quot;: &quot;Alice Margatroid&quot;,
  &quot;membership&quot;: &quot;join&quot;
}
</code></pre>
<p>200回應</p>
<pre><code class="language-json">{
  &quot;event_id&quot;: &quot;$YUwRidLecu:example.com&quot;
}
</code></pre>
<h4 id="put-_matrixclientv3roomsroomidsendeventtypetxnid">PUT /_matrix/client/v3/rooms/{roomId}/send/{eventType}/{txnId}</h4>
<p>此終結點用於將消息事件發送到聊天室。消息事件 允許訪問歷史事件和分頁,使其適合 用於房間內的'一次性'活動。</p>
<p>請求的正文應該是事件的內容物件;這 此物件中的欄位將根據事件類型而有所不同。有關 m. 事件規範,請參閱會議室事件。</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;body&quot;: &quot;hello&quot;,
  &quot;msgtype&quot;: &quot;m.text&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;event_id&quot;: &quot;$YUwRidLecu:example.com&quot;
}
</code></pre>
<h3 id="79">7.9 密文</h3>
<p>由於事件是可擴展的,因此惡意使用者和/或 伺服器,用於添加諸如攻擊性或非法的密鑰。因為 有些事件不能簡單地刪除,例如會員活動,我們取而代之的是 "編輯"事件。這涉及從事件中刪除所有鍵 協定不需要。此後,此精簡事件
每當客戶端或遠端伺服器請求它時返回。編輯一個 事件無法撤銷,允許伺服器擁有者刪除有問題的 資料庫中的內容。伺服器應在向用戶端提供經過編輯的事件時在 as
下包含事件的副本。m.room.redactionunsignedredacted_because</p>
<p>在房間中定義要應用於事件的確切演算法 版本規範,以及主伺服器應遵循的標準 在決定是否接受來自遠端的編校事件時使用 主伺服器。</p>
<p>當用戶端收到事件時,它應該更改 受影響的事件與伺服器相同。m.room.redaction</p>
<h4 id="791">7.9.1 事件</h4>
<h5 id="mroomredaction">m.room.redaction</h5>
<p>此事件由伺服器創建,用於描述已編輯的事件,由誰編輯以及（可選）原因。已編輯的事件在事件級別鍵中指定。編輯事件意味著協定不需要的所有密鑰都會被剝離,從而允許隱藏消息或允許管理員刪除冒犯性或非法內容。redacts</p>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;reason&quot;: &quot;Spamming&quot;
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;redacts&quot;: &quot;$fukweghifu23:localhost&quot;,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;type&quot;: &quot;m.room.redaction&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<h4 id="792">7.9.2 客戶端行為</h4>
<h5 id="put-_matrixclientv3roomsroomidredacteventidtxnid">PUT /_matrix/client/v3/rooms/{roomId}/redact/{eventId}/{txnId}</h5>
<p>從對 聊天室的伺服器端表示形式的完整性。</p>
<p>這是無法撤銷的。</p>
<p>任何功率級別大於或等於事件功率級別的使用者都可以在聊天室中發送密文事件。如果用戶的電源 電平大於也大於或等於功率電平 ,用戶可以編輯其他用戶發送的事件。m.room.redactionredact</p>
<p>伺服器管理員可以編輯使用者在其伺服器上發送的事件。</p>
<p>請求正文示例</p>
<pre><code>{
  &quot;reason&quot;: &quot;Indecent material&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;event_id&quot;: &quot;$YUwQidLecu:example.com&quot;
}
</code></pre>
<h3 id="710">7.10 在事件之間形成關係</h3>
<p>在某些情況下,最好在邏輯上將一個事件的內容與 另一個事件的內容 — 例如,在回復消息時,編輯 事件,或者只是希望為事件的目的添加上下文。</p>
<p>事件在父/子結構中相互關聯,其中任何事件都可以 通過簡單地讓一個孩子事件點成為父母。父事件不 定義他們的孩子,而不是依靠孩子來描述他們的父母。</p>
<p>子事件與其父事件之間的關係在子事件中描述 事件為（定義如下）。子事件可以指向 任何其他事件,包括另一個子事件,以建立如此長時間的關係 由於兩個活動都在同一個房間內,但是可能會施加額外的限制 按關係的類型
（）。contentm.relates_torel_type</p>
<p>若要允許伺服器聚合和查找父事件的子事件,事件的鍵必須包含在事件的明文部分中。它不可能 以獨佔方式記錄在加密的有效負載中,因為伺服器無法解密事件 用於處理。m.relates_to</p>
<p>與架構不匹配或違反關係規則的關係, 只是被忽略了。一個例子可能是父項和子項處於不同的位置 房間,或以下架構所需的缺少屬性的關係。客戶 處理此類無效關係應獨立於每個事件顯示事件 其他,可選取的顯示錯誤訊息。</p>
<h4 id="mrelates_to">m.relates_to</h4>
<pre><code class="language-json">{
  &quot;m.relates_to&quot;: {
    &quot;event_id&quot;: &quot;$an_event&quot;,
    &quot;rel_type&quot;: &quot;org.example.relationship&quot;
  }
}
</code></pre>
<h4 id="7101">7.10.1 關係類型</h4>
<p>這個規範描述以下關係類型:</p>
<ul>
<li>Event replacements.</li>
<li>Event annotations.</li>
<li>Threads.</li>
<li>References</li>
</ul>
<h4 id="7102">7.10.2 子事件的聚合</h4>
<p>某些子事件可以由伺服器'聚合',具體取決於它們的 .這可以允許將一組子事件匯總到用戶端,而無需 需要子事件本身的用戶端。rel_type</p>
<p>這方面的一個例子可能是 a 需要一個額外的欄位,當 適當指定,將意味著用戶端收到該數字的總數 子事件使用的次數。rel_typekeykey</p>
<p>實際的聚合格式取決於 .rel_type</p>
<p>當通過下面列出的 API 將事件提供給用戶端時,如果事件具有子級,則在'如果事件具有子項'下將包含一個屬性 可以聚合併指向它的事件。該物業是 由和值為鍵的物件是特定於類型的聚合 格式.此屬性稱為'捆綁'。 聚合"
。m.relationsunsignedm.relationsrel_typerel_typem.relations</p>
<p>例如（不包括不重要的欄位）:</p>
<pre><code class="language-json">{
  &quot;event_id&quot;: &quot;$my_event&quot;,
  &quot;unsigned&quot;: {
    &quot;m.relations&quot;: {
      &quot;org.example.possible_annotations&quot;: [
        {
          &quot;key&quot;: &quot;👍&quot;,
          &quot;origin_server_ts&quot;: 1562763768320,
          &quot;count&quot;: 3
        },
        {
          &quot;key&quot;: &quot;👎&quot;,
          &quot;origin_server_ts&quot;: 1562763768320,
          &quot;count&quot;: 1
        }
      ],
      &quot;org.example.possible_thread&quot;: {
        &quot;current_server_participated&quot;: true,
        &quot;count&quot;: 7,
        &quot;latest_event&quot;: {
          &quot;event_id&quot;: &quot;$another_event&quot;,
          &quot;content&quot;: {
            &quot;body&quot;: &quot;Hello world&quot;
          }
        }
      }
    }
  }
}
</code></pre>
<h4 id="7103">7.10.3 關係介面</h4>
<p>若要從伺服器檢索父項的子事件,用戶端可以調用 以下端點。</p>
<p>如果客戶端丟失了聚合上的上下文,則此終結點特別有用 父事件,需要重新生成/驗證它。</p>
<h5 id="get-_matrixclientv1roomsroomidrelationseventid">GET /_matrix/client/v1/rooms/{roomId}/relations/{eventId}</h5>
<p>檢索給定父事件的所有子事件。</p>
<p>請注意,分頁時,令牌應"在"令牌之後 拓撲排序術語,因為只能'向後'分頁 通過事件,從 開始。fromtofrom</p>
<p>例如,從結果的第 2 頁傳遞令牌,以及一個令牌 從第 1 頁開始,將返回空集。調用方可以使用來自 但是,第 1 頁和第 2 頁中的標記將在同一範圍內進行分頁。fromtofromto</p>
<pre><code class="language-json">{
  &quot;chunk&quot;: [
    {
      &quot;content&quot;: {
        &quot;m.relates_to&quot;: {
          &quot;event_id&quot;: &quot;$asfDuShaf7Gafaw&quot;,
          &quot;rel_type&quot;: &quot;org.example.my_relation&quot;
        }
      },
      &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
      &quot;origin_server_ts&quot;: 1432735824653,
      &quot;room_id&quot;: &quot;!636q39766251:matrix.org&quot;,
      &quot;sender&quot;: &quot;@example:example.org&quot;,
      &quot;type&quot;: &quot;m.room.message&quot;,
      &quot;unsigned&quot;: {
        &quot;age&quot;: 1234
      }
    }
  ],
  &quot;next_batch&quot;: &quot;page2_token&quot;,
  &quot;prev_batch&quot;: &quot;page1_token&quot;
}
</code></pre>
<h5 id="get-_matrixclientv1roomsroomidrelationseventidreltype">GET /_matrix/client/v1/rooms/{roomId}/relations/{eventId}/{relType}</h5>
<p>檢索給定父事件與父事件相關的所有子事件 使用給定的 .relType</p>
<p>請注意,分頁時,令牌應"在"令牌之後 拓撲排序術語,因為只能'向後'分頁 通過事件,從 開始。fromtofrom</p>
<p>例如,從結果的第 2 頁傳遞令牌,以及一個令牌 從第 1 頁開始,將返回空集。調用方可以使用來自 但是,第 1 頁和第 2 頁中的標記將在同一範圍內進行分頁。fromtofromto</p>
<pre><code class="language-json">{
  &quot;chunk&quot;: [
    {
      &quot;content&quot;: {
        &quot;m.relates_to&quot;: {
          &quot;event_id&quot;: &quot;$asfDuShaf7Gafaw&quot;,
          &quot;rel_type&quot;: &quot;org.example.my_relation&quot;
        }
      },
      &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
      &quot;origin_server_ts&quot;: 1432735824653,
      &quot;room_id&quot;: &quot;!636q39766251:matrix.org&quot;,
      &quot;sender&quot;: &quot;@example:example.org&quot;,
      &quot;type&quot;: &quot;m.room.message&quot;,
      &quot;unsigned&quot;: {
        &quot;age&quot;: 1234
      }
    }
  ],
  &quot;next_batch&quot;: &quot;page2_token&quot;,
  &quot;prev_batch&quot;: &quot;page1_token&quot;
}
</code></pre>
<h5 id="get-_matrixclientv1roomsroomidrelationseventidreltypeeventtype">GET /_matrix/client/v1/rooms/{roomId}/relations/{eventId}/{relType}/{eventType}</h5>
<p>檢索給定父事件與父事件相關的所有子事件 使用給定的並擁有給定的.relTypeeventType</p>
<p>請注意,分頁時,令牌應"在"令牌之後 拓撲排序術語,因為只能'向後'分頁 通過事件,從 開始。fromtofrom</p>
<p>例如,從結果的第 2 頁傳遞令牌,以及一個令牌 從第 1 頁開始,將返回空集。調用方可以使用來自 但是,第 1 頁和第 2 頁中的標記將在同一範圍內進行分頁。fromtofromto</p>
<pre><code class="language-json">{
  &quot;chunk&quot;: [
    {
      &quot;content&quot;: {
        &quot;m.relates_to&quot;: {
          &quot;event_id&quot;: &quot;$asfDuShaf7Gafaw&quot;,
          &quot;rel_type&quot;: &quot;org.example.my_relation&quot;
        }
      },
      &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
      &quot;origin_server_ts&quot;: 1432735824653,
      &quot;room_id&quot;: &quot;!636q39766251:matrix.org&quot;,
      &quot;sender&quot;: &quot;@example:example.org&quot;,
      &quot;type&quot;: &quot;m.room.message&quot;,
      &quot;unsigned&quot;: {
        &quot;age&quot;: 1234
      }
    }
  ],
  &quot;next_batch&quot;: &quot;page2_token&quot;,
  &quot;prev_batch&quot;: &quot;page1_token&quot;
}
</code></pre>
<h2 id="8">8 房間</h2>
<h3 id="81">8.1 類型</h3>
<p>（可選）房間可以具有表示其預期功能的類型。一個房間 沒有類型並不一定意味著它具有特定的預設函數, 儘管通常這些房間將用於對話目的。</p>
<p>當客戶可能需要區分 兩個不同的房間,例如對話保持和數據保持。如果房間 有一個類型,它在 m.room.create 事件的鍵中指定。要指定房間的類型,請將其作為 on 的一部分提供 創建檔案室請求。typecreation_content</p>
<p>在此規範中,指定了以下房型:</p>
<ul>
<li>m.space</li>
</ul>
<p>通過使用命名空間標識碼,允許未指定的房間類型。</p>
<h3 id="82">8.2 創造</h3>
<p>當房間 已創建,用作此聊天室的事件圖的根。這 事件還有一個金鑰,其中包含聊天室的使用者 ID 造物主。它還將生成其他幾個事件以管理 此房間的許可權。這包括:m.room.createcreator</p>
<ul>
<li>m.room.power_levels:設置使用者的功率級別和所需功率 房間內各種操作的級別,例如發送事件。</li>
<li>m.room.join_rules:房間是否"僅限邀請"。</li>
</ul>
<p>有關這些活動的更多資訊,請參閱會議室活動。自 創建房間時,客戶端必須使用以下 API。</p>
<h4 id="post-_matrixclientv3createroom">POST /_matrix/client/v3/createRoom</h4>
<p>創建具有各種配置選項的新房間。</p>
<p>伺服器必須在創建時應用正常狀態解析規則 新房間,包括檢查每個事件的功率級別。它必須 依以下順序應用請求隱含的事件:</p>
<ol>
<li>
<p>事件本身。必須是 房間。m.room.create</p>
</li>
<li>
<p>建立者加入聊天室的事件。這是 需要,以便可以發送其餘事件。m.room.member</p>
</li>
<li>
<p>默認事件,為房間建立者提供 （而不是其他成員）發送狀態事件的許可權。重寫 按參數。m.room.power_levelspower_level_content_override</p>
</li>
<li>
<p>如果給定,則為事件。m.room.canonical_aliasroom_alias_name</p>
</li>
<li>
<p>由設置的事件。目前,這些是 , 和狀態事件。presetm.room.join_rulesm.room.history_visibilitym.room.guest_access</p>
</li>
<li>
<p>中列出的事件,按其順序排列 上市。initial_state</p>
</li>
<li>
<p>和 （ 和狀態事件）所隱含的事件。nametopicm.room.namem.room.topic</p>
</li>
<li>
<p>邀請和 （ with and ） 所隱含的事件。inviteinvite_3pidm.room.membermembership: invitem.room.third_party_invite</p>
</li>
</ol>
<p>伺服器將在房間內創建一個事件,其中包含 請求使用者作為建立者,以及中提供的其他密鑰。m.room.createcreation_content</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;creation_content&quot;: {
    &quot;m.federate&quot;: false
  },
  &quot;name&quot;: &quot;The Grand Duke Pub&quot;,
  &quot;preset&quot;: &quot;public_chat&quot;,
  &quot;room_alias_name&quot;: &quot;thepub&quot;,
  &quot;topic&quot;: &quot;All about happy hour&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;room_id&quot;: &quot;!sefiuhWgwghwWgh:example.com&quot;
}
</code></pre>
<p>8.3 房間別名
伺服器可以託管具有人類友好名稱的房間的別名。別名 採取形式.#friendlyname:server.name</p>
<p>由於房間別名的範圍限定為特定的主伺服器功能變數名稱,因此它是 主伺服器可能會拒絕在 上維護別名的嘗試 其他功能變數名稱。此規範不提供 主伺服器,用於向其他伺服器發送更新請求。然而 主伺服器必須處理解析其他別名的請求
伺服器;如有必要,他們應使用聯合身份驗證 API 執行此操作。GET</p>
<p>但是,檔室不會儲存檔室中存在的所有別名的清單 具有相關許可權的聊天室成員可以發佈首選 通過狀態事件的別名。中的別名 狀態事件應指向在其中發佈它們的房間ID, 但是,隨著時間的推移,房間別名可能會漂移到其他房間 ID。
用戶端不應將別名視為準確。他們應該被檢查 在使用它們或與其他用戶共用之前。如果房間看起來 具有的房間別名,這應該被檢查到 確保房間的ID與從 請求。m.room.canonical_alias#alias:
example.comroom_id</p>
<h4 id="get-_matrixclientv3directoryroomroomalias">GET /_matrix/client/v3/directory/room/{roomAlias}</h4>
<p>請求伺服器將會議室別名解析為會議室ID。</p>
<p>伺服器將使用聯合 API 解析別名,如果 別名的域部分與伺服器自己的不對應 域。</p>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;room_id&quot;: &quot;!abnjk1jdasj98:capuchins.com&quot;,
  &quot;servers&quot;: [
    &quot;capuchins.com&quot;,
    &quot;matrix.org&quot;,
    &quot;another.com&quot;
  ]
}
</code></pre>
<h4 id="put-_matrixclientv3directoryroomroomalias">PUT /_matrix/client/v3/directory/room/{roomAlias}</h4>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;room_id&quot;: &quot;!abnjk1jdasj98:capuchins.com&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{}
</code></pre>
<h4 id="delete-_matrixclientv3directoryroomroomalias">DELETE /_matrix/client/v3/directory/room/{roomAlias}</h4>
<p>刪除房間別名到房間ID的映射。</p>
<p>伺服器可以選擇在此處實施額外的訪問控制檢查,例如 聊天室別名只能由其建立者或伺服器管理員刪除。</p>
<p>注意:伺服器可以選擇在刪除別名時更新聊天室中的狀態事件。選擇更新 建議使用規範別名事件,除了其其他相關許可權外 檢查,刪除別名並返回成功回應,即使用戶沒有
有權更新事件。alt_aliasesm.room.canonical_aliasm.room.canonical_alias</p>
<p>200 回應</p>
<pre><code class="language-json">{}
</code></pre>
<h4 id="get-_matrixclientv3roomsroomidaliases">GET /_matrix/client/v3/rooms/{roomId}/aliases</h4>
<p>獲取由本地伺服器維護的別名清單 給了空間。</p>
<p>此終結點可由會議室（外部）中的用戶調用 使用者會收到錯誤回應）。如果房間映射到 ,則任意 用戶可以調用此終結點。M_FORBIDDENm.room.history_visibilityworld_readable</p>
<p>伺服器可以選擇在此處實施額外的訪問控制檢查, 例如,允許伺服器管理員查看別名,而不管 會員。</p>
<p>注意:建議用戶端不要突出顯示此別名清單 因為它們不是策劃的,不像狀態事件中列出的那些。m.room.canonical_alias</p>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;aliases&quot;: [
    &quot;#somewhere:example.com&quot;,
    &quot;#another:example.com&quot;,
    &quot;#hat_trick:example.com&quot;
  ]
}
</code></pre>
<h3 id="84">8.4 許可權</h3>
<p>房間的許可權是通過功率級別的概念完成的 - 待辦事項 用戶在房間內的任何操作都必須具有合適的功率級別。權力 關卡作為狀態事件存儲在給定房間中。功率水準 操作所需的和使用者的功率級別在 中定義,其中預設使用者和特定使用者的功率
可以設置級別。默認情況下,所有使用者的功率級別為 0,其他 比電源級別預設為 100 的聊天室建立者。用戶可以授予 其他使用者將功率級別提高到自己的功率級別。為 例如,功率級別為50的使用者 A 可以提高功率級別 使用者 B 的最高等級為
50。跟蹤使用者的功率水準 每個房間,即使使用者不在房間中。包含的金鑰 在確定某些所需的水準
踢,禁止和發送國家事件等操作。有關詳細資訊,請參閱m.room.power_levels。m.room.power_levelsm.room.power_levels</p>
<p>用戶端可能希望為特定功率級別分配名稱。一建議 映射如下:- 0 使用者 - 50 版主 - 100 管理員</p>
<h3 id="85">8.5 檔室成員資格</h3>
<p>使用者需要是聊天室的成員才能發送和接收事件 在那個房間里。使用者可能處於多種狀態,在 與房間的關係:</p>
<ul>
<li>不相關（使用者無法在聊天室中傳送或接收事件）</li>
<li>敲門（使用者已請求參與房間,但 尚不被允許 ）</li>
<li>已邀請（使用者已被邀請參與聊天室,但 尚未參與）</li>
<li>已加入（使用者可以在聊天室中傳送與接收事件）</li>
<li>禁止（不允許使用者加入聊天室）</li>
</ul>
<p>有一些值得注意的例外情況允許未加入的成員 在聊天室中傳送事件的房間:</p>
<ul>
<li>
<p>希望拒絕邀請的使用者將使用 發送帶有的事件。他們一定是先被邀請的。m.room.membercontent.membershipleave</p>
</li>
<li>
<p>如果房間允許,用戶可以發送帶有 of 的事件來敲房間。這是使用者發出的邀請請求。m.room.membercontent.membershipknock</p>
</li>
<li>
<p>要收回之前的敲門聲,用戶將發送類似於 拒絕邀請。leave</p>
</li>
</ul>
<p>有些聊天室要求使用者在加入之前先受邀加入; 其他人允許任何人加入。給定的聊天室是否為"僅限受邀者" 房間由房間配置鍵確定。它可以 具有以下值之一:m.room.join_rules</p>
<p>public這個房間可供任何人免費加入,無需邀請。</p>
<p>invite只有在您被邀請的情況下才能加入此房間。</p>
<p>knock此房間只有在您被邀請的情況下才能加入,並允許任何人 請求邀請加入會議室。請注意,此聯接規則僅可用 在支援敲門的房間版本中。</p>
<p>[v1.2 中新增]</p>
<p>restricted如果您被邀請或您是另一個房間的成員,則可以加入此房間 加入規則中列出的房間。如果伺服器無法驗證任何成員身份 列出的房間,那麼您只能通過邀請加入。請注意,此規則 只應在支援它的房間版本中工作。</p>
<p>[v1.3 中新增]</p>
<p>knock_restricted這個房間可以像以前一樣連接。如果你 使用敲門與房間交互,規則生效,而 嘗試在沒有邀請的情況下加入聊天室將應用加入規則。
請注意,此規則僅適用於支援它的房間版本。restrictedknockknockrestricted</p>
<p>成員資格允許的狀態轉換為:
<a href="/img/membership.png"><img alt="membership.png" src="/img/membership.png" title="membership.png" /></a></p>
<h4 id="get-_matrixclientv3joined_rooms">GET /_matrix/client/v3/joined_rooms</h4>
<p>此 API 傳回使用者目前聊天室的清單。</p>
<pre><code class="language-json">{
  &quot;joined_rooms&quot;: [
    &quot;!foo:example.com&quot;
  ]
}
</code></pre>
<h4 id="851">8.5.1 連接房間</h4>
<h5 id="post-_matrixclientv3roomsroomidinvite">POST /_matrix/client/v3/rooms/{roomId}/invite</h5>
<p>請注意,此 API 有兩種形式,分別記錄。 此版本的 API 要求邀請者知道矩陣 被邀請者的標識碼。另一個記錄在第三方邀請部分中。</p>
<p>此 API 邀請用戶參與特定聊天室。 在他們實際加入 房間。</p>
<p>只有當前位於特定聊天室中的使用者才能邀請其他使用者 加入那個房間。</p>
<p>如果使用者被邀請到聊天室,主伺服器會將事件追加到聊天室。m.room.member</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;reason&quot;: &quot;Welcome to the team!&quot;,
  &quot;user_id&quot;: &quot;@cheeky_monkey:matrix.org&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code>{}
</code></pre>
<h5 id="post-_matrixclientv3joinroomidoralias">POST /_matrix/client/v3/join/{roomIdOrAlias}</h5>
<p>請注意,此 API 採用房間 ID 或別名,這與 ./rooms/{roomId}/join</p>
<p>此 API 啟動參與特定聊天室的使用者（如果該使用者） 被允許參加該房間。在此調用之後,用戶端是 允許查看房間中的所有當前狀態事件,以及所有後續事件 與聊天室關聯的事件,直到使用者離開聊天室。</p>
<p>使用者加入檔室后,該聊天室將作為條目顯示在 /initialSync 和 /sync API 的回應。</p>
<p>請求正文示例</p>
<pre><code>{
  &quot;reason&quot;: &quot;Looking for support&quot;,
  &quot;third_party_signed&quot;: {
    &quot;mxid&quot;: &quot;@bob:example.org&quot;,
    &quot;sender&quot;: &quot;@alice:example.org&quot;,
    &quot;signatures&quot;: {
      &quot;example.org&quot;: {
        &quot;ed25519:0&quot;: &quot;some9signature&quot;
      }
    },
    &quot;token&quot;: &quot;random8nonce&quot;
  }
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;room_id&quot;: &quot;!d41d8cd:matrix.org&quot;
}
</code></pre>
<h5 id="post-_matrixclientv3roomsroomidjoin">POST /_matrix/client/v3/rooms/{roomId}/join</h5>
<p>請注意,此 API 需要會議室 ID,而不是別名。 如果您有檔室別名,則存在。/join/{roomIdOrAlias}</p>
<p>此 API 啟動參與特定聊天室的使用者（如果該使用者） 被允許參加該房間。在此調用之後,用戶端是 允許查看房間中的所有當前狀態事件,以及所有後續事件 與聊天室關聯的事件,直到使用者離開聊天室。</p>
<p>使用者加入檔室后,該聊天室將作為條目顯示在 /initialSync 和 /sync API 的回應。</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;reason&quot;: &quot;Looking for support&quot;,
  &quot;third_party_signed&quot;: {
    &quot;mxid&quot;: &quot;@bob:example.org&quot;,
    &quot;sender&quot;: &quot;@alice:example.org&quot;,
    &quot;signatures&quot;: {
      &quot;example.org&quot;: {
        &quot;ed25519:0&quot;: &quot;some9signature&quot;
      }
    },
    &quot;token&quot;: &quot;random8nonce&quot;
  }
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;room_id&quot;: &quot;!d41d8cd:matrix.org&quot;
}
</code></pre>
<h4 id="852">8.5.2 離開房間</h4>
<p>用戶可以離開聊天室以停止接收該聊天室的事件。一個使用者 必須在他們被邀請或加入房間之前 有資格離開房間。離開使用者所在的房間 邀請拒絕邀請,並且可以收回敲門聲。用戶離開后 一個房間,它將不再出現在對 /sync API 的回應中,除非它是
通過具有欄位集的過濾器顯式請求 自。include_leavetrue</p>
<p>無論他們是否真的加入了房間,如果房間是一個 "僅限邀請"聊天室 使用者需要重新邀請才能 重新加入房間。</p>
<p>使用者還可以忘記他們離開的房間。客房有 被遺忘永遠不會出現對 /sync API 的回應, 直到使用者重新加入,重新邀請或敲門。</p>
<p>使用者可能希望強制其他使用者離開房間。這是可以做到的 通過'踢'其他使用者。為此,執行踢球的用戶必須 具有所需的功率水準。一旦使用者被踢出,則 行為與自願離開是一樣的。在 特別是,如果房間不是,用戶可以自由重新加入 "僅限邀請"。</p>
<h5 id="post-_matrixclientv3roomsroomidforget">POST /_matrix/client/v3/rooms/{roomId}/forget</h5>
<p>此 API 阻止使用者記住特定房間。</p>
<p>一般來說,歷史是駭客帝國的一等公民。在此 API 之後 被調用,但是,使用者將無法再檢索歷史記錄 對於這個房間。如果主伺服器上的所有用戶都忘記了一個房間,則該房間是 符合從該主伺服器刪除的條件。</p>
<p>如果使用者當前已加入聊天室,則他們必須離開聊天室 在調用此 API 之前。</p>
<p>200 回應</p>
<pre><code class="language-json">{}
</code></pre>
<h5 id="post-_matrixclientv3roomsroomidleave">POST /_matrix/client/v3/rooms/{roomId}/leave</h5>
<p>此 API 阻止用戶參與特定聊天室。</p>
<p>如果用戶已經在房間中,他們將無法再看到 房間里有新事件。如果聊天室需要邀請才能加入,則 需要重新邀請才能重新加入。</p>
<p>如果使用者被邀請加入聊天室,但尚未加入,則此呼叫 用於拒絕邀請。</p>
<p>使用者仍被允許從房間中檢索歷史記錄 他們以前被允許看到。</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;reason&quot;: &quot;Saying farewell - thanks for the support!&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{}
</code></pre>
<h5 id="post-_matrixclientv3roomsroomidkick">POST /_matrix/client/v3/rooms/{roomId}/kick</h5>
<p>將使用者踢出房間。</p>
<p>調用方必須具有所需的功率級別才能執行此操作。</p>
<p>踢出使用者會將目標成員的成員資格狀態調整為 自選。與其他成員資格更改一樣,用戶可以直接調整 通過向發出請求來顯示目標成員的狀態。leavereason/rooms/<room id>
/state/m.room.member/<user id></p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;reason&quot;: &quot;Telling unfunny jokes&quot;,
  &quot;user_id&quot;: &quot;@cheeky_monkey:matrix.org&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{}
</code></pre>
<h3 id="86">8.6 列出房間</h3>
<h4 id="get-_matrixclientv3directorylistroomroomid">GET /_matrix/client/v3/directory/list/room/{roomId}</h4>
<p>獲取給定檔室在伺服器的公共會議室目錄中的可見性。</p>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;visibility&quot;: &quot;public&quot;
}
</code></pre>
<h4 id="put-_matrixclientv3directorylistroomroomid">PUT /_matrix/client/v3/directory/list/room/{roomId}</h4>
<p>設置給定聊天室在伺服器公共聊天室中的可見性 目錄。</p>
<p>伺服器可以選擇實施額外的訪問控制檢查 例如,在這裡,房間的可見性只能通過以下方式更改 聊天室建立者或伺服器管理員。</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;visibility&quot;: &quot;public&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{}
</code></pre>
<h4 id="get-_matrixclientv3publicrooms">GET /_matrix/client/v3/publicRooms</h4>
<p>列出伺服器上的公共會議室。</p>
<p>此 API 返回分頁回應。房間按編號排序 加入的成員,最大的房間排在第一位。</p>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;chunk&quot;: [
    {
      &quot;avatar_url&quot;: &quot;mxc://bleecker.street/CHEDDARandBRIE&quot;,
      &quot;guest_can_join&quot;: false,
      &quot;join_rule&quot;: &quot;public&quot;,
      &quot;name&quot;: &quot;CHEESE&quot;,
      &quot;num_joined_members&quot;: 37,
      &quot;room_id&quot;: &quot;!ol19s:bleecker.street&quot;,
      &quot;room_type&quot;: &quot;m.space&quot;,
      &quot;topic&quot;: &quot;Tasty tasty cheese&quot;,
      &quot;world_readable&quot;: true
    }
  ],
  &quot;next_batch&quot;: &quot;p190q&quot;,
  &quot;prev_batch&quot;: &quot;p1902&quot;,
  &quot;total_room_count_estimate&quot;: 115
}
</code></pre>
<h2 id="9">9 用戶數據</h2>
<h3 id="91">9.1 用戶目錄</h3>
<h4 id="post-_matrixclientv3user_directorysearch">POST /_matrix/client/v3/user_directory/search</h4>
<p>對使用者執行搜索。主伺服器可能 確定搜索哪些用戶子集,但主伺服器 必須至少考慮請求使用者共享的使用者 與居住在公共房間（家庭伺服器已知）的人的房間。 搜索必須考慮本地使用者到主伺服器,並且應該 在搜索過程中查詢遠端使用者。</p>
<p>搜索對使用者 ID 和顯示不區分大小寫 名稱最好使用基於請求中提供的標頭（如果存在）確定的排序規則。Accept-Language</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;limit&quot;: 10,
  &quot;search_term&quot;: &quot;foo&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;limited&quot;: false,
  &quot;results&quot;: [
    {
      &quot;avatar_url&quot;: &quot;mxc://bar.com/foo&quot;,
      &quot;display_name&quot;: &quot;Foo&quot;,
      &quot;user_id&quot;: &quot;@foo:bar.com&quot;
    }
  ]
}
</code></pre>
<h3 id="92">9.2 配置 檔</h3>
<h4 id="get-_matrixclientv3profileuserid">GET /_matrix/client/v3/profile/{userId}</h4>
<p>獲取此使用者的組合配置檔資訊。可以使用此介面 獲取使用者自己的個人資料資訊或其他使用者;也 本地或遠端家庭伺服器上。此 API 可能會返回不是 只限於或 。displaynameavatar_url</p>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;avatar_url&quot;: &quot;mxc://matrix.org/SDGdghriugerRg&quot;,
  &quot;displayname&quot;: &quot;Alice Margatroid&quot;
}
</code></pre>
<h4 id="get-_matrixclientv3profileuseridavatar_url">GET /_matrix/client/v3/profile/{userId}/avatar_url</h4>
<p>獲取用戶的頭像網址。此 API 可用於獲取使用者的 擁有頭像網址或查詢其他使用者的網址;本地或 在遠端家庭伺服器上。</p>
<p>200 回應</p>
<pre><code class="language-json">{
  &quot;avatar_url&quot;: &quot;mxc://matrix.org/SDGdghriugerRg&quot;
}
</code></pre>
<h4 id="put-_matrixclientv3profileuseridavatar_url">PUT /_matrix/client/v3/profile/{userId}/avatar_url</h4>
<p>此 API 設定給定使用者的頭像 URL。您必須具有以下權限:設定此使用者的頭像 URL,例如,您需要擁有他們的 .access_token</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;avatar_url&quot;: &quot;mxc://matrix.org/wefh34uihSDRGhw34&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{}
</code></pre>
<h4 id="get-_matrixclientv3profileuseriddisplayname">GET /_matrix/client/v3/profile/{userId}/displayname</h4>
<p>獲取使用者的顯示名稱。此 API 可用於獲取使用者的 自己的顯示名稱或查詢其他用戶的名稱;本地或 在遠端家庭伺服器上。</p>
<pre><code class="language-json">{
  &quot;displayname&quot;: &quot;Alice Margatroid&quot;
}
</code></pre>
<h4 id="put-_matrixclientv3profileuseriddisplayname">PUT /_matrix/client/v3/profile/{userId}/displayname</h4>
<p>此 API 設定給定使用者的顯示名稱。您必須具有以下權限:設定此使用者的顯示名稱,例如,您需要具有他們的 .access_token</p>
<p>請求正文示例</p>
<pre><code class="language-json">{
  &quot;displayname&quot;: &quot;Alice Margatroid&quot;
}
</code></pre>
<p>200 回應</p>
<pre><code class="language-json">{}
</code></pre>
<h4 id="921">9.2.1 個人資料資訊變更事件</h4>
<p>因為配置文件顯示名稱和頭像資訊很可能是 在客戶端顯示的許多位置使用,對這些欄位的更改會導致 發生自動傳播事件,通知可能感興趣的人 新價值觀的各方。此更改使用兩個單獨的 機制:</p>
<ul>
<li>一個事件（具有成員資格）被發送到每個 使用者所屬的聊天室,以更新 和 。m.room.memberjoindisplaynameavatar_url</li>
<li>發送狀態更新,再次包含 和鍵的新值,此外 到包含當前狀態的必需鍵 的使用者。m.presencedisplaynameavatar_urlpresence
  當使用者使用時,這兩者都應由主伺服器自動完成 成功更改其顯示名稱或頭像 URL 欄位。</li>
</ul>
<p>此外,當主伺服器為自己發出房間成員身份事件時 用戶,他們應該在 這些事件使客戶已經掌握了這些詳細資訊,並且 不必執行額外的往返來查詢它。</p>
<h2 id="10">10 安全</h2>
<h3 id="101">10.1 速率限制</h3>
<p>家庭伺服器應實施速率限制以降低風險 重載。如果請求因速率限制而被拒絕,則應 傳回以下形式的標準錯誤回應:</p>
<pre><code>{
  &quot;errcode&quot;: &quot;M_LIMIT_EXCEEDED&quot;,
  &quot;error&quot;: &quot;string&quot;,
  &quot;retry_after_ms&quot;: integer (optional)
}
</code></pre>
<p>應包含金鑰以告訴客戶端多長時間 他們必須在幾毫秒內等待,然後才能重試。retry_after_ms</p>
<h2 id="11_1">11 模組</h2>
<p>模組是用戶端-伺服器 API 的一部分,並非通用 所有終結點。模組在此規範中嚴格定義 並且不應被誤認為是實驗性擴展或可選擴展 特徵。相容的伺服器實現必須支援所有模組和 支援規範（除非實現僅針對用戶端
某些配置檔,在這種情況下,只有那些配置檔所需的模組 必須實現功能配置檔）。合規的客戶端實現 必須支援所有必需的模組和支持規範 它所針對的功能配置檔。</p>
<h3 id="111_1">11.1 功能配置檔</h3>
<p>矩陣支援許多不同類型的用戶端:來自嵌入式物聯網 設備到桌面用戶端。並非所有用戶端都可以提供相同的功能 設置為其他用戶端,例如由於缺少物理硬體,例如 有一個螢幕。用戶端可以屬於多個配置檔之一,每個配置檔 配置檔包含客戶端必須支援的一組功能。這
部分詳細介紹了一組'功能配置檔'。客戶應 完整地實現配置檔,以便將其分類為 該配置檔。</p>
<h3 id="112_1">11.2 即時通訊</h3>
<p>此模組增加了對向房間發送人類可讀消息的支援。 它還增加了對將人類可讀資訊與 房間本身,例如房間名稱和主題。</p>
<h4 id="1121">11.2.1 事件</h4>
<h5 id="mroommessage">m.room.message</h5>
<p>在聊天室中發送消息時使用此事件。消息不限於文本。鍵概述了消息的類型,例如文本,音訊,圖像,視頻等。密鑰是文本,必須與各種一起使用,作為客戶端無法呈現消息時的回退機制。這允許客戶端顯示某些內容,即使它只是純文字。msgtypebodymsgtype</p>
<pre><code class="language-json">{
  &quot;content&quot;: {
    &quot;body&quot;: &quot;This is an example text message&quot;,
    &quot;format&quot;: &quot;org.matrix.custom.html&quot;,
    &quot;formatted_body&quot;: &quot;&lt;b&gt;This is an example text message&lt;/b&gt;&quot;,
    &quot;msgtype&quot;: &quot;m.text&quot;
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;type&quot;: &quot;m.room.message&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<h4 id="1122">11.2.2 客戶端行為</h4>
<p>用戶端應驗證傳入事件的結構,以確保
預期的鍵存在,並且它們屬於正確的類型。客戶可以
放棄格式錯誤的事件或向用戶顯示佔位元消息。
必須從用戶端中刪除已編輯的'm.room.message'事件。這
可以用佔位元文本替換（例如"[已編輯]"）或
可以從郵件檢視中完全刪除已編輯的郵件。</p>
<p>包含附件的事件（例如"m.image","m.file"）應該是
使用 [內容存儲庫模組]（#content存储库）上傳
如果可用。然後,可以在"url"中使用生成的"mxc://"URI
。.key。</p>
<p>用戶端可以包含用戶端生成的附件縮圖
在"info.thumbnail_url"鍵下。縮圖也應該是
"mxc://"烏里。顯示帶有附件的事件的用戶端可以使用
用戶端生成的縮圖或要求其主伺服器生成
原始附件中的縮圖,使用 [內容存儲庫
模組]（#content存储库）。</p>
<h5 id="_1">發送消息時的建議</h5>
<p>如果發送失敗,用戶端應使用
一定時間 T 的指數退避演算法。是的
建議 T 不超過 5 分鐘。在此之後,
用戶端應停止重試並將消息標記為'未發送'。使用者
應該能夠手動重新發送未發送的消息。</p>
<p>用戶可以一次鍵入多條消息並快速發送所有消息
繼承。用戶端應保留發送它們的順序
使用者。這意味著客戶端應等待對
發送下一個請求之前的上一個請求。這可能導致
線頭阻塞。為了減少線頭的影響
阻塞,用戶端應使用每個房間的佇列,而不是全域佇列
佇列,因為訂購僅在單個房間內相關,而不是
房間之間。</p>
<h5 id="_2">本地回聲</h5>
<p>當使用者使用時,消息應立即顯示在消息檢視中
按下'發送'按鈕。即使消息是
仍在發送。這稱為'本地回聲'。客戶應該
實現消息的'本地回顯'。用戶端可以在
不同的格式,以指示伺服器尚未處理
消息。伺服器回應時應刪除此格式。</p>
<p>用戶端需要能夠將他們發送的消息與
他們從事件流收到的消息相同。回聲
來自事件流的同一消息稱為'遠端回聲'。。雙
回聲需要標識為同一消息,以防止
顯示重複消息。理想情況下,這種配對會發生
對使用者透明:UI 在轉換時不會閃爍
從本地到遠端。可以通過用戶端使閃爍減少
使用他們用於發送特定事件的事務ID。這
使用的交易 ID 將包含在事件的'未簽名'數據中,作為
當它通過事件流到達時transaction_id。</p>
<p>無法使用交易 ID 的用戶端可能會
當遠端回聲到達事件流時體驗閃爍
<em>在</em>發送消息的請求完成之前。在這種情況下,
事件在客戶端獲取事件 ID 之前到達,使其
無法將其識別為遠端回聲。這會導致用戶端
在一段時間內顯示兩次消息（取決於伺服器）
回應能力）在原始請求發送消息之前
完成。完成後,客戶端可以採取補救措施來
通過查找重複的事件ID來刪除重複的事件。</p>
<h5 id="_3">計算使用者的顯示名稱</h5>
<p>用戶端可能希望顯示房間的人類可讀顯示名稱
成員身份,或當他們發送消息時。
但是,不同的成員可能具有衝突的顯示名稱。顯示
在向用戶顯示名稱之前,必須消除名稱的歧義,以便
防止欺騙其他使用者。</p>
<p>為了確保跨用戶端一致地執行此操作,用戶端應使用
以下演算法用於計算
給定使用者:</p>
<ol>
<li>檢查相關使用者 ID 的"m.room.member"狀態事件。</li>
<li>如果"m.room.member"狀態事件沒有"顯示名稱"字段,或者如果
   該欄位具有'null' 值,請使用原始使用者 ID 作為顯示
   名字。否則:</li>
<li>如果"m.room.member"事件具有唯一的"顯示名稱"
   在具有'成員資格:加入'或
   "成員資格:邀請",使用給定的"顯示名稱"作為
   用戶可見的顯示名稱。否則:</li>
<li>"m.room.member"事件具有非唯一的"顯示名稱"。這
   應使用使用者ID消除歧義,例如"顯示名稱
   (@id:homeserver.org）"。</li>
</ol>
<p>開發人員在實現上述內容時應注意以下事項
演算法:</p>
<ul>
<li>一個成員的用戶可見顯示名稱可能受到以下因素的影響
  另一個成員的狀態更改。例如,如果
  "@user1:matrix.org"出現在一個房間里,帶有"顯示名稱:愛麗絲",
  然後當"@user2:示例.com"加入房間時,也與
  "顯示名稱:愛麗絲",<em>兩個</em>用戶必須消除歧義
  顯示名稱。同樣,當其中一個使用者隨後更改其
  顯示名稱,不再有衝突,<em>兩個</em>用戶可以
  給定他們選擇的顯示名稱。客戶應對此保持警惕
  可能性並確保所有受影響的使用者都正確
  重新命名。</li>
<li>聊天室的顯示名稱也可能受到
  成員名單。這是由於房間名稱有時是基於
  在使用者顯示名稱上（請參閱 [計算 的顯示名稱
  房間]（#calculating房间的显示名称））。</li>
<li>如果搜索整個成員身份清單以顯示衝突
  名稱,這導致用於構建清單的 O（N^2） 實現
  的房間成員。對於大型房間來說,這將非常低效
  成員人數。建議客戶端實現
  維護從'顯示名稱'到房間清單的哈希表映射
  使用該名稱的成員。然後可以使用這樣的表來有效地
  計算是否需要消除歧義。</li>
</ul>
<h5 id="_4">使用消息顯示成員身份資訊</h5>
<p>客戶可能希望顯示房間的顯示名稱和頭像URL
發送消息的成員。這可以通過檢查
該使用者 ID 的"m.room.member"狀態事件（請參閱 [計算
用戶的顯示名稱]（#calculating用户的显示名称））。</p>
<p>當使用者對郵件歷史記錄進行分頁時,用戶端可能希望顯示
聊天室成員的顯示名稱和頭像URL。這是
可能是因為較舊的'm.room.member'事件在以下情況下返回
分頁。這可以通過保留兩組
房間狀態:舊和當前。隨著新事件的到來和/或使用者
時光倒流,這兩組狀態彼此分道揚鑣。
新事件更新當前狀態,分頁事件更新舊狀態
州。按順序處理分頁事件時,舊狀態
表示發送事件時聊天室的狀態*。這
然後可用於設置歷史顯示名稱和頭像URL。</p>
<h5 id="_5">計算聊天室的顯示名稱</h5>
<p>客戶可能希望為房間顯示人類可讀的名稱。有一個
選擇有用名稱的可能性數量。確保房間
在用戶端中一致命名,用戶端應使用以下名稱
選擇名稱的演演算法:</p>
<ol>
<li>如果聊天室具有非空的 [m.room.name]（#mroomname） 狀態事件
   "名稱"欄位,請使用該欄位指定的名稱。</li>
<li>如果聊天室具有 [m.room.canonical_alias]（#mroomcanonical_alias） 狀態事件,並且
   有效的"別名"欄位,使用該字段給出的別名作為名稱。
   請注意,客戶端在計算時應避免使用"alt_aliases"
   房間名稱。
   3.如果以上條件都不滿足,則應組成一個名稱
   基於房間的成員。客戶應考慮
   [m.room.member]（#mroommember） 登錄使用者以外的使用者的事件,如
   定義如下。<ol>
<li>如果房間的'm.hero'數量大於或等於
   "m.joined_member_count + m.invited_member_count - 1",然後使用
   英雄計算顯示名稱的成員資格事件
   對於使用者（[消除歧義,如果
   必需]（#calculating用户的显示名称））和
   將它們連接起來。例如,客戶可以選擇顯示
   "Alice, Bob, and Charlie （@charlie:example.org）"作為房間
   名字。用戶端可以選擇限制其用戶數
   用於生成房間名稱。</li>
<li>如果英雄少於
   "m.joined_member_count + m.invited_member_count - 1",以及
   "m.joined_member_count + m.invited_member_count"大於
   1,用戶端應使用英雄來計算顯示名稱
   對於使用者（[消除歧義,如果
   必需]（#calculating用户的显示名称））和
   將它們與剩餘使用者的計數連接起來。為
   例如,"愛麗絲,鮑勃和其他 1234 人"。</li>
<li>如果"m.joined_member_count + m.invited_member_count"小於
   或等於 1（表示成員是單獨的）,用戶端
   應使用上述規則來指示房間是空的。
   例如,'空房間（是愛麗絲）','空房間（是愛麗絲）
   和其他 1234 人）",如果沒有英雄,則為"空房間"。</li>
</ol>
</li>
</ol>
<p>客戶應將房間名稱國際化為用戶的語言
當使用"m.heroes"計算名稱時。用戶端應使用
在可能的情況下,至少 5 個英雄來計算房間名稱,但可以使用
或多或少是為了更好地適應他們的用戶體驗。</p>
<h5 id="_6">劇透消息</h5>
<p>通過使用劇透,可以直觀地向用戶隱藏消息的某些部分。
這不會影響伺服器對事件內容的表示 - 它
只是向使用者提供視覺提示,消息可能會揭示重要內容
有關某事的信息,破壞任何相關的驚喜。</p>
<p>要發送劇透,客戶必須使用"formatted_body",因此
"org.matrix.custom.html"格式,如上所述。這使得劇透在
任何可以適當支援此格式的"msgtype"。</p>
<p>劇透本身包含'span'標籤,原因（可選）
處於'數據-MX-劇透'屬性中。無故劇透必須至少
指定屬性,但該值可能為空/未定義。</p>
<p>劇透的一個例子是:</p>
<pre><code class="language-json">{
  &quot;msgtype&quot;: &quot;m.text&quot;,
  &quot;format&quot;: &quot;org.matrix.custom.html&quot;,
  &quot;body&quot;: &quot;電影中的愛麗絲[劇透]（mxc://example.org/abc123）。
  &quot;formatted_body&quot;: &quot;愛麗絲&lt;跨數據-mx-劇透&gt;從此過上了幸福的生活&lt;/跨度&gt;在電影中。
}
</code></pre>
<p>如果要提供原因,它將如下所示:</p>
<pre><code class="language-json">{
  &quot;msgtype&quot;: &quot;m.text&quot;,
  &quot;format&quot;: &quot;org.matrix.custom.html&quot;,
  &quot;body&quot;: &quot;愛麗絲[愛麗絲的健康劇透]（mxc://example.org/abc123）在電影中。
  &quot;formatted_body&quot;: &quot;愛麗絲&lt;跨度數據-mx-spoiler='愛麗絲的健康'&gt;從此過上了幸福的生活&lt;/跨度&gt;。
}
</code></pre>
<p>發送劇透時,用戶端應在"正文"中提供回退,如上所示
（包括原因）。回退不應包含包含劇透的文本,因為
"body"可能會顯示在純文本用戶端或通知中。為防止劇透出現在
在這種情況下,強烈建議客戶先上傳包含劇透的文本
到媒體存儲庫,然後在 markdown 樣式的連結中引用"mxc://"URI,如上所示。</p>
<p>客戶應該通過某種披露以不同的方式呈現劇透。例如,
用戶端可以模糊實際文本並要求用戶按兩下它以顯示它。</p>
<h4 id="_7">伺服器行為</h4>
<p>主伺服器應拒絕沒有
"msgtype"鍵,或者沒有文本"body"鍵,帶有 HTTP
狀態代碼為 400。</p>
<h4 id="_8">安全注意事項</h4>
<p>使用此模組發送的消息未加密,儘管是端到端的
加密正在開發中（請參閱 [E2E 模組]（#end 端到端加密））。</p>
<p>用戶端應清理<strong>所有顯示的密鑰</strong>以查找不安全的HTML
防止跨網站腳稿 （XSS） 攻擊。這包括房間名稱和
主題。</p>
<h3 id="113">11.3 豐富的回復</h3>
<p>豐富的回復是一個
特殊類型的[關係]（#forming-事件之間的關係-事件之間）
有效地引用引用的事件,以便用戶端呈現/處理如何
它希望。它們通常與 ['m.room.message']（#mroommessage） 事件一起使用。</p>
<p>在規範的 v1.3 之前,豐富的回復僅限於"m.room.message"事件
它可以表示 HTML 格式的正文。從 v1.3 開始,現在已擴展
到 <em>all</em> 事件類型,通過放棄 HTML 格式的正文的要求
被包括在內。</p>
<p>此外,豐富的回復可以引用自 v1.3 起的任何其他事件類型。
以前,豐富的回復只能引用另一個"m.room.message"事件。</p>
<p>如果可能,事件應包括 [回退表示形式]（#fallbacks-for-rich-replies）
允許不呈現富回復的用戶端仍然看到以下內容
似乎是引用的答覆。</p>
<p>儘管豐富的回復與另一個事件形成關係,但它們不會
使用"rel_type"創建此關係。而是名為"m.in_reply_to"的子項
用於描述回復的關係,保留
"m.relates_to"來描述事件的主要關係。這意味著
如果一個事件只是回復另一個事件,沒有進一步的關係,
"m.relates_to"的"rel_type"和"event_id"屬性變為<em>可選</em>。</p>
<p>一個範例回復是:</p>
<pre><code class="language-json5">{
  &quot;內容&quot;: {
    &quot;m.relates_to&quot;: {
      &quot;m.in_reply_to&quot;: {
        &quot;event_id&quot;: &quot;$another_事件&quot;
      }
    },
    &quot;body&quot;: &quot;這聽起來是個好主意！
  },
  事件所需的其他欄位
}
</code></pre>
<p>請注意,"m.in_reply_to"物件的"event_id"具有相同的要求
好像它直接在"m.relates_to"下。</p>
<h4 id="_9">豐富回復的回退</h4>
<p>某些用戶端可能不支持豐富的回復,因此需要
回退以改用。不支援富回復的用戶端應
將事件呈現為豐富的回復並不特別。</p>
<p>支援富回復的用戶端應提供回退格式
回復,並且必須在呈現回復之前剝離回退。這
每個"msgtype"的特定回退文本都不同,但是
"正文"的一般格式為:</p>
<pre><code class="language-text">&gt; &lt;@alice:example.org&gt;這是原始正文
&gt; 這是回復的地方

</code></pre>
<p>"formatted_body"（如果存在）並使用關聯的"格式"
"org.matrix.custom.html"應使用以下範本:</p>
<pre><code class="language-html">
&lt;MX-回復&gt;
    &lt;塊引用&gt;
        &lt;a href=&quot;https://matrix.to/#/!somewhere:example.org/$event:example.org&quot;&gt;回復&lt;/a&gt;
        &lt;a href=&quot;https://matrix.to/#/@alice:example.org&quot;&gt;@alice:example.org&lt;/a&gt;
        &lt;BR/&gt;
        &lt;!--這是相關事件的 HTML 所在的位置。--&gt;
    &lt;/塊引用&gt;
&lt;/MX-回復&gt;
這就是答覆的地方。
</code></pre>
<p>如果相關事件沒有"formatted_body",則事件的
在對任何 HTML 特殊字元進行編碼後,應考慮"body"。
請注意,兩個錨點中的"href"都使用 [matrix.to
URI]（/appendices#matrixto-navigation）.</p>
<h5 id="_10">剝離回退</h5>
<p>支援富回復的客戶端必須從
事件,然後呈現事件。這是因為
不能信任回退是
事件。刪除回退後,建議用戶端表示
"m.in_reply_to"引用的事件類似於回退的事件
表示,儘管客戶確實為其使用者提供了創作自由
介面。客戶應該更喜歡「formatted_body」而不是「body」,
就像其他"m.room.message"事件一樣。</p>
<p>要剝離"正文"上的回退,用戶端應遍歷每個
字串的行,刪除以回退開頭的任何行
前綴（"&gt; ",包括空格,不帶引號）並在以下情況下停止
遇到不帶前綴的行。此前綴稱為
回退前綴序列"。</p>
<p>若要剝離"formatted_body"上的回退,用戶端應刪除
整個"MX-回復"標記。</p>
<h5 id="mtextmnotice">"m.text"、"m.notice"和無法識別的消息類型的回退</h5>
<p>使用前綴序列,相關事件"正文"的第一行
應以使用者的 ID 為前綴,後跟每行
以回退前綴序列為前綴。例如:</p>
<pre><code class="language-text">&gt; &lt;@alice:example.org&gt;這是第一行
&gt; 這是第二行
&gt; 這是回復

</code></pre>
<p>"formatted_body"使用本節前面定義的範本。</p>
<h5 id="memote">"m.emote"的回退</h5>
<p>與"m.text"的回退類似,每行都以
回退前綴序列。但是,應在之前插入星號
使用者的ID,如下所示:</p>
<pre><code class="language-text">&gt; * &lt;@alice:example.org&gt; 感覺今天將是美好的一天
    這是回復
</code></pre>
<p>"formatted_body"對於範本有一個細微的區別,其中
星號也插入到使用者的 ID 之前:</p>
<pre><code class="language-html">
&lt;MX-回復&gt;
    &lt;塊引用&gt;
        &lt;a href=&quot;https://matrix.to/#/!somewhere:example.org/$event:example.org&quot;&gt;回復&lt;/a&gt;

        * &lt;a href=&quot;https://matrix.to/#/@alice:example.org&quot;&gt;@alice:example.org&lt;/a&gt;
        &lt;BR/&gt;

        &lt;!--這是相關事件的 HTML 所在的位置。--&gt;
    &lt;/塊引用&gt;
&lt;/MX-回復&gt;
這就是答覆的地方。

</code></pre>
<h5 id="mimagemvideomaudiomfile">"m.image"、"m.video"、"m.audio"和"m.file"的回退</h5>
<p>相關事件的"正文"將是一個檔名,可能不是很
描述。相關事件不應具有"格式"
或"內容"中的"formatted_body"——如果活動確實有"格式"
和/或"formatted_body",則應忽略這些欄位。因為
檔名本身可能不是描述性的,相關事件的"正文"應該
被視為「已發送檔」。' 使輸出看起來相似
到以下內容:</p>
<pre><code class="language-text">&gt; &lt;@alice:example.org&gt;發送了一個檔。
這是回復
</code></pre>
<pre><code class="language-html">
&lt;MX-回復&gt;
    &lt;塊引用&gt;
        &lt;a href=&quot;https://matrix.to/#/!somewhere:example.org/$event:example.org&quot;&gt;回復&lt;/a&gt;
        &lt;a href=&quot;https://matrix.to/#/@alice:example.org&quot;&gt;@alice:example.org&lt;/a&gt;
        &lt;BR/&gt;
        發送了一個檔。
    &lt;/塊引用&gt;
&lt;/MX-回復&gt;
這就是答覆的地方。

</code></pre>
<p>對於"m.image",文本應為"發送圖像"。<code>.對於「m.video」,
文本應為「發送視頻」。</code>.對於"m.audio",文本應為
「發送音訊檔」。。</p>
<h3 id="114-ip">11.4 IP 語音</h3>
<p>本模組概述了房間中的兩個使用者如何設置IP語音
（VoIP）互相呼叫。語音和視頻通話建立在
WebRTC 1.0標準。呼叫信令是通過發送 [消息] 來實現的
事件]（#events）到房間。在此版本的規範中,只有兩方
支援通信（例如,兩個對等體之間或對等體之間
和多點會議裝置）。這意味著用戶端只能
將呼叫事件發送到只有兩個參與者的聊天室。</p>
<h4 id="1141">11.4.1 事件</h4>
<h5 id="mcallanswer">m.call.answer</h5>
<p>此事件由被叫方在希望應答呼叫時發送</p>
<pre><code class="language-text">{
  &quot;content&quot;: {
    &quot;answer&quot;: {
      &quot;sdp&quot;: &quot;v=0\r\no=- 6584580628695956864 2 IN IP4 127.0.0.1[...]&quot;,
      &quot;type&quot;: &quot;answer&quot;
    },
    &quot;call_id&quot;: &quot;12345&quot;,
    &quot;version&quot;: 0
  },
  &quot;event_id&quot;: &quot;$143273582443PhrSn:example.org&quot;,
  &quot;origin_server_ts&quot;: 1432735824653,
  &quot;room_id&quot;: &quot;!jEsUZKDJdhlrceRyVU:example.org&quot;,
  &quot;sender&quot;: &quot;@example:example.org&quot;,
  &quot;type&quot;: &quot;m.call.answer&quot;,
  &quot;unsigned&quot;: {
    &quot;age&quot;: 1234
  }
}
</code></pre>
<h4 id="_11">客戶端行為</h4>
<p>使用交換的消息事件設置呼叫,如下所示:</p>
<pre><code>來電者被叫方
[撥打電話]
m.call.invite -----------&gt;
m.call.candidate --------&gt;
[..候選人..]--------&gt;
[接聽電話]
&lt;--------------- m.call.answer
[通話正在進行中]
&lt;--------------- m.call.hangup
</code></pre>
<p>或拒絕的呼叫:</p>
<pre><code>來電者被叫方
m.call.invite ------------&gt;
m.call.candidate ---------&gt;
[..候選人..]---------&gt;
[拒絕來電]
&lt;-------------- m.call.hangup
</code></pre>
<p>調用是根據WebRTC規範協商的。</p>
<h5 id="_12">眩光</h5>
<p>"眩光"是兩個使用者在以下位置相互呼叫時出現的問題
大致在同一時間。這會導致呼叫無法設置為
已經有來電/去電。眩光解析度演算法
可用於確定要掛斷的呼叫和應答的呼叫。
如果兩個用戶端實現相同的演算法,則它們都將選擇
同一呼叫和呼叫將成功連接。</p>
<p>當呼叫被"下達"到房間而不是使用者時,眩光解析度
下面概述的演算法僅考慮用於對
同一個房間。演算法如下:</p>
<p>-如果收到房間的"m.call.invite",而客戶
<strong>準備向同一房間發送"m.call.invite":
-用戶端應取消其傳出呼叫,改為
代表用戶自動接受傳入呼叫。
-如果收到房間的"m.call.invite"</strong>在用戶端有
已發送<em><em> "m.call.invite"到同一房間,正在等待
回應:
-客戶應執行
兩個呼叫的呼叫ID,並使用兩個呼叫中的</em>較小</em>,
流產越大。如果來電較小,則
用戶端應代表使用者接受此調用。</p>
<p>呼叫設置應該對用戶顯示無縫,就好像他們只是簡單地
打了個電話,對方接聽了。這意味著任何媒體
應轉移已設置為用於呼叫的流,並且
用於替換它的調用。</p>
<h4 id="1143">11.4.3 伺服器行為</h4>
<p>主伺服器可以提供用戶端可以使用的 TURN 伺服器
聯繫遠端方。將使用以下 HTTP API 端點
用戶端以獲取有關 TURN 伺服器的資訊。</p>
<h4 id="1144">11.4.4 安全注意事項</h4>
<p>只能向具有另一個用戶的房間發出呼叫。如果
它們被放置在群聊室中,可能是其他使用者
將攔截並接聽電話。</p>
<h3 id="115">11.5 鍵入通知</h3>
<p>使用者可能希望在其他用戶在房間內鍵入內容時收到通知。
這可以通過鍵入通知來實現。這些是短暫的
事件,因此它們不構成
[事件圖]（/#event图）。鍵入通知的範圍限定
到一個房間。</p>
<h4 id="_13">事件</h4>
<h5 id="mtyping">m.typing</h5>
<p>通知用戶端目前正在鍵入的用戶清單。</p>
<pre><code class="language-text">{
  &quot;content&quot;: {
    &quot;user_ids&quot;: [
      &quot;@alice:matrix.org&quot;,
      &quot;@bob:example.com&quot;
    ]
  },
  &quot;type&quot;: &quot;m.typing&quot;
}
</code></pre>
<h4 id="_14">客戶端行為</h4>
<p>當用戶端收到「m.typing」事件時,它必須使用使用者 ID 清單
<strong>替換</strong>當前正在鍵入的每個用戶的知識。這
原因是伺服器<em>不記得</em>不是的使用者
目前輸入,因為該清單很快就會變大。客戶應標記
因為不鍵入不在該清單中的任何使用者ID。</p>
<p>建議用戶端存儲一個「布爾值」 指示是否
使用者是否正在鍵入。雖然此值為"true",但計時器應觸發
定期每 N 秒發送一次鍵入的 HTTP 請求。的價值
N建議不超過20-30秒。此請求應
由用戶端重新發送以繼續通知伺服器使用者是
還在打字。由於後續請求將替換舊請求,因此
預期超時用完前 5 秒的安全裕度為
推薦。當使用者停止鍵入時,狀態更改
"布爾"到"假"應該觸發另一個HTTP請求來通知
使用者已停止鍵入的伺服器。</p>
<h5 id="put-_matrixclientv3roomsroomidtypinguserid">PUT /_matrix/client/v3/rooms/{roomId}/typing/{userId}</h5>
<p>這告訴伺服器使用者正在鍵入下一個 N 毫秒,其中 N 是鍵中指定的值。 或者,如果是 ,它告訴伺服器 使用者已停止鍵入。timeouttypingfalse</p>
<p>請求正文示例</p>
<pre><code class="language-text">{
  &quot;timeout&quot;: 30000,
  &quot;typing&quot;: true
}
</code></pre>
<h4 id="_15">安全注意事項</h4>
<p>客戶可能不希望通知房間里的每個人他們正在打字
而是僅會議室中的特定使用者。</p>
<h3 id="116">11.6 收據</h3>
<p>{{&lt; changed-in v="1.4" &gt;}}添加了私人已讀回執。</p>
<p>此模組增加了對收據的支援。這些收據是
事件確認。此模組定義「m.read」收據
用於指示使用者已讀取給定事件,以及"m.read.private"
在沒有任何其他使用者知道的情況下達到相同的目的。主要
"m.read.private"旨在清除[通知]（#receiving-通知）
沒有向他人宣傳讀到狀態。</p>
<p>為每個事件發送收據可能會導致發送大量
到主伺服器的流量。為了防止這成為一個問題,
收據是使用"最多"標記實現的。此標記指示
確認適用於"之前並包括"的所有事件
指定的事件。例如,將事件標記為「已讀」 將指示
用戶已讀取所有事件<em>直到</em>引用的事件。請參閱的
[接收通知]（#receiving-通知）部分瞭解更多資訊
有關已讀回執如何影響通知計數的資訊。</p>
<p>{{&lt; add-in v="1.4" &gt;}}已讀回執主要有三種形式:
<em>無線程:表示讀取到接收,而不考慮線程。這就是
預線程化已讀回執有效。
</em>線程,主時間線:表示不在
特定線程。由線程ID MAin識別。
*線程,在線程中:表示特定線程中的讀到接收
線。由線程根的事件ID標識。</p>
<p>線程式讀回執將在下面進一步詳細討論（#threaded-已讀回執）。</p>
<h4 id="_16">事件</h4>
<p>{{&lt; changed-in v="1.4" &gt;}}每個"user_id"、"receipt_type"和分類
（無線程或"thread_id"）元組必須僅與單個元組關聯
"event_id"。</p>
<h4 id="mreceipt">m.receipt</h4>
<p>通知客戶新收據。</p>
<pre><code class="language-text">{
  &quot;content&quot;: {
    &quot;$1435641916114394fHBLK:matrix.org&quot;: {
      &quot;m.read&quot;: {
        &quot;@rikj:jki.re&quot;: {
          &quot;ts&quot;: 1436451550453
        }
      },
      &quot;m.read.private&quot;: {
        &quot;@self:example.org&quot;: {
          &quot;ts&quot;: 1661384801651
        }
      }
    }
  },
  &quot;type&quot;: &quot;m.receipt&quot;
}
</code></pre>
<h4 id="_17">客戶端行為</h4>
<p>{{&lt; changed-in v="1.4" &gt;}}已更改以支援線程式已讀回執。</p>
<p>在"/sync"中,收據列在"臨時"事件陣列下
對於給定的房間。事件流中的新收據是
更新現有映射的增量。用戶端應替換舊的
基於"user_id"、"receipt_type"和
"thread_id"（如果存在）。
例如:</p>
<pre><code class="language-text">Client receives m.receipt:
  user = @alice:example.com
  receipt_type = m.read
  event_id = $aaa:example.com
  thread_id = undefined

Client receives another m.receipt:
  user = @alice:example.com
  receipt_type = m.read
  event_id = $bbb:example.com
  thread_id = main

The client does not replace any acknowledgements, yet.

Client receives yet another m.receipt:
  user = @alice:example.com
  receipt_type = m.read
  event_id = $ccc:example.com
  thread_id = undefined

The client replaces the older acknowledgement for $aaa:example.com
with this new one for $ccc:example.com, but does not replace the
acknowledgement for $bbb:example.com because it belongs to a thread.

Client receives yet another m.receipt:
  user = @alice:example.com
  receipt_type = m.read
  event_id = $ddd:example.com
  thread_id = main

Now the client replaces the older $bbb:example.com acknowledgement with
this new $ddd:example.com acknowledgement. The client does NOT replace the
older acknowledgement for $ccc:example.com as it is unthreaded.
</code></pre>
<p>當確定
有問題的事件已向用戶顯示<em><em>。只需接收
事件不能提供足夠的確定性,表明用戶已經看到了
事件。用戶應該需要</em>採取一些操作</em>,例如查看
事件發送到的房間或按順序關閉通知
使事件計為「已讀」。用戶端不應發送已讀回執
對於自己的用戶發送的事件。</p>
<p>與發送回執的規則類似,應顯示線程回執
在線程的上下文中。如果線程呈現在披露後面,
用戶端尚未顯示事件（或任何適用的已讀回執）
給使用者。但是,一旦他們擴展了線程,線程已讀回執
將發送並顯示來自其他使用者的每個線程的收據。</p>
<p>用戶端可以通過與
遵循 HTTP API。</p>
<h5 id="post-_matrixclientv3roomsroomidreceiptreceipttypeeventid">POST /_matrix/client/v3/rooms/{roomId}/receipt/{receiptType}/{eventId}</h5>
<p>此 API 將給定收據類型的標記更新為事件 ID 指定。</p>
<p>請求正文示例</p>
<pre><code class="language-text">{
  &quot;thread_id&quot;: &quot;main&quot;
}
</code></pre>
<h5 id="_18">私人已讀回執</h5>
<p>{{% add-in v="1.4" %}}</p>
<p>一些使用者希望將房間標記為已讀,清除其[通知計數]（#receiving通知）,
但不要洩露他們已經閱讀了特定消息的事實。自
為此,用戶端可以發送「m.read.private」收據而不是「m.read」。
要做到這一點:清除通知,不要將收據廣播到
其他使用者。</p>
<p>伺服器不得將「m.read.private」收據發送給除
一個最初發送它。</p>
<p>在"m.read"和"m.read.private"之間,收據更"領先"或
在確定最高讀數標記時使用"最近"。請參閱的
[通知]（#receiving-通知）部分,以獲取更多資訊
這對通知計數有何影響。</p>
<p>如果客戶端發送"m.read"收據,該收據位於"m.read.private"的"後面"
收到,其他使用者將看到更改發生,但發送使用者將
不會將其通知計數倒回該時間點。而
不常見,"m.read"（公共）接收滯後被認為是有效的
例如,"m.read.private"收據後面的幾條消息。</p>
<h5 id="_19">線程式讀回執</h5>
<p>{{% add-in v="1.4" %}}</p>
<p>如果用戶端不使用 [threading]（#threading）,那麼它們只會
發送「無線程」已讀回執,無論線程如何,都會影響整個房間。</p>
<p>線程式已讀回執只是帶有"thread_id"的回執,目標
線程根的事件 ID 或主時間線的"main"。</p>
<p>線程引入了在同一會話中進行多個對話的概念
房間,因此值得自己的已讀回執和通知計數。事件是
如果滿足以下任何條件,則被視為「在線程中」:
<em>它的"rel_type"為"m.thread"。
</em>它具有"rel_type"為"m.thread"的子事件（在這種情況下,它將是
線程根）。
*在事件關係之後,它有一個父事件,該父事件符合
以上之一。但是,實現不應該無限遞歸:a
建議最多使用 3 個躍點以涵蓋間接關係。</p>
<p>不在線程中但仍在房間中的事件被視為
"主時間線",或ID為"main"的特殊線程。</p>
<p>下面是一個聊天室的示例 DAG,虛線表示事件
關係和顯示拓撲排序的實線。</p>
<p><a href="/img/threaded-dag.png"><img alt="threaded-dag.png" src="/img/threaded-dag.png" title="threaded-dag.png" /></a></p>
<p>此 DAG 可以表示為 3 個線程時間線,其中"A"和"B"是線程
根:</p>
<p><a href="/img/threaded-dag-threads.png"><img alt="threaded-dag-threads.png" src="/img/threaded-dag-threads.png" title="threaded-dag-threads.png" /></a></p>
<p>有了這個,我們可以證明:
<em>"I"上的線程已讀回執會將"A"、"B"和"I"標記為已讀。
</em>"E"上的線程已讀回執會將"C"和"E"標記為已讀。
*"D"上的非線程已讀回執會將"A"、"B"、"C"和"D"標記為已讀。</p>
<p>請注意,使用線程已讀回執將"A"標記為已讀並不意味著
"C"、"E"、"G"或"H"被標記為已讀:線程 A 的時間線需要
它自己的線程讀取回執位於「H」處以實現此目的。</p>
<p>上述 3 個範例的已讀回執為:</p>
<pre><code class="language-json">{
  &quot;$I&quot;: {
    &quot;m.read&quot;: {
      &quot;@user:example.org&quot;: {
        &quot;ts&quot;: 1661384801651,
        &quot;thread_id&quot;: &quot;main&quot; // because `I` is not in a thread, but is a threaded receipt
      }
    }
  },
  &quot;$E&quot;: {
    &quot;m.read&quot;: {
      &quot;@user:example.org&quot;: {
        &quot;ts&quot;: 1661384801651,
        &quot;thread_id&quot;: &quot;$A&quot; // because `E` is in Thread `A`
      }
    }
  },
  &quot;$D&quot;: {
    &quot;m.read&quot;: {
      &quot;@user:example.org&quot;: {
        &quot;ts&quot;: 1661384801651
        // no `thread_id` because the receipt is *unthreaded*
      }
    }
  }
}
</code></pre>
<p>發送已讀回執的條件與線程和非線程讀取類似
收益。例如,用戶端可能會為線程發送專用已讀回執
用戶展開該線程時的事件。</p>
<h4 id="_20">伺服器行為</h4>
<p>為了提高效率,收據應分批到每個房間的一個事件中
在將它們交付給客戶之前。</p>
<p>某些收據作為類型為「m.receipt」的EDU通過聯合發送。這
EDU 格式為:</p>
<pre><code>{
    &lt;room_id&gt;: {
        &lt;receipt_type&gt;: {
            &lt;user_id&gt;: { &lt;content (ts &amp; thread_id, currently)&gt; }
        },
        ...
    },
    ...
}
</code></pre>
<p>這些始終作為增量發送到以前發送的回執。現在
只應使用單個"<receipt_type>":"m.read"。'm.read.private'
不得出現在此聯合"m.receipt"教育中。</p>
<h4 id="_21">安全注意事項</h4>
<p>由於收據是在事件圖的上下文之外發送的,因此存在
未對「m.receipt」事件的內容執行完整性檢查。</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.94c44541.min.js"></script>
      
    
  </body>
</html>